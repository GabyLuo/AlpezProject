(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[73],{b293:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=this,a=e.$createElement,r=e._self._c||a;return r("q-page",{staticClass:"bg-grey-3"},[r("div",{staticClass:"q-pa-sm panel-header"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-sm-6"},[r("div",{staticClass:"q-pa-md q-gutter-sm"},[r("q-breadcrumbs",{staticStyle:{"font-size":"20px"},attrs:{align:"left"}},[r("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),r("q-breadcrumbs-el",{attrs:{label:"Kardex"}})],1)],1)]),r("div",{staticClass:"col-sm-6"},[r("div",{staticClass:"col-sm-4 col-sm-4 pull-right",staticStyle:{padding:"16px"}},[r("q-btn",{staticStyle:{"margin-left":"6px"},attrs:{color:"negative",icon:"fas fa-file-pdf"},on:{click:function(t){return e.generatePdfKardex()}}},[r("q-tooltip",{attrs:{"content-class":"bg-negative"}},[e._v("Generar PDF")])],1),r("q-btn",{staticStyle:{"margin-left":"6px"},attrs:{color:"positive",icon:"fas fa-download"},on:{click:function(t){return e.generateCsvKardex()}}},[r("q-tooltip",{attrs:{"content-class":"bg-positive"}},[e._v("Generar CSV")])],1)],1)])])]),r("div",{staticClass:"q-pa-md bg-grey-3"},[r("div",{staticClass:"row bg-white border-panel"},[r("div",{staticClass:"col q-pa-md"},[r("div",{staticClass:"row q-mb-sm"},[r("div",{staticClass:"col-xs-12 col-md-12 pull-right",staticStyle:{padding:"3px"}}),r("div",{staticClass:"col-xs-12 col-sm-2 text-center",staticStyle:{padding:"3px"}},[r("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",mask:"date",label:"Desde"},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"event"}})]},proxy:!0}]),model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}},[r("q-popup-proxy",{ref:"date_ref",attrs:{"transition-show":"scale","transition-hide":"scale"}},[r("div",{staticClass:"col-sm-12"},[r("q-date",{attrs:{color:"secondary","text-color":"white",mask:"DD/MM/YYYY","today-btn":""},on:{input:function(){return e.$refs.date_ref.hide()}},model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}})],1)])],1)],1),r("div",{staticClass:"col-xs-12 col-sm-2 text-center",staticStyle:{padding:"3px"}},[r("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",mask:"date",label:"Hasta"},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"event"}})]},proxy:!0}]),model:{value:e.endingDate,callback:function(t){e.endingDate=t},expression:"endingDate"}},[r("q-popup-proxy",{ref:"date_ref",attrs:{"transition-show":"scale","transition-hide":"scale"}},[r("div",{staticClass:"col-sm-12"},[r("q-date",{attrs:{color:"secondary","text-color":"white",mask:"DD/MM/YYYY","today-btn":""},on:{input:function(){return e.$refs.date_ref.hide()}},model:{value:e.endingDate,callback:function(t){e.endingDate=t},expression:"endingDate"}})],1)])],1)],1),r("div",{staticClass:"col-xs-12 col-md-4",staticStyle:{padding:"3px"}},[r("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.branchOfficeOptions,label:"Estación"},on:{input:function(){t.storage=null}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-store-alt"}})]},proxy:!0}]),model:{value:e.branchOffice,callback:function(t){e.branchOffice=t},expression:"branchOffice"}})],1),r("div",{staticClass:"col-xs-12 col-md-4",staticStyle:{padding:"3px"}},[r("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.filteredStorageOptions,label:"Almacén"},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}]),model:{value:e.storage,callback:function(t){e.storage=t},expression:"storage"}})],1),r("div",{staticClass:"col-xs-12 col-md-5",staticStyle:{padding:"3px"}},[r("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",options:e.filteredProductOptions,label:"Producto"},on:{filter:e.filterProducts},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"emoji_objects"}})]},proxy:!0},{key:"no-option",fn:function(){return[r("q-item",[r("q-item-section",{staticClass:"text-grey"},[e._v("\n                    Sin resultados\n                  ")])],1)]},proxy:!0}]),model:{value:e.product,callback:function(t){e.product=t},expression:"product"}})],1),r("div",{staticClass:"col-xs-12 col-md-5 pull-left",staticStyle:{padding:"3px"}},[r("q-btn",{staticClass:"full-height",staticStyle:{"margin-left":"6px"},attrs:{icon:"fas fa-eraser",color:"primary"},on:{click:function(t){return e.cleanFilters()}}},[r("q-tooltip",{attrs:{"content-class":"bg-primary"}},[e._v("Limpiar filtros")])],1),r("q-btn",{staticClass:"full-height",staticStyle:{"margin-left":"3px"},attrs:{icon:"fas fa-search",color:"primary"},on:{click:function(t){return e.generateKardex()}}},[r("q-tooltip",{attrs:{"content-class":"bg-primary"}},[e._v("Buscar")])],1)],1)]),r("br"),r("q-table",{attrs:{flat:"",bordered:"",data:e.data,columns:e.columns,"row-key":"serial",pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t}},[r("q-td",{key:"date",attrs:{props:t}},[e._v(e._s(t.row.date))]),r("q-td",{key:"movementType",attrs:{props:t}},[r("q-chip",{attrs:{square:"",dense:"",color:e.setTypeColor(t),"text-color":"white",icon:e.setTypeIcon(t)}},[e._v("\n                  "+e._s(1==t.row.type_id?"ENTRADA":2==t.row.type_id?"SALIDA":3==t.row.type_id?"INVENTARIO FÍSICO":6==t.row.type_id?"MERMA":5==t.row.type_id?"TRASPASO (SALIDA)":"TRASPASO (ENTRADA)")+"\n                ")])],1),r("q-td",{key:"branchOffice",staticStyle:{"text-align":"left"},attrs:{props:t}},[e._v(e._s(t.row.branch_office_name))]),r("q-td",{key:"storage",staticStyle:{"text-align":"left"},attrs:{props:t}},[e._v(e._s(t.row.storage_name))]),r("q-td",{key:"product",staticStyle:{"text-align":"left"},attrs:{props:t}},[e._v(e._s(t.row.category_code+"-"+t.row.line_code+"-"+e.PadLeft(t.row.product_code,5)))]),r("q-td",{key:"foli",staticStyle:{"text-align":"left"},attrs:{props:t}},[e._v(e._s(t.row.folio))]),r("q-td",{key:"qty",staticStyle:{"text-align":"right"},attrs:{props:t}},[e._v(e._s(e.formatPrice(t.row.qty))+" ")]),r("q-td",{key:"stock",staticStyle:{"text-align":"right"},attrs:{props:t}},[e._v(e._s(e.formatPrice(t.row.stock))+" ")])],1)]}}])})],1)])])])},n=[],s=(a("a9e3"),a("4de4"),a("d3b7"),a("25f0"),a("ac1f"),a("5319"),a("b680"),a("99af"),a("e260"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("1276"),a("00b4"),a("aabb")),o={name:"Kardex",data:function(){return{formatter:new Intl.NumberFormat("en-US"),startDate:null,endingDate:null,branchOffice:null,storage:null,product:null,branchOfficeOptions:[],storageOptions:[],productOptions:[],filteredProductOptions:[],pagination:{sortBy:"serial",descending:!1,rowsPerPage:25},columns:[{name:"date",align:"center",label:"FECHA",field:"date",sortable:!1},{name:"movementType",align:"center",label:"TIPO",field:"movementType",sortable:!1},{name:"branchOffice",align:"center",label:"ESTACIÓN",field:"branchOffice",sortable:!1,sort:function(t,e){return Number(t,10)-Number(e,10)}},{name:"storage",align:"center",label:"ALMACÉN",field:"storage",sortable:!1,sort:function(t,e){return Number(t,10)-Number(e,10)}},{name:"product",align:"center",label:"PRODUCTO",field:"product",sortable:!1},{name:"foli",align:"center",label:"FOLIO",field:"foli",sortable:!1},{name:"qty",align:"center",label:"CANTIDAD",field:"qty",sortable:!1,sort:function(t,e){return Number(t,10)-Number(e,10)}},{name:"stock",align:"center",label:"SALDO",field:"stock",sortable:!1,sort:function(t,e){return Number(t,10)-Number(e,10)}}],data:[]}},computed:{filteredStorageOptions:function(){var t=this,e=[];return null!=this.branchOffice&&null!=this.branchOffice.value&&(e=this.storageOptions.filter((function(e){return Number(e.branchOffice)===Number(t.branchOffice.value)}))),e}},beforeRouteEnter:function(t,e,a){a((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||3===e||7===e||2===e||20===e||4===e||27===e||22===e||26===e?a():a("/")}))},created:function(){this.fetchFromServer()},methods:{PadLeft:function(t,e){return t.toString().length<e?this.PadLeft("0"+t,e):t},setTypeIcon:function(t){var e=null;return 1===t.row.type_id?e="add":2===t.row.type_id?e="remove":3===t.row.type_id?e="restore":4===t.row.type_id||5===t.row.type_id?e="compare_arrows":6===t.row.type_id&&(e="restore"),e},setTypeColor:function(t){var e=null;return 1===t.row.type_id||4===t.row.type_id?e="positive":2===t.row.type_id||5===t.row.type_id?e="red":3===t.row.type_id?e="light-blue":6===t.row.type_id&&(e="purple"),e},formatPrice:function(t){var e=(t/1).toFixed(3).replace(",",".");return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},fetchFromServer:function(){var t=this;this.$q.loading.show(),s["a"].get("/branch-offices/options").then((function(e){var a=e.data;t.branchOfficeOptions=a.options,s["a"].get("/storages/options").then((function(e){var a=e.data;t.storageOptions=a.options,s["a"].get("/products/options/kardex").then((function(e){var a=e.data;t.productOptions=a.options,t.filteredProductOptions=t.productOptions,t.$q.loading.hide()}))}))}))},filterProducts:function(t,e,a){var r=this;e((function(){var e=t.toLowerCase();r.filteredProductOptions=r.productOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},cleanFilters:function(){this.startDate=null,this.endingDate=null,this.storage={value:null,label:"TODOS"},this.product=null,this.data=[]},generateKardex:function(){var t=this;if(null==this.product||null==this.product.value)return this.$q.dialog({title:"Error",message:"Por favor, seleccione el producto.",persistent:!0}),!1;var e=null,a=null,r=null,n=null,o=this.product.value;this.startDate&&(e=this.startDate.substring(6,10)+"-"+this.startDate.substring(3,5)+"-"+this.startDate.substring(0,2)),this.endingDate&&(a=this.endingDate.substring(6,10)+"-"+this.endingDate.substring(3,5)+"-"+this.endingDate.substring(0,2)),this.branchOffice&&(r=this.branchOffice.value),this.storage&&(n=this.storage.value),s["a"].get("/movements/kardex/".concat(e,"/").concat(a,"/").concat(r,"/").concat(n,"/").concat(o)).then((function(e){var a=e.data;a.result?(t.data=a.kardex,t.$q.loading.hide()):t.$q.loading.hide()}))},generateCsvKardex:function(){var t=this;if(null==this.product||null==this.product.value)return this.$q.dialog({title:"Error",message:"Por favor, seleccione el producto.",persistent:!0}),!1;var e=null,a=null,r=null,n=null,o=this.product.value;this.startDate&&(e=this.startDate.substring(6,10)+"-"+this.startDate.substring(3,5)+"-"+this.startDate.substring(0,2)),this.endingDate&&(a=this.endingDate.substring(6,10)+"-"+this.endingDate.substring(3,5)+"-"+this.endingDate.substring(0,2)),this.branchOffice&&(r=this.branchOffice.value),this.storage&&(n=this.storage.value);var i="https://api_alpez.wasp.mx/"+"movements/kardex/csv/".concat(e,"/").concat(a,"/").concat(r,"/").concat(n,"/").concat(o);this.$q.loading.show(),s["a"].fileDownload(i).then((function(e){var a=e.data,r=window.URL.createObjectURL(new Blob([a],{type:"application/csv"})),n=document.createElement("a");n.href=r,n.setAttribute("download","Kardex.csv"),document.body.appendChild(n),t.$q.loading.hide(),n.click()}))},generatePdfKardex:function(){if(null==this.product||null==this.product.value)return this.$q.dialog({title:"Error",message:"Por favor, seleccione el producto.",persistent:!0}),!1;var t=null,e=null,a=null,r=null,n=this.product.value;this.startDate&&(t=this.startDate.substring(6,10)+"-"+this.startDate.substring(3,5)+"-"+this.startDate.substring(0,2)),this.endingDate&&(e=this.endingDate.substring(6,10)+"-"+this.endingDate.substring(3,5)+"-"+this.endingDate.substring(0,2)),this.branchOffice&&(a=this.branchOffice.value),this.storage&&(r=this.storage.value);var s="https://api_alpez.wasp.mx/"+"movements/kardex/pdf/".concat(t,"/").concat(e,"/").concat(a,"/").concat(r,"/").concat(n);window.open(s,"_blank")},format:function(t){var e=",",a=".";t+="";var r=t.split("."),n=r[0],s=r.length>1?a+r[1]:"",o=/(\d+)(\d{3})/;while(o.test(n))n=n.replace(o,"$1"+e+"$2");return n+s}}},i=o,l=a("2877"),c=a("9989"),d=a("ead5"),u=a("079e"),p=a("9c40"),f=a("05c0"),g=a("ddd8"),b=a("0016"),h=a("7cbe"),m=a("52ee"),v=a("66e5"),y=a("4074"),x=a("eaac"),w=a("bd08"),_=a("db86"),q=a("b047"),D=a("eebe"),O=a.n(D),k=Object(l["a"])(i,r,n,!1,null,null,null);e["default"]=k.exports;O()(k,"components",{QPage:c["a"],QBreadcrumbs:d["a"],QBreadcrumbsEl:u["a"],QBtn:p["a"],QTooltip:f["a"],QSelect:g["a"],QIcon:b["a"],QPopupProxy:h["a"],QDate:m["a"],QItem:v["a"],QItemSection:y["a"],QTable:x["a"],QTr:w["a"],QTd:_["a"],QChip:q["a"]})}}]);