(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"0e4d":function(t,e,a){"use strict";a("b007")},a734:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[a("div",{staticClass:"q-pa-md panel-header"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-8"},[a("div",{staticClass:"q-pa-md q-gutter-sm"},[a("q-breadcrumbs",{staticStyle:{"font-size":"20px"},attrs:{align:"left"}},[a("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),a("q-breadcrumbs-el",{attrs:{label:"Auditoria de recepciones"}})],1)],1)]),a("div",{staticClass:"col-sm-4 pull-right"},[a("div",{staticClass:"col-xs-12 col-md-4 offset-md-10 pull-right"},[a("div",[t.haspermissionv1?a("q-btn",{staticStyle:{"margin-left":"10px"},attrs:{color:"green",icon:"fas fa-file-excel"},on:{click:function(e){return t.generateCSV()}}},[a("q-tooltip",[t._v("GENERAR CSV")])],1):t._e(),t.haspermissionv1?a("q-btn",{staticStyle:{"margin-left":"10px"},attrs:{color:"red",icon:"fas fa-file-pdf"},on:{click:function(e){return t.generatePDF()}}},[a("q-tooltip",[t._v("GENERAR PDF")])],1):t._e()],1)])])])]),a("div",{staticClass:"q-pa-md bg-grey-3"},[a("div",{staticClass:"row bg-white"},[a("div",{staticClass:"col q-pa-md"},[a("q-table",{attrs:{flat:"",bordered:"",data:t.data,columns:t.columns,"row-key":"sale_date",pagination:t.pagination,filter:t.filter},on:{"update:pagination":function(e){t.pagination=e},request:t.qTableRequest},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticStyle:{width:"100%"}},[a("q-input",{attrs:{dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})],1)]},proxy:!0},{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"serial",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",{staticStyle:{"text-decoration":"underline black",cursor:"pointer"},on:{click:function(a){return t.openActions(e.row.id)}}},[t._v(t._s(e.row.serial))])]),a("q-td",{key:"productos",attrs:{props:e}},[t._v(t._s(e.row.productos))]),a("q-td",{key:"entrada",attrs:{props:e}},[t._v(t._s(e.row.entrada))]),a("q-td",{key:"deuda",attrs:{props:e}},[t._v(t._s(e.row.deuda))]),a("q-td",{key:"status",attrs:{props:e}},[a("q-chip",{attrs:{square:"",dense:"",color:t.colorStatus[e.row.status],"text-color":"white"}},[t._v(t._s(e.row.status))])],1),a("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:e}},["PENDIENTE"===e.row.status?a("q-btn",{attrs:{color:"primary",icon:"done",flat:"",size:"10px"},nativeOn:{click:function(a){return t.autorizar(e.row.id)}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Autorizar")])],1):t._e()],1)],1)]}}])})],1)]),a("q-dialog",{attrs:{persistent:""},model:{value:t.shipmentDetailsModal,callback:function(e){t.shipmentDetailsModal=e},expression:"shipmentDetailsModal"}},[a("q-card",{staticStyle:{width:"1000px",height:"1000px"}},[a("q-card-section",[a("q-toolbar",[a("q-toolbar-title",[t._v("Detalles de orden de compra")]),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"close"}})],1)],1),a("q-card-section",{staticStyle:{width:"1000px",height:"1000px"}},[a("div",{staticClass:"row bg-white border-panel"},[a("div",{staticClass:"col q-pa-md"},[a("div",{staticClass:"row q-col-gutter-xs"},[a("q-table",{attrs:{flat:"",bordered:"",data:t.details,columns:t.detailsColumns,"row-key":"name",pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"product",staticStyle:{"text-align":"left",width:"30%"},attrs:{props:e}},[t._v(t._s(e.row.product))]),a("q-td",{key:"qty",staticStyle:{"text-align":"center",width:"5%"},attrs:{props:e}},[t._v(t._s(e.row.qty))]),a("q-td",{key:"price",staticStyle:{"text-align":"center",width:"5%"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.price)))]),a("q-td",{key:"totalPrice",staticStyle:{"text-align":"center",width:"5%"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.price*e.row.qty)))]),a("q-td",{key:"entrada",staticStyle:{"text-align":"center",width:"5%"},attrs:{props:e}},[t._v(t._s(e.row.entrada))]),a("q-td",{key:"restante",staticStyle:{"text-align":"center",width:"5%"},attrs:{props:e}},[t._v(t._s(e.row.restante))]),a("q-td",{key:"observation",staticStyle:{"text-align":"left",width:"35%"},attrs:{props:e}},[t._v(t._s(e.row.observation))]),"APROBADO"!=t.order.fields.status&&"CERRADO"!=t.order.fields.status&&"CANCELADO"!=t.order.fields.status?a("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:e}},[a("q-btn",{attrs:{color:"primary",icon:"fas fa-edit",flat:"",size:"10px"},nativeOn:{click:function(a){return t.editDetail(e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Editar")])],1),a("q-btn",{attrs:{color:"primary",icon:"fas fa-trash-alt",flat:"",size:"10px"},nativeOn:{click:function(a){return t.removeDetail(e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-red"}},[t._v("Eliminar")])],1)],1):a("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:e}},[t._v("\n                        -\n                      ")])],1)]}}])})],1)])])]),a("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"Autorizar"},on:{click:function(e){return t.updateDetail()}}})],1)],1)],1)],1)])},i=[],n=a("ded3"),r=a.n(n),l=a("7ec2"),o=a.n(l),c=a("c973"),d=a.n(c),u=(a("99af"),a("d3b7"),a("159b"),a("a9e3"),a("caad"),a("2532"),a("4de4"),a("b680"),a("ac1f"),a("5319"),a("aabb")),p=a("b5ae"),m=p.required,f=p.email,v={name:"IndexStorageExits",validations:{paymentMethod:{required:m},paymentDate:{required:m},qty:{required:m},emailReport:{fields:{email_cliente:{required:m,email:f},customer_select:{required:m}}}},data:function(){return{currencyFormatter:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),formatter:new Intl.NumberFormat("en-US"),shipmentDetailsModal:!1,role:null,promptEmailPagos:!1,tableWithInvoice:!1,tableWithoutInvoice:!0,interval:null,customer:"TODOS",disableBtnAddPayment:!0,disableTblPayments:!0,qty:null,paymentDate:null,paymentMethod:null,status:[],emailReport:{fields:{email_cliente:"",customer_select:null}},loadingSendingMailBtn:!1,reference:null,total_invoice:null,id_invoice:null,paymentsModal:!1,saleDatev1:null,saleDatev2:null,customerOptions:[],filteredCustomerOptions:[],filteredCustomerOptionsv2:[],formaPagoOptions:[],pagination:{sortBy:"id",descending:!0,page:1,rowsNumber:0,rowsPerPage:50},columns:[{name:"serial",align:"center",label:"# Orden",field:"serial",sortable:!0},{name:"productos",align:"center",label:"Productos",field:"productos",sortable:!0},{name:"entrada",align:"center",label:"Entrada",field:"entrada",sortable:!0},{name:"deuda",align:"center",label:"Deuda",field:"deuda",sortable:!0},{name:"status",align:"center",label:"Estatus",field:"status",sortable:!0},{name:"actions",align:"center",label:"Acciones",field:"actions",sortable:!1}],detailsColumns:[{name:"product",align:"center",label:"Producto",field:"product",style:"width: 30%",sortable:!0},{name:"qty",align:"center",label:"Cantidad",field:"qty",style:"width: 5%",sortable:!0},{name:"price",align:"center",label:"Precio unitario",field:"price",style:"width: 5%",sortable:!0},{name:"totalPrice",align:"center",label:"Importe",field:"totalPrice",style:"width: 5%",sortable:!0},{name:"entrada",align:"center",label:"Entrada",field:"entrada",style:"width: 5%",sortable:!0},{name:"restante",align:"center",label:"Restantes",field:"restante",style:"width: 5%",sortable:!0},{name:"observation",align:"center",label:"Observaciones",field:"observation",style:"width: 35%",sortable:!0},{name:"actions",align:"center",label:"Acciones",field:"actions",style:"width: 10%",sortable:!1}],data:[],details:[],filter:"",statusShipment:["PENDIENTE","AUTORIZADO"],colorStatus:{PENDIENTE:"warning",AUTORIZADO:"green-6"}}},computed:{roleId:function(){var t=this.$store.getters["users/rol"];return parseInt(t)},fiberSaleDocumentFileUrl:function(){return"".concat("https://api_alpez.wasp.mx/","invoices/").concat(this.fiberSaleDocumentFile.fields.fiberSaleId,"/document-file")},totalAmounfromPayments:function(){var t=0;return this.dataPayments.forEach((function(e){t+=Number(e.amount)})),t},haspermissionv1:function(){var t=!1;return(this.$store.getters["users/roles"].includes(1)||this.$store.getters["users/roles"].includes(3)||this.$store.getters["users/roles"].includes(7)||this.$store.getters["users/roles"].includes(12)||this.$store.getters["users/roles"].includes(17))&&(t=!0),t},emailRule:function(t){var e=this;return[function(t){return e.$v.emailReport.fields.email_cliente.email||"El campo debe contener un correo válido."}]}},beforeRouteEnter:function(t,e,a){a((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||2===e||12===e||17===e?a():a("/")}))},mounted:function(){this.fetchFromServer(),this.getClients()},methods:{fetchFromServer:function(){this.$q.loading.show(),this.qTableRequest({pagination:this.pagination,filter:this.filter})},qTableRequest:function(t){var e=this;return d()(o()().mark((function a(){var s;return o()().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.pagination=t.pagination,e.filter=t.filter,e.data=[],s=[],s.pagination=e.pagination,a.next=7,u["a"].post("/shipments/report",s).then((function(t){var a=t.data;e.$q.loading.hide(),console.log(a.shipments),e.data=a.shipments,e.pagination.rowsNumber=a.shipmentsCount})).catch((function(t){return t}));case 7:case"end":return a.stop()}}),a)})))()},getClients:function(){var t=this;u["a"].get("/customers/options").then((function(e){var a=e.data;t.customerOptions=a.options,t.customerOptionsv2=a.options,t.customerOptions.push({label:"TODOS",value:"TODOS"})}))},getPayments:function(t){var e=this,a=[];a.id=this.id_invoice,u["a"].get("/invoices/formaPagoOptions").then((function(t){var s=t.data;e.formaPagoOptions=s.options,u["a"].post("/invoices/dataFromInvoice",a).then((function(t){var a=t.data;a.result&&(e.total_invoice=parseFloat(a.total_invoice),e.dataPayments=a.payments,e.dataPayments.length>0?u["a"].get("/invoices/keepCheckingPayments/"+e.id_invoice).then((function(t){var a=t.data;a.result?null===e.interval&&(e.interval=setInterval((function(){e.revisarPagos(e.id_invoice)}),1e4)):(clearInterval(e.interval),e.interval=null),e.disableTblPayments=!0;var s=parseFloat(e.totalAmounfromPayments),i=parseFloat(e.total_invoice.toFixed(2));i>s&&(e.disableBtnAddPayment=!1,e.fetchFromServer())})):e.disableTblPayments=!1)}))}))},filterGrid:function(){var t=this;this.data=[];var e=[];e.customer=this.customer,e.status=this.status,e.saleDatev1=this.saleDatev1,e.saleDatev2=this.saleDatev2,e.type=1,e.pagination=this.pagination,e.filter=this.filter,u["a"].post("/invoices/getGridPayments",e).then((function(e){var a=e.data;a.result&&(t.$q.loading.hide(),t.data=a.invoices,t.pagination.rowsNumber=a.invoicesCount)}))},filtrarClientes:function(t,e,a){var s=this;e((function(){var e=t.toLowerCase();s.filteredCustomerOptions=s.customerOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},filtrarClientesv2:function(t,e,a){var s=this;e((function(){var e=t.toLowerCase();s.filteredCustomerOptionsv2=s.customerOptionsv2.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},generatePDF:function(){var t=[],e=[];if(e=0===this.status.length?[99]:this.status,t.customer=this.customer,t.status=e,t.type=1,this.saleDatev1){t.saleDatev1=this.saleDatev1;while(t.saleDatev1.includes("/"))t.saleDatev1=t.saleDatev1.replace("/","-")}else t.saleDatev1=null;if(this.saleDatev2){t.saleDatev2=this.saleDatev2;while(t.saleDatev2.includes("/"))t.saleDatev2=t.saleDatev2.replace("/","-")}else t.saleDatev2=null;var a="https://api_alpez.wasp.mx/"+"/invoices/getPdfFromPaymentsDetails/".concat(t.type,"/").concat(t.customer,"/").concat(t.status,"/").concat(t.saleDatev1,"/").concat(t.saleDatev2);window.open(a,"_blank")},generateCSV:function(){var t=[];if(t.customer=this.customer,t.status=this.status,this.saleDatev1){t.saleDatev1=this.saleDatev1;while(t.saleDatev1.includes("/"))t.saleDatev1=t.saleDatev1.replace("/","-")}else t.saleDatev1=null;if(this.saleDatev2){t.saleDatev2=this.saleDatev2;while(t.saleDatev2.includes("/"))t.saleDatev2=t.saleDatev2.replace("/","-")}else t.saleDatev2=null;var e="https://api_alpez.wasp.mx/"+"/invoices/getCSVFromPaymentsDetails/".concat(t.customer,"/").concat(t.status,"/").concat(t.saleDatev1,"/").concat(t.saleDatev2);window.open(e,"_blank")},sendMail:function(){this.promptEmailPagos=!0},filterMail:function(){var t=this,e=[];e.id=this.emailReport.fields.customer_select,u["a"].post("/customers/getDataClient",e).then((function(e){var a=e.data;console.log(a),t.emailReport.fields.email_cliente=a.data[0].email}))},cleanDialog:function(){this.emailReport.fields.email_cliente="",this.emailReport.fields.customer_select=null,this.promptEmailPagos=!1},sendEmailsReport:function(){var t=this;if(this.$v.emailReport.fields.$reset(),this.$v.emailReport.fields.$reset(),this.$v.emailReport.fields.$touch(),this.$v.emailReport.fields.$error)return!1;this.loadingSendingMailBtn=!0;var e=[];if(e.customer=this.emailReport.fields.customer_select,e.email=r()({},this.emailReport.fields).email_cliente,this.saleDatev1){e.saleDatev1=this.saleDatev1;while(e.saleDatev1.includes("/"))e.saleDatev1=e.saleDatev1.replace("/","-")}else e.saleDatev1=null;if(this.saleDatev2){e.saleDatev2=this.saleDatev2;while(e.saleDatev2.includes("/"))e.saleDatev2=e.saleDatev2.replace("/","-")}else e.saleDatev2=null;e.status=this.status,u["a"].post("/invoices/sendEmailsReport",e).then((function(e){var a=e.data;t.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result?(t.promptEmailPagos=!1,t.emailReport.fields.email_cliente="",t.emailReport.fields.customer_select=null,t.loadingSendingMailBtn=!1):t.loadingSendingMailBtn=!1}))},autorizar:function(t){var e=this,a={id:t};u["a"].put("/purchase-orders/autorizar",a).then((function(t){var a=t.data;e.$q.notify({message:"Se ha autorizado la recepción",position:"top",color:a.result?"positive":"warning"}),e.fetchFromServer()}))},openActions:function(t){this.$router.push("/purchase-orders/".concat(t))}}},h=v,g=(a("0e4d"),a("2877")),b=a("9989"),y=a("ead5"),w=a("079e"),D=a("9c40"),q=a("05c0"),_=a("24e8"),S=a("f09f"),C=a("a370"),P=a("ddd8"),x=a("27f9"),k=a("4b7e"),O=a("7cbe"),E=a("52ee"),R=a("66e5"),Q=a("4074"),A=a("0170"),$=a("9564"),I=a("eaac"),T=a("0016"),F=a("bd08"),N=a("db86"),z=a("b047"),M=a("65c6"),B=a("6ac5"),L=a("7f67"),U=a("eebe"),G=a.n(U),V=Object(g["a"])(h,s,i,!1,null,null,null);e["default"]=V.exports;G()(V,"components",{QPage:b["a"],QBreadcrumbs:y["a"],QBreadcrumbsEl:w["a"],QBtn:D["a"],QTooltip:q["a"],QDialog:_["a"],QCard:S["a"],QCardSection:C["a"],QSelect:P["a"],QInput:x["a"],QCardActions:k["a"],QPopupProxy:O["a"],QDate:E["a"],QItem:R["a"],QItemSection:Q["a"],QItemLabel:A["a"],QToggle:$["a"],QTable:I["a"],QIcon:T["a"],QTr:F["a"],QTd:N["a"],QChip:z["a"],QToolbar:M["a"],QToolbarTitle:B["a"]}),G()(V,"directives",{ClosePopup:L["a"]})},b007:function(t,e,a){}}]);