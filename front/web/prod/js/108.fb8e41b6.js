(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[108],{e981:function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",{staticClass:"bg-grey-3"},[o("div",{staticClass:"q-pa-sm panel-header"},[o("div",{staticClass:"row"},[o("div",{staticClass:"col-sm-4"},[o("div",{staticClass:"q-pa-md q-gutter-sm"},[o("q-breadcrumbs",{staticStyle:{"font-size":"20px"},attrs:{align:"left"}},[o("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),o("q-breadcrumbs-el",{attrs:{label:"Artículos"}})],1)],1)]),o("div",{staticClass:"col-xs-8 col-md-8 pull-right"},[o("div",{staticClass:"q-pa-sm q-gutter-sm"},[o("q-btn",{attrs:{color:"positive",icon:"fas fa-file-csv",label:"Descargar Productos"},on:{click:function(e){return t.updateproducts()}}}),o("q-btn",{attrs:{color:"positive",icon:"fas fa-file-csv",label:"Descargar Productos"},on:{click:function(e){return t.generateCsv()}}}),o("q-btn",{attrs:{color:"positive",icon:"fas fa-file-excel"},on:{click:function(e){return t.generateCsvPrices()}}},[o("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Descargar Precios")])],1),o("q-btn",{attrs:{color:"positive",icon:"fas fa-file-upload"},on:{click:function(e){return t.openUploadFileModalPrices()}}},[o("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Actualizar Precios")])],1),o("q-btn",{staticClass:"bg-primary",staticStyle:{color:"white"},attrs:{icon:"add",label:"Nuevo"},nativeOn:{click:function(e){return t.$router.push("/products/new")}}})],1)])])]),o("div",{staticClass:"q-pa-md bg-grey-3"},[o("div",{staticClass:"row bg-white border-panel"},[o("div",{staticClass:"col q-pa-md"},[o("div",{staticClass:"row q-mb-sm"},[o("div",{staticClass:"col-xs-12 col-md-3",staticStyle:{padding:"1%"}},[o("q-select",{attrs:{filled:"",color:"dark","bg-color":"secondary",label:"Categorías",options:t.optionsCategory,"use-input":"","hide-selected":"","fill-input":""},on:{filter:t.filterCategory,input:function(e){return t.fetchFromServer()}},scopedSlots:t._u([{key:"prepend",fn:function(){return[o("q-icon",{attrs:{name:"fas fa-grip-lines-vertical"}})]},proxy:!0}]),model:{value:t.category,callback:function(e){t.category=e},expression:"category"}})],1),o("div",{staticClass:"col-xs-12 col-md-3",staticStyle:{padding:"1%"}},[o("q-select",{attrs:{filled:"",color:"dark","bg-color":"secondary",label:"Subcategoría",options:t.optionsLine,"use-input":"","hide-selected":"","fill-input":""},on:{filter:t.filterLine,input:function(e){return t.fetchFromServer()}},scopedSlots:t._u([{key:"prepend",fn:function(){return[o("q-icon",{attrs:{name:"fas fa-grip-lines-vertical"}})]},proxy:!0}]),model:{value:t.line,callback:function(e){t.line=e},expression:"line"}})],1),o("div",{staticClass:"col-xs-12 col-md-3",staticStyle:{padding:"1%"}},[o("q-select",{attrs:{filled:"",color:"dark","bg-color":"secondary",label:"Marcas",options:t.options,"use-input":"","hide-selected":"","fill-input":""},on:{filter:t.filterMarcas,input:function(e){return t.fetchFromServer()}},scopedSlots:t._u([{key:"prepend",fn:function(){return[o("q-icon",{attrs:{name:"fas fa-grip-lines-vertical"}})]},proxy:!0}]),model:{value:t.mark,callback:function(e){t.mark=e},expression:"mark"}})],1),o("div",{staticClass:"col-xs-12 col-md-3",staticStyle:{padding:"1%"}},[o("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:[{value:!0,label:"ACTIVO"},{value:!1,label:"INACTIVO"}],label:"Estatus"},on:{input:function(e){return t.fetchForStatus()}},scopedSlots:t._u([{key:"prepend",fn:function(){return[o("q-icon",{attrs:{name:t.status.value?"battery_full":"battery_alert"}})]},proxy:!0}]),model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1)]),o("q-table",{attrs:{flat:"",bordered:"",data:t.filteredProducts,columns:t.columns,"row-key":"code",pagination:t.pagination,filter:t.filter},on:{"update:pagination":function(e){t.pagination=e},request:t.qTableRequest},scopedSlots:t._u([{key:"top",fn:function(){return[o("div",{staticStyle:{width:"100%"}},[o("q-input",{attrs:{dense:"",debounce:"300",placeholder:"Buscar"},on:{input:function(e){t.filter=e.toUpperCase()}},scopedSlots:t._u([{key:"append",fn:function(){return[o("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})],1)]},proxy:!0},{key:"body",fn:function(e){return[o("q-tr",{attrs:{props:e}},[o("q-td",{key:"code",staticClass:"text-primary cursor-pointer",staticStyle:{"text-align":"center","text-decoration":"underline"},attrs:{flat:"",props:e},nativeOn:{click:function(o){return t.editSelectedRow(e.row.id)}}},[t._v(t._s(e.row.product_code+t.PadLeft(e.row.code,5)))]),o("q-td",{key:"old_code",staticClass:"text-primary cursor-pointer",staticStyle:{"text-align":"center","text-decoration":"underline"},attrs:{flat:"",props:e},nativeOn:{click:function(o){return t.editSelectedRow(e.row.id)}}},[t._v(t._s(e.row.old_code))]),o("q-td",{key:"rebasa_code",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.rebasa_code))]),o("q-td",{key:"name",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.name))]),o("q-td",{key:"category",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.category))]),o("q-td",{key:"line",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.line))]),o("q-td",{key:"description",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.description))]),o("q-td",{key:"mark_name",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.mark_name))]),o("q-td",{key:"status",staticStyle:{"text-align":"center"},attrs:{props:e}},[o("q-chip",{attrs:{square:"",dense:"",color:e.row.active?"positive":"negative","text-color":"white"}},[t._v("\n                  "+t._s(e.row.active?"ACTIVO":"INACTIVO")+"\n                ")])],1),o("q-td",{key:"actions",staticClass:"pull-left",attrs:{props:e}},[o("q-btn",{attrs:{color:"primary",icon:"photo",flat:"",size:"10px"},nativeOn:{click:function(o){return t.editPhoto(e.row.id)}}},[o("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Fotografía")])],1),o("q-btn",{attrs:{color:"primary",icon:"fas fa-edit",flat:"",size:"10px"},nativeOn:{click:function(o){return t.editSelectedRow(e.row.id)}}},[o("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Editar")])],1),o("q-btn",{attrs:{color:"negative",icon:"fas fa-trash-alt",flat:"",size:"10px"},nativeOn:{click:function(o){return t.deleteSelectedRow(e.row.id)}}},[o("q-tooltip",{attrs:{"content-class":"bg-red"}},[t._v("Eliminar")])],1)],1)],1)]}}])})],1)])]),o("q-dialog",{attrs:{persistent:""},model:{value:t.photoModal,callback:function(e){t.photoModal=e},expression:"photoModal"}},[o("q-card",{staticStyle:{"min-width":"25%"}},[o("q-card-section",{staticClass:"row bg-primary text-white"},[o("div",{staticClass:"col-xs-12 col-sm-10 text-h6"},[t._v("Foto: "+t._s(t.photoProductCode))]),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col-xs-12 col-sm-2 pull-right",attrs:{icon:"close",flat:"",round:"",dense:""}})],1),o("q-card-section",{staticClass:"scroll",staticStyle:{"max-height":"60vh"}},[o("q-uploader",{ref:"photoProductRef",attrs:{accept:".jpg, image/*",method:"POST","hide-upload-btn":"",factory:t.factoryFn},on:{uploaded:t.afterUploadPhoto}}),o("q-card-section",{staticStyle:{"max-height":"60vh"}},[1==t.cndcarousel?o("q-carousel",{attrs:{animated:"",arrows:"",navigation:"",infinite:""},model:{value:t.slide,callback:function(e){t.slide=e},expression:"slide"}},t._l(t.slides,(function(e){return o("q-carousel-slide",{key:e.id,attrs:{name:e.id,"img-src":e.url}},[o("div",{staticClass:"text-right"},[o("q-btn",{staticClass:"text-right",attrs:{color:"red",icon:"fas fa-trash-alt",flat:"",size:"15px"},nativeOn:{click:function(o){return t.deletePhoto(e)}}},[o("q-tooltip",{attrs:{"content-class":"bg-positive"}},[t._v("Eliminar")])],1)],1)])})),1):t._e()],1)],1),o("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[o("q-btn",{attrs:{color:"positive",label:"Subir foto"},on:{click:function(e){return t.uploadPhoto()}}})],1)],1)],1),o("q-dialog",{attrs:{persistent:""},model:{value:t.documentFileModal2,callback:function(e){t.documentFileModal2=e},expression:"documentFileModal2"}},[o("q-card",[o("q-card-section",{staticClass:"row"},[o("div",{staticClass:"col-xs-12 col-sm-10 text-h6"},[t._v("Archivo: "+t._s(t.documentName2))]),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col-xs-12 col-sm-2 pull-right",attrs:{icon:"close",flat:"",round:"",dense:""}})],1),o("q-card-section",[o("q-uploader",{ref:"fileDocumentRef2",attrs:{url:t.fileDocumentUrl2,headers:[{name:"Authorization",value:t.token}],method:"POST","hide-upload-btn":""},on:{uploaded:t.afterUploadDocumentFile2}})],1),o("q-card-actions",{staticClass:"text-secondary",attrs:{align:"right"}},[o("q-btn",{attrs:{flat:"",label:"Subir archivo"},on:{click:function(e){return t.uploadDocumentFile2()}}})],1)],1)],1),o("q-dialog",{attrs:{persistent:""},model:{value:t.documentFileModalUpdatePrices,callback:function(e){t.documentFileModalUpdatePrices=e},expression:"documentFileModalUpdatePrices"}},[o("q-card",[o("q-card-section",{staticClass:"row"},[o("div",{staticClass:"col-xs-12 col-sm-10 text-h6"},[t._v("Archivo: "+t._s(t.documentNamePrices))]),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col-xs-12 col-sm-2 pull-right",attrs:{icon:"close",flat:"",round:"",dense:""}})],1),o("q-card-section",[o("q-uploader",{ref:"fileDocumentRefPrices",attrs:{url:t.fileDocumentUrlPrices,headers:[{name:"Authorization",value:t.token}],method:"POST","hide-upload-btn":""},on:{uploaded:t.afterUploadDocumentFilePrices}})],1),o("q-card-actions",{staticClass:"text-secondary",attrs:{align:"right"}},[o("q-btn",{attrs:{flat:"",label:"Subir archivo"},on:{click:function(e){return t.uploadDocumentFilePrices()}}})],1)],1)],1)],1)},i=[],r=o("7ec2"),n=o.n(r),s=o("c973"),l=o.n(s),c=(o("d3b7"),o("25f0"),o("a9e3"),o("99af"),o("4de4"),o("aabb")),u={name:"IndexProducts",data:function(){return{cndcarousel:!1,slide:null,slides:[],category:{value:null,label:"TODOS"},line:{value:null,label:"TODOS"},status:{value:!0,label:"ACTIVO"},categoryOptions:[],lineOptions:[],pagination:{sortBy:"code",descending:!0,page:1,rowsNumber:0,rowsPerPage:25},columns:[{name:"old_code",align:"center",label:"CÓDIGO",field:"old_code",style:"width: 10%",sortable:!0},{name:"rebasa_code",align:"center",label:"CÓDIGO INTERNO",field:"rebasa_code",style:"width: 10%",sortable:!0},{name:"name",align:"center",label:"NOMBRE",field:"name",style:"width: 15%",sortable:!0},{name:"category",align:"center",label:"CATEGORÍA",field:"category",style:"width: 15%",sortable:!0},{name:"line",align:"center",label:"SUBCATEGORÍA",field:"line",style:"width: 10%",sortable:!0},{name:"mark_name",align:"center",label:"MARCA",field:"mark_name",style:"width: 10%",sortable:!0},{name:"status",align:"center",label:"ESTATUS",field:"status",style:"width: 10%",sortable:!1},{name:"actions",align:"center",label:"ACCIONES",field:"actions",style:"width: 10%",sortable:!1}],products:[],filter:"",photoModal:!1,photoUrl:null,photoProductId:null,photoProductCode:null,mark:null,options:this.markOptions,optionsCategory:this.categoryOptions,optionsLine:this.lineOptions,markOptions:[],serverUrl:"https://api_alpez.wasp.mx/",documentFileModal:!1,documentFileModal2:!1,documentFileModalUpdatePrices:!1,documentName:null,documentName2:null,documentNamePrices:null}},beforeRouteEnter:function(t,e,o){o((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||3===e||7===e||2===e||20===e||4===e||27===e||22===e?o():o("/")}))},mounted:function(){this.fetchFromServer(),this.getCategories(),this.getLines(),this.getMarks()},methods:{uploadDocumentFile:function(){this.$refs.fileDocumentRef.upload()},afterUploadDocumentFile:function(t){var e=JSON.parse(t.xhr.response);this.$q.notify({message:e.message.content,position:"top",color:e.result?"positive":"warning"}),e.result&&(this.fetchFromServer(),this.documentFileModal=!1)},fileDocumentUrl:function(){return"".concat("https://api_alpez.wasp.mx/","products/file")},uodateCodeProduct:function(){this.documentFileModal=!0},PadLeft:function(t,e){return t.toString().length<e?this.PadLeft("0"+t,e):t},generateCsv:function(){var t="TODOS",e="TODOS";this.category&&(t=Number(this.category.value)),this.line&&(e=Number(this.line.value));var o="https://api_alpez.wasp.mx/"+"products/csv/".concat(t,"/").concat(e);window.open(o,"_blank")},generateCsvPrices:function(){var t="TODOS",e="TODOS",o="TODOS";this.category&&(t=Number(this.category.value)),this.line&&(e=Number(this.line.value)),this.mark&&(o=Number(this.mark.value));var a="https://api_alpez.wasp.mx/"+"products/csvprices/".concat(t,"/").concat(e,"/").concat(o);window.open(a,"_blank")},fetchForCategory:function(){this.line={label:"TODOS",value:null},this.fetchFromServer()},fetchFromServer:function(){this.$q.loading.show(),this.qTableRequest({pagination:this.pagination,filter:this.filter})},qTableRequest:function(t){var e=this;return l()(n()().mark((function o(){var a;return n()().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e.pagination=t.pagination,e.filter=t.filter,e.products=[],a=[],a.category=e.category.value,a.line=e.line.value,a.status=e.status.value,a.pagination=e.pagination,a.filter=e.filter,a.mark=e.mark,o.next=12,c["a"].post("/products/pag",a).then((function(t){var o=t.data;e.$q.loading.hide(),e.products=o.products,e.pagination.rowsNumber=o.productsCount})).catch((function(t){return t}));case 12:case"end":return o.stop()}}),o)})))()},getCategories:function(){var t=this;c["a"].get("/categories/options").then((function(e){var o=e.data;t.categoryOptions=o.options,t.categoryOptions.unshift({value:null,label:"TODOS"})}))},getLines:function(){var t=this;c["a"].get("/lines/options").then((function(e){var o=e.data;t.lineOptions=o.options,t.lineOptions.unshift({value:null,label:"TODOS"}),t.$q.loading.hide()}))},fetchForStatus:function(){this.fetchFromServer()},editPhoto:function(t){var e=this;this.photoModal=!0,c["a"].get("/products/getPhotos/".concat(t)).then((function(t){var o=t.data;o.photos.length>0?(e.cndcarousel=!0,e.slide=o.photos[0].id):e.cndcarousel=!1;for(var a=[],i=0;i<o.photos.length;i++)a.push({id:o.photos[i].id,url:e.serverUrl+"assets/images/products/"+o.photos[i].url});e.slides=a}));var o=this.products.filter((function(e){return Number(e.id)===Number(t)}))[0];this.photoProductId=o.id,this.photoProductCode=o.code,this.photoModal=!0},editSelectedRow:function(t){this.$router.push("/products/".concat(t))},deleteSelectedRow:function(t){var e=this;this.$q.dialog({title:"Confirmación",message:"¿Desea eliminar este Producto?",persistent:!0,ok:{label:"Aceptar",color:"green"},cancel:{label:"Cancelar",color:"red"}}).onOk((function(){e.$q.loading.show(),c["a"].delete("/products/".concat(t)).then((function(t){var o=t.data;e.$q.notify({message:o.message.content,position:"top",color:o.result?"positive":"warning",icon:o.result?"thumb_up":"close"}),o.result&&(e.$q.loading.hide(),e.fetchFromServer())}))})).onCancel((function(){}))},afterUploadPhoto:function(t){this.$q.loading.true();var e=JSON.parse(t.xhr.response);this.$q.notify({message:e.message.content,position:"top",color:e.result?"positive":"warning"}),e.result?(this.$q.loading.hide(),this.fetchFromServer(),this.photoModal=!1):this.$q.loading.hide()},uploadPhoto:function(){this.$refs.photoProductRef.upload()},factoryFn:function(t){var e=this;this.$q.loading.show();var o=new FormData;o.append("fileReg",t[0]),o.append("product_id",this.photoProductId),c["a"].file("/products/photo/",o).then((function(t){var o=t.data;e.fetchFromServer(),e.$showNotify(o.message.content,o.result?"positive":"negative"),e.photoModal=!1,e.$q.loading.hide()}))},filterMarcas:function(t,e,o){var a=this;e((function(){var e=t.toLowerCase();a.options=a.markOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},filterCategory:function(t,e,o){var a=this;e((function(){var e=t.toLowerCase();a.optionsCategory=a.categoryOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},filterLine:function(t,e,o){var a=this;e((function(){var e=t.toLowerCase();a.optionsLine=a.lineOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},getMarks:function(){var t=this;this.mark={label:"TODOS",value:null},c["a"].get("/marks/options").then((function(e){var o=e.data;t.markOptions=o.options,t.markOptions.unshift({value:null,label:"TODOS"})}))},deletePhoto:function(t){var e=this,o=[];o.id=t.id,c["a"].post("/products/photoDelete",o).then((function(t){var o=t.data;e.$q.notify({message:o.message.content,position:"top",color:o.result?"positive":"warning"}),o.result&&(e.fetchFromServer(),e.photoModal=!1)}))},openUploadFileModal2:function(){this.documentFileModal2=!0},uploadDocumentFile2:function(){this.$refs.fileDocumentRef2.upload()},fileDocumentUrl2:function(){return"".concat("https://api_alpez.wasp.mx/","products/file2")},afterUploadDocumentFile2:function(t){var e=JSON.parse(t.xhr.response);this.$q.notify({message:e.message.content,position:"top",color:e.result?"positive":"warning"}),e.result&&(this.fetchFromServer(),this.documentFileModal2=!1)},openUploadFileModalPrices:function(){this.documentFileModalUpdatePrices=!0},uploadDocumentFilePrices:function(){this.$refs.fileDocumentRefPrices.upload()},fileDocumentUrlPrices:function(){return"".concat("https://api_alpez.wasp.mx/","products-prices/filePrices")},afterUploadDocumentFilePrices:function(t){var e=JSON.parse(t.xhr.response);this.$q.notify({message:e.message.content,position:"top",color:e.result?"positive":"warning"}),e.result&&(this.fetchFromServer(),this.documentFileModalUpdatePrices=!1)}},computed:{roleId:function(){var t=this.$store.getters["users/rol"];return parseInt(t)},token:function(){var t="Bearer "+localStorage.getItem("JWT");return t},filteredLineOptions:function(){var t=this;return null!=this.category&&null!=this.category.value?this.lineOptions.filter((function(e){return Number(e.category)===Number(t.category.value)})):this.lineOptions},filteredProducts:function(){var t=this,e=this.products.filter((function(e){return e.active===t.status.value}));return null!=this.line&&null!=this.line.value?e.filter((function(e){return Number(e.line_id)===Number(t.line.value)})):null!=this.category&&null!=this.category.value?e.filter((function(e){return Number(e.category_id)===Number(t.category.value)})):e},photoProductUrl:function(){return"https://api_alpez.wasp.mx/products/photo/"+this.photoProductId}}},d=u,p=o("2877"),f=o("9989"),h=o("ead5"),m=o("079e"),g=o("9c40"),v=o("05c0"),b=o("ddd8"),y=o("0016"),q=o("eaac"),w=o("27f9"),C=o("bd08"),S=o("db86"),k=o("068f"),x=o("b047"),O=o("24e8"),_=o("f09f"),P=o("a370"),F=o("ee89"),D=o("880c"),N=o("62cd"),M=o("4b7e"),T=o("7f67"),U=o("eebe"),$=o.n(U),R=Object(p["a"])(d,a,i,!1,null,null,null);e["default"]=R.exports;$()(R,"components",{QPage:f["a"],QBreadcrumbs:h["a"],QBreadcrumbsEl:m["a"],QBtn:g["a"],QTooltip:v["a"],QSelect:b["a"],QIcon:y["a"],QTable:q["a"],QInput:w["a"],QTr:C["a"],QTd:S["a"],QImg:k["a"],QChip:x["a"],QDialog:O["a"],QCard:_["a"],QCardSection:P["a"],QUploader:F["a"],QCarousel:D["a"],QCarouselSlide:N["a"],QCardActions:M["a"]}),$()(R,"directives",{ClosePopup:T["a"]})}}]);