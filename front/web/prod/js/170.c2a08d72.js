(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[170],{1040:function(e,i,t){"use strict";t.r(i);var s=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("q-page",{staticClass:"bg-grey-3"},[t("div",{staticClass:"q-pa-sm panel-header"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-8"},[t("q-btn",{attrs:{color:"primary",icon:"keyboard_backspace",label:"Regresar"},on:{click:function(i){return e.backToGrid()}}}),t("span",{staticClass:"q-ml-md grey-8 fs28 page-title"},[e._v("Nueva venta de fibra")])],1),t("div",{staticClass:"col-sm-4"},[t("div",{staticClass:"q-pa-md q-gutter-sm"},[t("q-breadcrumbs",{attrs:{align:"right"}},[t("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),t("q-breadcrumbs-el",{attrs:{label:"Salidas de almacén",to:"/storage-exits"}}),t("q-breadcrumbs-el",{attrs:{label:"Nuevo"}})],1)],1)])])]),t("div",{staticClass:"q-pa-md bg-grey-3"},[t("div",{staticClass:"row bg-white border-panel"},[t("div",{staticClass:"col q-pa-md"},[t("div",{staticClass:"row q-col-gutter-xs"},[t("div",{staticClass:"col-xs-12 col-sm-6"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",mask:"date",label:"Fecha de venta",rules:e.saleDateRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"event"}})]},proxy:!0}]),model:{value:e.invoice.fields.saleDate,callback:function(i){e.$set(e.invoice.fields,"saleDate",i)},expression:"invoice.fields.saleDate"}},[t("q-popup-proxy",{ref:"invoiceFieldsSaleDate",attrs:{"transition-show":"scale","transition-hide":"scale"}},[t("div",{staticClass:"col-sm-12"},[t("q-date",{attrs:{"today-btn":""},on:{input:function(){return e.$refs.invoiceFieldsSaleDate.hide()}},model:{value:e.invoice.fields.saleDate,callback:function(i){e.$set(e.invoice.fields,"saleDate",i)},expression:"invoice.fields.saleDate"}})],1)])],1)],1),t("div",{staticClass:"col-xs-12 col-sm-6 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.branchOfficeOptions,label:"Sucursal",rules:e.branchOfficeRules},on:{input:function(i){return e.updateBranchOffice()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-store-alt"}})]},proxy:!0}]),model:{value:e.invoice.fields.branchOffice,callback:function(i){e.$set(e.invoice.fields,"branchOffice",i)},expression:"invoice.fields.branchOffice"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.storageOptions,label:"Almacén de pacas",disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}]),model:{value:e.invoice.fields.baleStorage,callback:function(i){e.$set(e.invoice.fields,"baleStorage",i)},expression:"invoice.fields.baleStorage"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.storageOptions,label:"Almacén fibra abierta",disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}]),model:{value:e.invoice.fields.inBulkStorage,callback:function(i){e.$set(e.invoice.fields,"inBulkStorage",i)},expression:"invoice.fields.inBulkStorage"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.storageOptions,label:"Almacén de laminado",disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}]),model:{value:e.invoice.fields.laminateStorage,callback:function(i){e.$set(e.invoice.fields,"laminateStorage",i)},expression:"invoice.fields.laminateStorage"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.filteredCustomerOptions,label:"Cliente",rules:e.customerRules,"use-input":"","input-debounce":"0",behavior:"menu"},on:{input:function(){e.invoice.fields.customerBranchOffice=null},filter:e.filtrarClientes},scopedSlots:e._u([{key:"no-option",fn:function(){return[t("q-item",[t("q-item-section",{staticClass:"text-grey"},[e._v(" No results ")])],1)]},proxy:!0},{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-shopping-cart"}})]},proxy:!0}]),model:{value:e.invoice.fields.customer,callback:function(i){e.$set(e.invoice.fields,"customer",i)},expression:"invoice.fields.customer"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.filteredCustomerBranchOfficeOptions,label:"Sucursal de cliente",rules:e.customerBranchOfficeRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-store-alt"}})]},proxy:!0}]),model:{value:e.invoice.fields.customerBranchOffice,callback:function(i){e.$set(e.invoice.fields,"customerBranchOffice",i)},expression:"invoice.fields.customerBranchOffice"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.driverOptions,label:"Chofer",rules:e.driverRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-truck"}})]},proxy:!0}]),model:{value:e.invoice.fields.driver,callback:function(i){e.$set(e.invoice.fields,"driver",i)},expression:"invoice.fields.driver"}})],1),t("div",{staticClass:"col-xs-12 text-center"},[t("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",autogrow:"",label:"Comentarios",type:"textarea"},model:{value:e.invoice.fields.comments,callback:function(i){e.$set(e.invoice.fields,"comments",i)},expression:"invoice.fields.comments"}})],1)]),t("div",{staticClass:"row q-mb-sm q-mt-md"},[t("div",{staticClass:"col-xs-12 col-md-2 offset-md-10 pull-right"},[t("q-btn",{attrs:{color:"positive",icon:"save",label:"Guardar"},on:{click:function(i){return e.createSale()}}})],1)])])])])])},o=[],r=t("ded3"),n=t.n(r),a=(t("99af"),t("4d90"),t("d3b7"),t("25f0"),t("4de4"),t("a9e3"),t("aabb")),c=t("b5ae"),l=c.required,u={name:"NewStorageExit",validations:{invoice:{fields:{saleDate:{required:l},branchOffice:{required:l},customer:{required:l},customerBranchOffice:{required:l},driver:{required:l}}}},data:function(){return{invoice:{fields:{saleDate:"".concat((new Date).getFullYear(),"/").concat(((new Date).getMonth()+1).toString().padStart(2,"0"),"/").concat((new Date).getDate().toString().padStart(2,"0")),branchOffice:null,baleStorage:null,inBulkStorage:null,laminateStorage:null,customer:null,customerBranchOffice:null,driver:null,comments:null}},branchOfficeOptions:[],storageOptions:[],customerOptions:[],customerBranchOfficeOptions:[],driverOptions:[],filteredCustomerOptions:[]}},computed:{saleDateRules:function(e){var i=this;return[function(e){return i.$v.invoice.fields.saleDate.required||"El campo Fecha de venta es requerido."}]},branchOfficeRules:function(e){var i=this;return[function(e){return i.$v.invoice.fields.branchOffice.required||"El campo Sucursal es requerido."}]},customerRules:function(e){var i=this;return[function(e){return i.$v.invoice.fields.customer.required||"El campo Cliente es requerido."}]},customerBranchOfficeRules:function(e){var i=this;return[function(e){return i.$v.invoice.fields.customerBranchOffice.required||"El campo Sucursal de cliente es requerido."}]},driverRules:function(e){var i=this;return[function(e){return i.$v.invoice.fields.driver.required||"El campo Chofer es requerido."}]},filteredCustomerBranchOfficeOptions:function(){var e=this,i=[];return null!=this.invoice.fields.customer&&null!=this.invoice.fields.customer.value&&(i=this.customerBranchOfficeOptions.filter((function(i){return Number(i.customer)===Number(e.invoice.fields.customer.value)}))),i}},beforeRouteEnter:function(e,i,t){t((function(e){var i=e.$store.getters["users/rol"];console.log(i),1===i||3===i||7===i||2===i||20===i||4===i||27===i||22===i||29===i||28===i||17===i?t():t("/")}))},created:function(){this.fetchFromServer()},methods:{fetchFromServer:function(){var e=this;this.$q.loading.show(),a["a"].get("/branch-offices/options").then((function(i){var t=i.data;e.branchOfficeOptions=t.options,a["a"].get("/storages/options").then((function(i){var t=i.data;e.storageOptions=t.options,a["a"].get("/customers/options").then((function(i){var t=i.data;e.customerOptions=t.options,a["a"].get("/customer-branch-offices/options").then((function(i){var t=i.data;e.customerBranchOfficeOptions=t.options,a["a"].get("/drivers/options").then((function(i){var t=i.data;e.driverOptions=t.options,e.$q.loading.hide()}))}))}))}))}))},backToGrid:function(){this.$router.push("/storage-exits")},updateBranchOffice:function(){var e=this;null==this.invoice.fields.branchOffice||null==this.invoice.fields.branchOffice.value?(this.invoice.fields.baleStorage=null,this.invoice.fields.inBulkStorage=null,this.invoice.fields.laminateStorage=null):(this.invoice.fields.baleStorage=this.storageOptions.filter((function(i){return Number(i.branchOffice)===Number(e.invoice.fields.branchOffice.value)&&1===Number(i.storageType)}))[0],this.invoice.fields.inBulkStorage=this.storageOptions.filter((function(i){return Number(i.branchOffice)===Number(e.invoice.fields.branchOffice.value)&&2===Number(i.storageType)}))[0],this.invoice.fields.laminateStorage=this.storageOptions.filter((function(i){return Number(i.branchOffice)===Number(e.invoice.fields.branchOffice.value)&&8===Number(i.storageType)}))[0])},createSale:function(){var e=this;if(this.$v.invoice.fields.$reset(),this.$v.invoice.fields.$touch(),this.$v.invoice.fields.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;this.$q.loading.show();var i=[];i.branch_office_id=Number(n()({},this.invoice.fields).branchOffice.value),i.sale_date=n()({},this.invoice.fields).saleDate,i.customer_branch_office_id=Number(n()({},this.invoice.fields).customerBranchOffice.value),i.driver_id=Number(n()({},this.invoice.fields).driver.value),i.comments=n()({},this.invoice.fields).comments,a["a"].post("/invoices",i).then((function(i){var t=i.data;e.$q.notify({message:t.message.content,position:"top",color:t.result?"positive":"warning"}),t.result?(e.$q.loading.hide(),e.$router.push("/storage-exits/".concat(t.invoice.id))):e.$q.loading.hide()}))},filtrarClientes:function(e,i,t){var s=this;i((function(){var i=e.toLowerCase();s.filteredCustomerOptions=s.customerOptions.filter((function(e){return e.label.toLowerCase().indexOf(i)>-1}))}))}}},f=u,d=t("2877"),v=t("9989"),m=t("9c40"),p=t("ead5"),b=t("079e"),h=t("ddd8"),g=t("0016"),O=t("7cbe"),q=t("52ee"),x=t("66e5"),k=t("4074"),S=t("27f9"),y=t("eebe"),C=t.n(y),$=Object(d["a"])(f,s,o,!1,null,null,null);i["default"]=$.exports;C()($,"components",{QPage:v["a"],QBtn:m["a"],QBreadcrumbs:p["a"],QBreadcrumbsEl:b["a"],QSelect:h["a"],QIcon:g["a"],QPopupProxy:O["a"],QDate:q["a"],QItem:x["a"],QItemSection:k["a"],QInput:S["a"]})}}]);