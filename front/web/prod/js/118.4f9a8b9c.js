(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[118],{fe0d:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"bg-grey-3"},[i("div",{staticClass:"q-pa-sm panel-header"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-sm-8"},[i("q-btn",{attrs:{color:"primary",icon:"keyboard_backspace",label:"Regresar"},on:{click:function(e){return t.backToGrid()}}}),i("span",{staticClass:"q-ml-md grey-8 fs28 page-title"},[t._v("Recepción MP "+t._s(this.$route.params.id))])],1),i("div",{staticClass:"col-sm-4"},[i("div",{staticClass:"q-pa-md q-gutter-sm"},[i("q-breadcrumbs",{attrs:{align:"right"}},[i("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),i("q-breadcrumbs-el",{attrs:{label:"Recepciones",to:"/raw-material-shipments"}}),i("q-breadcrumbs-el",{attrs:{label:"Nuevo"}})],1)],1)])])]),i("div",{staticClass:"q-pa-md bg-grey-3"},[i("div",{staticClass:"row bg-white border-panel"},[i("div",{staticClass:"col q-pa-md"},[i("div",{staticClass:"row q-col-gutter-xs"},[i("div",{staticClass:"col-xs-12 col-sm-3"},[i("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:t.supplierOptions,label:"Proveedor",disable:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"fas fa-building"}})]},proxy:!0}]),model:{value:t.rawMaterialShipment.fields.supplier,callback:function(e){t.$set(t.rawMaterialShipment.fields,"supplier",e)},expression:"rawMaterialShipment.fields.supplier"}})],1),i("div",{staticClass:"col-xs-12 col-sm-3"},[i("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:t.branchOfficeOptions,label:"Sucursal",disable:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"fas fa-store-alt"}})]},proxy:!0}]),model:{value:t.rawMaterialShipment.fields.branchOffice,callback:function(e){t.$set(t.rawMaterialShipment.fields,"branchOffice",e)},expression:"rawMaterialShipment.fields.branchOffice"}})],1),i("div",{staticClass:"col-xs-12 col-sm-4"},[i("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:t.storageOptions,label:"Almacén",disable:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}]),model:{value:t.rawMaterialShipment.fields.storage,callback:function(e){t.$set(t.rawMaterialShipment.fields,"storage",e)},expression:"rawMaterialShipment.fields.storage"}})],1),i("div",{staticClass:"col-xs-12 col-sm-2"},[i("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",label:"Estatus",disable:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"battery_full"}})]},proxy:!0}]),model:{value:t.rawMaterialShipment.fields.status,callback:function(e){t.$set(t.rawMaterialShipment.fields,"status",e)},expression:"rawMaterialShipment.fields.status"}})],1)]),i("div",{staticClass:"row q-mb-sm"},["NUEVO"==t.rawMaterialShipment.fields.status?i("div",{staticClass:"col-xs-12 col-sm-2 offset-sm-10 pull-right"},[i("q-btn",{staticStyle:{"margin-right":"5px"},attrs:{color:"warning",icon:"fas fa-bolt",label:"Ejecutar"},on:{click:function(e){return t.execute()}}})],1):t._e()])])])]),i("div",{staticClass:"bg-white border-panel"},[i("q-expansion-item",{staticStyle:{"font-weight":"bold","font-size":"large"},attrs:{label:"Detalles","expand-separator":"","default-opened":""}},[i("div",{staticStyle:{"font-weight":"normal"}},["NUEVO"==t.rawMaterialShipment.fields.status?i("div",{staticClass:"row q-col-gutter-xs",staticStyle:{"padding-right":"2%"}},[i("div",{staticClass:"col-xs-12 col-sm-4 offset-sm-8 pull-right"},[i("q-btn",{directives:[{name:"show",rawName:"v-show",value:null!=t.detail.fields.id,expression:"detail.fields.id != null"}],staticStyle:{"margin-right":"5px"},attrs:{color:"positive",icon:"save",label:"Actualizar"},on:{click:function(e){return t.updateDetail()}}}),i("q-btn",{directives:[{name:"show",rawName:"v-show",value:null!=t.detail.fields.id,expression:"detail.fields.id != null"}],staticStyle:{"margin-right":"5px"},attrs:{color:"negative",icon:"cancel",label:"Cancelar"},on:{click:function(e){return t.cancelEditDetail()}}}),i("q-btn",{directives:[{name:"show",rawName:"v-show",value:null==t.detail.fields.id,expression:"detail.fields.id == null"}],staticStyle:{"margin-right":"5px"},attrs:{color:"primary",icon:"add",label:"Agregar"},on:{click:function(e){return t.addDetail()}}})],1)]):t._e(),"NUEVO"==t.rawMaterialShipment.fields.status?i("div",{staticClass:"row q-col-gutter-xs",staticStyle:{padding:"2%"}},[i("div",{staticClass:"col-xs-12 col-sm-6"},[i("q-select",{ref:"detailFieldsProductRef",attrs:{color:"dark","bg-color":"secondary",filled:"",options:t.rawMaterialProductOptions,label:"Producto",rules:t.productRules},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"emoji_objects"}})]},proxy:!0}],null,!1,2431477873),model:{value:t.detail.fields.product,callback:function(e){t.$set(t.detail.fields,"product",e)},expression:"detail.fields.product"}})],1),i("div",{staticClass:"col-xs-12 col-sm-3"},[i("q-input",{ref:"detailFieldsQtyRef",attrs:{color:"dark","bg-color":"secondary",filled:"",error:t.$v.detail.fields.qty.$error,label:"Cantidad",rules:t.qtyRules,min:"1",suffix:"KG."},on:{input:function(e){t.detail.fields.qty=e.replace(/[^0-9\\.]/g,"")}},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"fas fa-weight-hanging"}})]},proxy:!0}],null,!1,1728068767),model:{value:t.detail.fields.qty,callback:function(e){t.$set(t.detail.fields,"qty",e)},expression:"detail.fields.qty"}})],1),i("div",{staticClass:"col-xs-12 col-sm-3"},[i("q-input",{ref:"detailFieldsQtyRef",attrs:{color:"dark","bg-color":"secondary",filled:"",error:t.$v.detail.fields.price.$error,label:"Precio por kilogramo",rules:t.priceRules,type:"number",min:"1"},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"attach_money"}})]},proxy:!0}],null,!1,2568092296),model:{value:t.detail.fields.price,callback:function(e){t.$set(t.detail.fields,"price",e)},expression:"detail.fields.price"}})],1)]):t._e(),i("div",{staticClass:"q-col-gutter-xs",staticStyle:{padding:"2%"}},[i("q-table",{attrs:{flat:"",bordered:"",data:t.details,columns:t.detailsColumns,"row-key":"name",pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[i("q-tr",{attrs:{props:e}},[i("q-td",{key:"product",staticStyle:{"text-align":"left",width:"45%"},attrs:{props:e}},[t._v(t._s(e.row.product))]),i("q-td",{key:"qty",staticStyle:{"text-align":"right",width:"15%"},attrs:{props:e}},[t._v(t._s(t.formatPrice(e.row.qty))+" KG.")]),i("q-td",{key:"unitPrice",staticStyle:{"text-align":"right",width:"15%"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.unit_price)))]),i("q-td",{key:"totalPrice",staticStyle:{"text-align":"right",width:"15%"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.total_price)))]),"NUEVO"==t.rawMaterialShipment.fields.status?i("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:e}},[i("q-btn",{attrs:{color:"primary",icon:"fas fa-edit",flat:"",size:"10px"},nativeOn:{click:function(i){return t.editDetail(e.row)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Editar")])],1),i("q-btn",{attrs:{color:"primary",icon:"fas fa-trash-alt",flat:"",size:"10px"},nativeOn:{click:function(i){return t.removeDetail(e.row.id)}}},[i("q-tooltip",{attrs:{"content-class":"bg-red"}},[t._v("Eliminar")])],1)],1):i("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:e}},[t._v("\n                    -\n                  ")])],1)]}}])})],1)])])],1)])},r=[],l=i("ded3"),s=i.n(l),n=(i("ac1f"),i("5319"),i("b680"),i("d3b7"),i("25f0"),i("a9e3"),i("aabb")),o=i("b5ae"),d=o.required,c=o.decimal,u={name:"EditRawMaterialShipment",validations:{detail:{fields:{product:{required:d},qty:{required:d,decimal:c},price:{required:d,decimal:c}}}},data:function(){return{formatter:new Intl.NumberFormat("en-US"),currencyFormatter:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),rawMaterialShipment:{fields:{supplier:null,branchOffice:null,storage:null,status:null}},supplierOptions:[],branchOfficeOptions:[],storageOptions:[],detail:{fields:{id:null,product:null,qty:null,price:null}},detailIdToEdit:null,rawMaterialProductOptions:[],details:[],detailsColumns:[{name:"product",align:"center",label:"Producto",field:"product",style:"width: 45%",sortable:!0},{name:"qty",align:"center",label:"Cantidad",field:"qty",style:"width: 15%",sortable:!0},{name:"unitPrice",align:"center",label:"Precio unitario",field:"unitPrice",style:"width: 15%",sortable:!0},{name:"totalPrice",align:"center",label:"Importe",field:"totalPrice",style:"width: 15%",sortable:!0},{name:"actions",align:"center",label:"Acciones",field:"actions",style:"width: 10%",sortable:!1}],pagination:{rowsPerPage:50}}},computed:{productRules:function(t){var e=this;return[function(t){return e.$v.detail.fields.product.required||"El campo Producto es requerido."}]},qtyRules:function(t){var e=this;return[function(t){return e.$v.detail.fields.qty.required||"El campo Cantidad es requerido."},function(t){return e.$v.detail.fields.qty.decimal||"El campo Cantidad debe ser numérico."}]},priceRules:function(t){var e=this;return[function(t){return e.$v.detail.fields.price.required||"El campo Precio por kilogramo es requerido."},function(t){return e.$v.detail.fields.price.decimal||"El campo Precio por kilogramo debe ser numérico."}]}},beforeRouteEnter:function(t,e,i){i((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||3===e||7===e||2===e||20===e||4===e||27===e||22===e?i():i("/")}))},created:function(){this.fetchFromServer()},methods:{formatPrice:function(t){var e=(t/1).toFixed(1).replace(".",",");return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},fetchFromServer:function(){var t=this;n["a"].get("/raw-material-shipments/".concat(this.$route.params.id)).then((function(e){var i=e.data;i.shipment?(t.$q.loading.show(),t.rawMaterialShipment.fields.supplier={value:i.shipment.supplier_id,label:i.shipment.supplier},t.rawMaterialShipment.fields.branchOffice={value:i.shipment.branch_office_id,label:i.shipment.branch_office},t.rawMaterialShipment.fields.storage={value:i.shipment.storage_id,label:i.shipment.storage},t.rawMaterialShipment.fields.status=i.shipment.status,n["a"].get("/suppliers/options").then((function(e){var i=e.data;t.supplierOptions=i.options,n["a"].get("/branch-offices/options").then((function(e){var i=e.data;t.branchOfficeOptions=i.options,n["a"].get("/storages/options").then((function(e){var i=e.data;t.storageOptions=i.options,n["a"].get("/products/options/category/14").then((function(e){var i=e.data;t.rawMaterialProductOptions=i.options,n["a"].get("/raw-material-shipments-details/raw-material-shipment/".concat(t.$route.params.id)).then((function(e){var i=e.data;t.details=i.details,t.$q.loading.hide()}))}))}))}))}))):t.$router.push("/")}))},backToGrid:function(){this.$router.push("/raw-material-shipments")},execute:function(){var t=this;this.$q.loading.show(),n["a"].put("/raw-material-shipments/".concat(this.$route.params.id,"/execute"),[]).then((function(e){var i=e.data;t.$q.notify({message:i.message.content,position:"top",color:i.result?"positive":"warning"}),i.result?(t.$q.loading.hide(),t.fetchFromServer()):t.$q.loading.hide()}))},updateDetail:function(){var t=this;if(this.$v.detail.fields.$reset(),this.$v.detail.fields.$touch(),this.$v.detail.fields.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;this.$q.loading.show();var e=[];e.id=Number(s()({},this.detail.fields).id),e.rawMaterialShipmentId=Number(this.$route.params.id),e.productId=Number(s()({},this.detail.fields).product.value),e.qty=Number(s()({},this.detail.fields).qty),e.unitPrice=Number(s()({},this.detail.fields).price),this.detail.fields.id=null,this.detail.fields.product=null,this.detail.fields.qty=null,this.detail.fields.price=null,n["a"].put("/raw-material-shipments-details/".concat(e.id),e).then((function(e){var i=e.data;t.$q.notify({message:i.message.content,position:"top",color:i.result?"positive":"warning"}),i.result?n["a"].get("/raw-material-shipments-details/raw-material-shipment/".concat(t.$route.params.id)).then((function(e){var i=e.data;t.details=i.details,t.$q.loading.hide()})):t.$q.loading.hide()}))},cancelEditDetail:function(){this.detail.fields.id=null,this.detail.fields.product=null,this.detail.fields.qty=null,this.detail.fields.price=null},addDetail:function(){var t=this;if(this.$v.detail.fields.$reset(),this.$v.detail.fields.$touch(),this.$v.detail.fields.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;this.$q.loading.show();var e=[];e.rawMaterialShipmentId=Number(this.$route.params.id),e.productId=Number(s()({},this.detail.fields).product.value),e.qty=Number(s()({},this.detail.fields).qty),e.unitPrice=Number(s()({},this.detail.fields).price),this.detail.fields.product=null,this.detail.fields.qty=null,this.detail.fields.price=null,n["a"].post("/raw-material-shipments-details",e).then((function(e){var i=e.data;t.$q.notify({message:i.message.content,position:"top",color:i.result?"positive":"warning"}),i.result?n["a"].get("/raw-material-shipments-details/raw-material-shipment/".concat(t.$route.params.id)).then((function(e){var i=e.data;t.details=i.details,t.$q.loading.hide()})):t.$q.loading.hide()}))},editDetail:function(t){this.detail.fields.id=t.id,this.detail.fields.product={value:t.product_id,label:t.product},this.detail.fields.qty=t.qty,this.detail.fields.price=t.unit_price},removeDetail:function(t){var e=this;this.$q.loading.show(),n["a"].delete("/raw-material-shipments-details/".concat(t)).then((function(t){var i=t.data;e.$q.notify({message:i.message.content,position:"top",color:i.result?"positive":"warning"}),i.result?n["a"].get("/raw-material-shipments-details/raw-material-shipment/".concat(e.$route.params.id)).then((function(t){var i=t.data;e.details=i.details,e.$q.loading.hide()})):e.$q.loading.hide()}))}}},p=u,f=i("2877"),m=i("9989"),h=i("9c40"),g=i("ead5"),b=i("079e"),v=i("ddd8"),q=i("0016"),w=i("27f9"),y=i("3b73"),$=i("eaac"),S=i("bd08"),x=i("db86"),k=i("05c0"),_=i("eebe"),C=i.n(_),M=Object(f["a"])(p,a,r,!1,null,null,null);e["default"]=M.exports;C()(M,"components",{QPage:m["a"],QBtn:h["a"],QBreadcrumbs:g["a"],QBreadcrumbsEl:b["a"],QSelect:v["a"],QIcon:q["a"],QInput:w["a"],QExpansionItem:y["a"],QTable:$["a"],QTr:S["a"],QTd:x["a"],QTooltip:k["a"]})}}]);