(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{5012:function(t,e,a){},"84ed":function(t,e,a){"use strict";a("5012")},fd58:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"bg-grey-3"},[a("div",{staticClass:"q-pa-sm panel-header"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-8"},[a("div",{staticClass:"q-pa-md q-gutter-sm"},[a("q-breadcrumbs",{staticStyle:{"font-size":"20px"},attrs:{align:"left"}},[a("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),a("q-breadcrumbs-el",{attrs:{label:"Cuentas por pagar"}})],1)],1)]),a("div",{staticClass:"col-sm-4 pull-right"},[a("div",{staticClass:"col-xs-12 col-md-4 offset-md-10"},[a("div",[a("q-btn",{staticClass:"q-mr-md q-mt-md",attrs:{color:"red",icon:"fas fa-file-pdf"},on:{click:function(e){return t.generatePDF()}}},[a("q-tooltip",[t._v("GENERAR PDF")])],1)],1)])])])]),a("div",{staticClass:"q-pa-md bg-grey-3"},[a("div",{staticClass:"row bg-white border-panel"},[a("div",{staticClass:"col q-pa-md"},[a("div",{staticClass:"row q-col-gutter-xs q-col-gutter-md"},[a("div",{staticClass:"col-md-4"}),a("div",{staticClass:"col-md-2"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",mask:"date",label:"Desde"},model:{value:t.saleDatev1,callback:function(e){t.saleDatev1=e},expression:"saleDatev1"}},[a("q-popup-proxy",{ref:"date",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("div",{staticClass:"col-sm-12"},[a("q-date",{attrs:{"today-btn":""},on:{input:function(e){return t.filterGrid()}},model:{value:t.saleDatev1,callback:function(e){t.saleDatev1=e},expression:"saleDatev1"}})],1)])],1)],1),a("div",{staticClass:"col-md-2"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",mask:"date",label:"Hasta"},model:{value:t.saleDatev2,callback:function(e){t.saleDatev2=e},expression:"saleDatev2"}},[a("q-popup-proxy",{ref:"date",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("div",{staticClass:"col-sm-12"},[a("q-date",{attrs:{"today-btn":""},on:{input:function(e){return t.filterGrid()}},model:{value:t.saleDatev2,callback:function(e){t.saleDatev2=e},expression:"saleDatev2"}})],1)])],1)],1),a("div",{staticClass:"col-md-2"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:[{label:"PENDIENTE",value:0},{label:"ABONADO",value:1},{label:"PAGADO",value:2}],"emit-value":"","map-options":"",multiple:"",label:"Estatus"},on:{input:function(e){return t.filterGrid()}},scopedSlots:t._u([{key:"option",fn:function(e){var o=e.itemProps,n=e.itemEvents,i=e.opt,s=e.selected,r=e.toggleOption;return[a("q-item",t._g(t._b({},"q-item",o,!1),n),[a("q-item-section",[a("q-item-label",{domProps:{innerHTML:t._s(i.label)}})],1),a("q-item-section",{attrs:{side:""}},[a("q-toggle",{attrs:{value:s},on:{input:function(t){return r(i)}}})],1)],1)]}}]),model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1),a("div",{staticClass:"col-md-2"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:t.filteredSupplierOptions,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Proveedor","emit-value":"","map-options":""},on:{filter:t.filterSuppliers,input:function(e){return t.filterGrid()}},model:{value:t.supplier,callback:function(e){t.supplier=e},expression:"supplier"}})],1)]),a("div",{staticClass:"row bg-white"},[a("div",{staticClass:"col q-pa-md"},[a("q-table",{attrs:{flat:"",bordered:"",data:t.data,columns:t.columns,"row-key":"order_date",pagination:t.pagination,filter:t.filter},on:{"update:pagination":function(e){t.pagination=e},request:t.qTableRequest},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticStyle:{width:"100%"}},[a("q-input",{attrs:{dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})],1)]},proxy:!0},{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"serial",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",{staticStyle:{"text-decoration":"underline black",cursor:"pointer"},on:{click:function(a){return t.openActions(e.row.id)}}},[t._v(t._s(e.row.serial))])]),a("q-td",{key:"actions",attrs:{props:e}},["PEDIDO"!=e.row.status&&"PARCIAL"!=e.row.status&&"RECIBIDO"!=e.row.status||null===e.row.invoice_date?a("q-btn",{attrs:{color:"red",icon:"attach_money",flat:"",disable:"",size:"10px"},nativeOn:{click:function(a){return t.openPaymentModal(e.row.id,e.row.status,e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-red"}},[t._v("Agregar fecha de factura")])],1):a("q-btn",{attrs:{color:"primary",icon:"attach_money",flat:"",size:"10px"},nativeOn:{click:function(a){return t.openPaymentModal(e.row.id,e.row.status,e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Agregar pago")])],1)],1),a("q-td",{key:"invoice",attrs:{props:e}},[t._v(t._s(e.row.reference))]),a("q-td",{key:"status_payment",attrs:{props:e}},[a("q-chip",{attrs:{square:"",dense:"",color:t.colorPayment[e.row.status_payment],"text-color":"white"}},[t._v(t._s(t.statusPayment[e.row.status_payment]))])],1),a("q-td",{key:"invoice_date",attrs:{props:e}},[t._v(t._s(e.row.invoice_date))]),a("q-td",{key:"requested_date",staticStyle:{"text-align":"center"},attrs:{props:e}},[t._v(t._s(e.row.requested_date))]),a("q-td",{key:"expiration",staticStyle:{"text-align":"center"},attrs:{props:e}},[t._v(t._s(e.row.expiration))]),a("q-td",{key:"supplier",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.supplier))]),a("q-td",{key:"totalamount",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.totalamount)))]),a("q-td",{key:"abonado",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.abonado)))]),a("q-td",{key:"restante",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.restante)))])],1)]}}])})],1)])])])]),a("q-dialog",{model:{value:t.paymentsModal,callback:function(e){t.paymentsModal=e},expression:"paymentsModal"}},[a("q-card",{staticClass:"col-sm-12 col-xs-12",staticStyle:{"max-width":"1000px"}},[a("div",[a("div",{staticClass:"bg-primary"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-11 text-h6",staticStyle:{color:"white","padding-top":"5px","padding-bottom":"5px"}},[t._v("  Abonos Orden de compra "+t._s(t.po_serial))]),a("div",{staticClass:"col-sm-1 pull-right",staticStyle:{color:"white","padding-top":"5px","padding-bottom":"5px"}},[a("q-btn",{attrs:{color:"white",flat:"",round:"",dense:"",icon:"close"},nativeOn:{click:function(e){return t.closeModal()}}})],1)])]),a("div",{staticClass:"row q-col-gutter-md q-pa-md"},[a("div",{staticClass:"col-xs-12 col-md-4"},[a("q-input",{attrs:{color:"dark","bg-color":"green-3",filled:"",readonly:"",label:"Total del pedido"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"fas fa-dollar-sign"}})]},proxy:!0}]),model:{value:t.totalAmount,callback:function(e){t.totalAmount=e},expression:"totalAmount"}})],1),a("div",{staticClass:"col-xs-12 col-md-4"},[a("q-input",{attrs:{color:"dark","bg-color":"orange-3",filled:"",readonly:"",label:"Monto abonado"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"fas fa-dollar-sign"}})]},proxy:!0}]),model:{value:t.abonadoAmount,callback:function(e){t.abonadoAmount=e},expression:"abonadoAmount"}})],1),a("div",{staticClass:"col-xs-12 col-md-4"},[a("q-input",{attrs:{color:"dark","bg-color":"blue-3",filled:"",readonly:"",label:"Monto restante"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"fas fa-dollar-sign"}})]},proxy:!0}]),model:{value:t.restanteAmount,callback:function(e){t.restanteAmount=e},expression:"restanteAmount"}})],1)]),a("q-separator"),a("div",{staticClass:"row q-col-gutter-x-sm q-col-gutter-y-xs q-px-md"},[a("div",{staticClass:"col-md-4 col-xs-6 col-lg-3"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",rules:t.paymentDateRules,error:t.$v.paymentDate.$error,mask:"DD/MM/YYYY",label:"Fecha de pago"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"event"}})]},proxy:!0}]),model:{value:t.paymentDate,callback:function(e){t.paymentDate=e},expression:"paymentDate"}},[a("q-popup-proxy",{ref:"paymentDate",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("div",{staticClass:"col-sm-12 col-xs-6"},[a("q-date",{attrs:{locale:t.myLocale,mask:"DD/MM/YYYY","today-btn":""},on:{input:function(){return t.$refs.paymentDate.hide()}},model:{value:t.paymentDate,callback:function(e){t.paymentDate=e},expression:"paymentDate"}})],1)])],1)],1),a("div",{staticClass:"col-md-4 col-xs-6 col-lg-3"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"","map-options":"",rules:t.paymentMethodRules,error:t.$v.paymentMethod.$error,label:"Forma de pago",options:t.filteredformaPagoOptions,"use-input":"","input-debounce":"0"},on:{filter:t.filterPaymentMethods},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"fas fa-file-invoice"}})]},proxy:!0}]),model:{value:t.paymentMethod,callback:function(e){t.paymentMethod=e},expression:"paymentMethod"}})],1),a("div",{staticClass:"col-md-4 col-xs-6 col-lg-3"},[a("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",rules:t.paymentQtyRules,error:t.$v.qty.$error,label:"Monto a pagar"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"fas fa-dollar-sign"}})]},proxy:!0}]),model:{value:t.qty,callback:function(e){t.qty=e},expression:"qty"}})],1),a("div",{staticClass:"col-md-4 col-xs-6 col-lg-3"},[a("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",label:"Referencia"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"fas fa-signature"}})]},proxy:!0}]),model:{value:t.reference,callback:function(e){t.reference=e},expression:"reference"}})],1),a("div",{staticClass:"col-md-8 col-sm-12 col-xs-12 pull-left"},[a("q-btn",{attrs:{icon:"fas fa-credit-card",disable:t.disableBtnAddPayment,color:"positive",label:"Agregar Pago"},on:{click:function(e){return t.addPayment()}}})],1)]),t.disableTblPayments?a("div",{staticClass:"row"},[t.tableWithoutInvoice?a("div",{staticClass:"col q-pa-md",staticStyle:{"overflow-y":"auto"}},[a("q-table",{attrs:{id:"newstyle",color:"primary",data:t.dataPayments,columns:t.columnsPaymentsWithoutInvoice,"row-key":"sale_date",pagination:t.paginationPayments},on:{"update:pagination":function(e){t.paginationPayments=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"payment_date",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.payment_date))])]),a("q-td",{key:"method",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.method_label))])]),a("q-td",{key:"amount",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.amount)))]),a("q-td",{key:"reference",staticStyle:{"text-align":"left"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.reference))])]),a("q-td",{key:"actions",staticStyle:{"text-align":"center"},attrs:{props:e}},[null===e.row.document_id?a("q-btn",{attrs:{color:"green",icon:"fas fa-cloud-upload-alt",flat:"",size:"10px"},nativeOn:{click:function(a){return t.uploadFile(e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-green"}},[t._v("Subir referencia de pago")])],1):t._e(),null!==e.row.document_id?a("q-btn",{attrs:{color:"blue",icon:"fas fa-eye",flat:"",size:"10px"}},[a("q-menu",[a("q-list",{staticClass:"scroll",staticStyle:{"min-width":"100px"},attrs:{link:"",separator:""}},[a("q-item",{attrs:{clickable:!0},nativeOn:{click:function(a){return t.showDocumentFile(e.row)}}},[a("q-item-section",[t._v("Ver")])],1),a("q-item",{attrs:{clickable:!0},nativeOn:{click:function(a){return t.downloadDocumentFile(e.row)}}},[a("q-item-section",[t._v("Descargar")])],1),a("q-item",{attrs:{clickable:!0},nativeOn:{click:function(a){return t.deleteFilePayment(e.row)}}},[a("q-item-section",[t._v("Eliminar")])],1)],1)],1)],1):t._e(),a("q-btn",{attrs:{color:"negative",icon:"delete",flat:"",size:"10px"},nativeOn:{click:function(a){return t.deletePayment(e.row.id,e.row.po_id)}}},[a("q-tooltip",{attrs:{"content-class":"negative"}},[t._v("Eliminar pago")])],1)],1)],1)]}}],null,!1,1870192849)})],1):t._e(),t.tableWithInvoice?a("div",{staticClass:"col q-pa-md",staticStyle:{"overflow-y":"auto"}},[a("q-table",{attrs:{id:"newstyle",color:"primary",data:t.dataPayments,columns:t.columnsPaymentsWithInvoice,"row-key":"sale_date",pagination:t.paginationPayments},on:{"update:pagination":function(e){t.paginationPayments=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"num_parcialidad",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.num_parcialidad))])]),a("q-td",{key:"payment_date",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.payment_date))])]),a("q-td",{key:"method",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.method_label))])]),a("q-td",{key:"amount",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.amount)))]),a("q-td",{key:"reference",staticStyle:{"text-align":"left"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.reference))])]),a("q-td",{key:"status_timbrado",attrs:{props:e}},[a("q-chip",{attrs:{dense:"",icon:t.iconTimbrado[e.row.status_timbrado],color:t.colorTimbrado[e.row.status_timbrado],"text-color":"white"}},[t._v(t._s(t.statusTimbrado[e.row.status_timbrado])),6===e.row.status_timbrado?a("q-tooltip",[t._v(t._s(e.row.message))]):t._e(),7===e.row.status_timbrado?a("q-tooltip",[t._v(t._s(e.row.message_cancelacion))]):t._e()],1)],1),a("q-td",{key:"actions",staticStyle:{"text-align":"center"},attrs:{props:e}},[""!==e.row.file?a("q-btn",{attrs:{color:"green",icon:"fas fa-download",flat:"",size:"10px"},nativeOn:{click:function(a){return t.getFile(e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-green"}},[t._v("Descargar")])],1):t._e(),0===e.row.status_timbrado||6===e.row.status_timbrado?a("q-btn",{attrs:{small:"",flat:"",color:"green-6",icon:"fas fa-certificate"},on:{click:function(a){return t.timbrarPago(e.row)}}},[a("q-tooltip",[t._v("Timbrar")])],1):t._e(),1===e.row.status_timbrado?a("q-btn",{staticClass:"pull-right",attrs:{small:"",flat:"",color:"brown","icon-right":"fas fa-file-pdf"},on:{click:function(a){return t.getPdfInvoice(e.row.id_request)}}},[a("q-tooltip",[t._v("PDF")])],1):t._e(),1===e.row.status_timbrado?a("q-btn",{staticClass:"pull-right",attrs:{small:"",flat:"",color:"green-8","icon-right":"fas fa-file-excel"},on:{click:function(a){return t.getCFDIInvoice(e.row.id_request)}}},[a("q-tooltip",[t._v("XML")])],1):t._e(),1===e.row.status_timbrado?a("q-btn",{staticClass:"pull-right",attrs:{small:"",flat:"",color:"red-9","icon-right":"cancel"},on:{click:function(a){return t.cancelarPago(e.row)}}},[a("q-tooltip",[t._v("Cancelar")])],1):t._e(),1!==e.row.status_timbrado&&3!==e.row.status_timbrado&&4!==e.row.status_timbrado&&5!==e.row.status_timbrado?a("q-btn",{attrs:{color:"negative",icon:"delete",flat:"",size:"10px"},nativeOn:{click:function(a){return t.deletePayment(e.row.id,e.row.remision_id)}}},[a("q-tooltip",{attrs:{"content-class":"negative"}},[t._v("Eliminar pago")])],1):t._e()],1)],1)]}}],null,!1,1645513779)})],1):t._e()]):a("div",{staticClass:"row",staticStyle:{"margin-top":"15px"}},[a("div",{staticClass:"col-md-12 col-lg-12"},[a("label",{staticStyle:{"margin-left":"35%"}},[t._v("No hay pagos registrados para esta remision.")])])])],1),a("q-card-actions",{attrs:{align:"right"}},[a("br")])],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.modalUploadFile,callback:function(e){t.modalUploadFile=e},expression:"modalUploadFile"}},[a("q-card",[a("q-card-section",{staticClass:"row"},[a("div",{staticClass:"col-xs-12 col-sm-10 text-h6"},[t._v("Subir archivo")]),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col-xs-12 col-sm-2 pull-right",attrs:{icon:"close",flat:"",round:"",dense:""}})],1),a("q-card-section",[a("q-uploader",{ref:"fileDocumentRef",attrs:{url:t.fileDocumentUrl,headers:[{name:"Authorization",value:t.token}],method:"POST","hide-upload-btn":""},on:{uploaded:t.afterUploadDocumentFile}})],1),a("q-card-actions",{staticClass:"text-secondary",attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"Subir archivo"},on:{click:function(e){return t.uploadDocumentFileRFP()}}})],1)],1)],1)],1)},n=[],i=a("7ec2"),s=a.n(i),r=a("c973"),l=a.n(r),c=(a("ac1f"),a("1276"),a("99af"),a("d3b7"),a("159b"),a("a9e3"),a("caad"),a("2532"),a("e260"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("4de4"),a("a15b"),a("b680"),a("5319"),a("aabb")),u=a("b5ae"),d=u.required,p=u.decimal,m=u.requiredIf,f={name:"IndexStorageExits",validations:{paymentMethod:{required:d},paymentDate:{required:d},qty:{required:d,decimal:p},account:{required:m((function(){return 1===this.bankRequired}))},output:{required:m((function(){return 1===this.bankRequired}))}},data:function(){return{info:{image:[]},idPo:null,refPay:null,modalUploadFile:!1,accountOptions:[],outputOptions:[],filteredOutputOptions:[],documentFileModal:!1,documentName:null,documentId:null,myLocale:{days:"Domingo_Lunes_Martes_Miércoles_Jueves_Viernes_Sábado".split("_"),daysShort:"Dom_Lun_Mar_Mié_Jue_Vie_Sáb".split("_"),months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),monthsShort:"Ene_Feb_Mar_Abr_May_Jun_Jul_Ago_Sep_Oct_Nov_Dic".split("_"),firstDayOfWeek:1},currencyFormatter:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),formatter:new Intl.NumberFormat("en-US"),role:null,tableWithInvoice:!1,tableWithoutInvoice:!0,interval:null,supplier:"TODOS",disableBtnAddPayment:!0,disableTblPayments:!0,qty:null,file:null,bank:null,paymentDate:null,paymentMethod:null,status:[],reference:null,output:null,account:null,total_invoice:null,id_po:null,po_serial:null,paymentsModal:!1,saleDatev1:null,saleDatev2:null,supplierOptions:[],bankOptions:[],filteredSupplierOptions:[],formaPagoOptions:[],filteredformaPagoOptions:[],pagination:{sortBy:"id",descending:!0,page:1,rowsNumber:0,rowsPerPage:25},columns:[{name:"serial",align:"center",label:"FOLIO",field:"serial",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",sortable:!1},{name:"invoice",align:"center",label:"# REFERENCIA/FACTURA",field:"invoice",sortable:!0},{name:"status_payment",align:"center",label:"ESTATUS",field:"status_payment",sortable:!0},{name:"invoice_date",align:"center",label:"FACTURA",field:"invoice_date",sortable:!0},{name:"requested_date",align:"center",label:"ARRIBO",field:"requested_date",sortable:!0},{name:"expiration",align:"center",label:"VENCIMIENTO",field:"expiration",sortable:!0},{name:"supplier",align:"center",label:"PROVEEDOR",field:"supplier",sortable:!0},{name:"totalamount",align:"center",label:"MONTO TOTAL",field:"totalamount",sortable:!0},{name:"abonado",align:"center",label:"ABONADO",field:"abonado",sortable:!0},{name:"restante",align:"center",label:"RESTANTE",field:"restante",sortable:!0}],data:[],filter:"",paginationPayments:{rowsPerPage:50},columnsPaymentsWithInvoice:[{name:"num_parcialidad",align:"center",label:"#",field:"num_parcialidad",sortable:!0},{name:"payment_date",align:"center",label:"FECHA",field:"payment_date",sortable:!0},{name:"method",align:"center",label:"FORMA",field:"method",sortable:!0},{name:"amount",align:"center",label:"CANTIDAD",field:"amount",sortable:!0},{name:"reference",align:"center",label:"REFERENCIA",field:"reference",sortable:!0},{name:"status_timbrado",align:"center",label:"ESTATUS",field:"status_timbrado",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",sortable:!1}],columnsPaymentsWithoutInvoice:[{name:"payment_date",align:"center",label:"FECHA DE PAGO",field:"payment_date",sortable:!0},{name:"method",align:"center",label:"FORMA DE PAGO",field:"method",sortable:!0},{name:"amount",align:"center",label:"CANTIDAD",field:"amount",sortable:!0},{name:"reference",align:"center",label:"REFERENCIA",field:"reference",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",sortable:!1}],dataPayments:[],fiberSaleDocumentFile:{fields:{fiberSaleId:null}},bankRequired:1,fiberSaleDocumentFileModal:!1,serverUrl:"https://api_alpez.wasp.mx/",statusTimbrado:["Nuevo","Timbrado","Cancelado","Cancelando","Timbrando","Cancelando","Error","Error al cancelar"],colorTimbrado:["blue-6","green-6","purple-6","warning","warning","warning","red-6","red-6"],statusPayment:["PENDIENTE DE PAGO","ABONADO","PAGADO"],colorPayment:["blue-6","warning","green-6"],iconTimbrado:["add","done","cancel","fas fa-ellipsis-h","fas fa-ellipsis-h","fas fa-ellipsis-h","cancel","cancel"]}},computed:{roleId:function(){var t=this.$store.getters["users/rol"];return parseInt(t)},token:function(){var t="Bearer "+localStorage.getItem("JWT");return t},abonadoAmount:function(){var t=0;return null!=this.totalAmounfromPayments&&(t=this.totalAmounfromPayments),this.currencyFormatter.format(t)},restanteAmount:function(){var t=0;return null!=this.total_invoice&&null!=this.totalAmounfromPayments&&(t=this.total_invoice-this.totalAmounfromPayments),this.currencyFormatter.format(t)},totalAmount:function(){var t=0;return null!=this.total_invoice&&(t=this.total_invoice),this.currencyFormatter.format(t)},JWT:function(){return localStorage.getItem("JWT")},fileDocumentUrl:function(){return"".concat("https://api_alpez.wasp.mx/","purchase-orders/uploadPaymentFile/").concat(this.refPay)},accountRules:function(t){var e=this;return[function(t){return e.$v.account.required||"El campo Cuenta es requerido."}]},outputRules:function(t){var e=this;return[function(t){return e.$v.output.required||"El campo Rubro es requerido."}]},paymentMethodRules:function(t){var e=this;return[function(t){return e.$v.paymentMethod.required||"El campo Forma de pago es requerido."}]},bankRules:function(t){var e=this;return[function(t){return e.$v.bank.required||"El campo Banco es requerido."}]},paymentDateRules:function(t){var e=this;return[function(t){return e.$v.paymentDate.required||"El campo Fecha de pago es requerido."}]},paymentQtyRules:function(t){var e=this;return[function(t){return e.$v.qty.required||"El campo Monto a pagar es requerido."},function(t){return e.$v.qty.decimal||"El campo Monto a pagar debe ser númerico."}]},fiberSaleDocumentFileUrl:function(){return"".concat("https://api_alpez.wasp.mx/","invoices/").concat(this.fiberSaleDocumentFile.fields.fiberSaleId,"/document-file")},totalAmounfromPayments:function(){var t=0;return this.dataPayments.forEach((function(e){t+=Number(e.amount)})),t},haspermissionv1:function(){var t=!1;return(this.$store.getters["users/roles"].includes(1)||this.$store.getters["users/roles"].includes(3)||this.$store.getters["users/roles"].includes(7)||this.$store.getters["users/roles"].includes(17)||this.$store.getters["users/roles"].includes(18))&&(t=!0),t}},beforeRouteEnter:function(t,e,a){a((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||3===e||7===e||2===e||20===e||4===e||27===e||17===e||22===e|29===e|28===e|25===e?a():a("/")}))},mounted:function(){var t=this;return l()(s()().mark((function e(){return s()().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getClients();case 2:return e.next=4,t.fetchFromServer();case 4:case"end":return e.stop()}}),e)})))()},methods:{deleteFilePayment:function(t){var e=this;c["a"].put("/purchase-orders/deleteFilePayment/".concat(t.id)).then((function(t){var a=t.data;a.result&&e.getPayments(e.idPo),e.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"})}))},showDocumentFile:function(t){var e=this;this.$q.loading.show(),this.seeImage=!0,c["a"].fileDownload("/documents/getfile/".concat(t.document_id)).then((function(a){var o=a.data;e.info.image=o,console.log(o);var n=window.URL.createObjectURL(new Blob([o],{type:t.mimetype}));console.log("aaa"),console.log(n),window.open(n,"_blank"),e.$q.loading.hide()})),this.info.image=null},downloadDocumentFile:function(t){var e=this;this.$q.loading.show(),c["a"].fileDownload("/documents/getfile/".concat(t.document_id)).then((function(a){var o=a.data;e.$q.loading.hide(),e.info.image=o;var n=window.URL.createObjectURL(new Blob([o],{type:t.mimetype})),i=document.createElement("a");i.href=n,i.setAttribute("download",t.filename),document.body.appendChild(i),i.click()}))},showDocumentFilePallet:function(t){var e=this;c["a"].get("documents/getDocumentOfPay/".concat(t.document_id)).then((function(t){var a=t.data;a.result&&window.open("".concat(e.serverUrl,"public/assets/documentspay/").concat(a.documents[0].id),"_blank")}))},uploadDocumentFileRFP:function(){this.$refs.fileDocumentRef.upload()},openMovement:function(t){this.$router.push("trade-movements/".concat(t))},filterPaymentMethods:function(t,e,a){var o=this;e((function(){var e=t.toLowerCase();o.filteredformaPagoOptions=o.formaPagoOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1&&"TODOS"!==t.label}))}))},filterOutputs:function(t,e,a){var o=this;e((function(){var e=t.toLowerCase();o.filteredOutputOptions=o.outputOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1&&"TODOS"!==t.label}))}))},getAccount:function(){var t=this;this.$q.loading.show(),c["a"].get("/account-trade/options").then((function(e){var a=e.data;t.accountOptions=a.options,t.$q.loading.hide()}))},getOutputs:function(){var t=this;this.$q.loading.show(),c["a"].get("/output_type/options").then((function(e){var a=e.data;t.outputOptions=a.options,t.$q.loading.hide()}))},openUploadFileModal:function(){this.documentFileModal=!0},afterUploadDocumentFile:function(t){var e=JSON.parse(t.xhr.response);this.$q.notify({message:e.message.content,position:"top",color:e.result?"positive":"warning"}),e.result&&(this.modalUploadFile=!1,this.getPayments(this.idPo))},invertDate:function(t){if(null!==t)var e=t.split("/").reverse().join("-");return e},fetchFromServer:function(){this.$q.loading.show(),this.qTableRequest({pagination:this.pagination,filter:this.filter})},qTableRequest:function(t){var e=this;return l()(s()().mark((function a(){var o;return s()().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.pagination=t.pagination,e.filter=t.filter,e.data=[],o=[],o.supplier=e.supplier,o.status=e.status,o.saleDatev1=e.saleDatev1,o.saleDatev2=e.saleDatev2,o.type=0,o.pagination=e.pagination,o.filter=e.filter,a.next=13,c["a"].post("/purchase-orders/getPurchaseGridPayments",o).then((function(t){var a=t.data;e.$q.loading.hide(),console.log(a),e.data=a.purchases,e.pagination.rowsNumber=a.purchasesCount})).catch((function(t){return t}));case 13:case"end":return a.stop()}}),a)})))()},getClients:function(){var t=this;c["a"].get("/suppliers/options").then((function(e){var a=e.data;t.supplierOptions=a.options,t.supplierOptions.unshift({label:"TODOS",value:"TODOS"})}))},getBanks:function(){var t=this;c["a"].get("/bank-accounts/options").then((function(e){var a=e.data;t.bankOptions=a.options}))},getPayments:function(t){var e=this,a=[];a.id=this.id_po,c["a"].get("/invoices/formaPagoOptions").then((function(t){var o=t.data;e.formaPagoOptions=o.options,c["a"].post("/purchase-orders/dataFromPurchaseOrder",a).then((function(t){var a=t.data;if(a.result)if(console.log("data"),console.log(a),e.total_invoice=parseFloat(a.total_amount),e.dataPayments=a.payments,console.log(e.dataPayments),e.account=a.account,e.dataPayments.length>0){e.disableTblPayments=!0;var o=parseFloat(e.totalAmounfromPayments),n=parseFloat(e.total_invoice.toFixed(2));n>o&&(e.disableBtnAddPayment=!1,e.fetchFromServer())}else e.disableTblPayments=!1}))}))},filterGrid:function(){var t=this;this.data=[];var e=[];e.supplier=this.supplier,e.status=this.status,e.saleDatev1=this.saleDatev1,e.saleDatev2=this.saleDatev2,e.type=0,e.pagination=this.pagination,e.filter=this.filter,c["a"].post("/purchase-orders/getGridPayments",e).then((function(e){var a=e.data;a.result&&(console.log(a),t.data=a.purchases,t.pagination.rowsNumber=a.purchasesCount)}))},filterSuppliers:function(t,e,a){var o=this;e((function(){var e=t.toLowerCase();o.filteredSupplierOptions=o.supplierOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},openPaymentModal:function(t,e,a){2===a.status_payment?this.disableBtnAddPayment=!0:this.disableBtnAddPayment=!1,1===a.status_timbrado&&"PPD"===a.metodo_pago?(this.tableWithInvoice=!0,this.tableWithoutInvoice=!1):(this.tableWithInvoice=!1,this.tableWithoutInvoice=!0),this.cleanFields(),this.id_po=null,this.id_po=t,this.po_serial=a.serial,this.getPayments(this.id_po),this.paymentsModal=!0},addPayment:function(){var t=this;if(this.$v.paymentDate.$reset(),this.$v.paymentDate.$touch(),this.$v.paymentMethod.$reset(),this.$v.paymentMethod.$touch(),this.$v.qty.$reset(),this.$v.qty.$touch(),this.$v.paymentDate.$error||this.$v.paymentMethod.$error||this.$v.qty.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;var e=parseFloat(this.totalAmounfromPayments)+parseFloat(this.qty);e=parseFloat(e.toFixed(2));var a=parseFloat(this.total_invoice.toFixed(2));if(e>a)this.$q.notify({message:"La cantidad excede el total del pedido",position:"top",color:"negative"});else{var o="ABONADO";e===a&&(o="PAGADO");var n=[];n.fileReg=this.file,n.id=this.id_po,n.qty=this.qty,n.ref=this.reference,n.account=this.account,n.output=this.output,n.method=this.paymentMethod.value,n.date=this.invertDate(this.paymentDate),n.status=o,n.bank_account_id=this.bank,n.save_payment=this.bankRequired,this.$q.loading.show(),c["a"].post("/purchase-orders/addPayment",n).then((function(o){var n=o.data;if(n.result){t.cleanFields(),t.total_invoice=n.total_invoice,t.id_po=n.id;var i=[];i.id=t.id_po,t.$q.notify({message:n.message.content,position:"top",color:n.result?"positive":"negative"}),t.$q.loading.hide(),t.getPayments(n.id),e===a&&(t.paymentsModal=!1,t.fetchFromServer())}else t.$q.notify({message:"Ha ocurrido un erro al intentar agregar el pago.",position:"top",color:"negative"})}))}},deletePayment:function(t,e){var a=this,o=[];o.id=t,o.po_id=e,o.status="ABONADO",c["a"].post("/purchase-orders/deletePayment",o).then((function(t){var e=t.data;if(e.result){a.$q.notify({message:"Pago eliminado correctamente.",position:"top",color:"negative"}),a.getPayments(e.id);var o=parseFloat(a.totalAmounfromPayments),n=parseFloat(a.total_invoice.toFixed(2));n>o&&(a.disableBtnAddPayment=!1,a.fetchFromServer())}else a.$q.notify({message:"Ocurrio un error al intentar eliminar el pago.",position:"top",color:"negative"})}))},timbrarPago:function(t){var e=this;this.$q.loading.show(),c["a"].put("/invoices/timbrarPago/"+t.invoice_payment_id).then((function(a){var o=a.data;e.$q.loading.hide(),"error"===o.result?e.$q.notify({message:o.message.content,position:"top",color:o.result?"positive":"warning"}):e.checkPayments(t.remision_id)})).catch((function(t){console.error(t)}))},cancelarPago:function(t){var e=this;this.$q.loading.show(),c["a"].put("/invoices/cancelarPago/"+t.invoice_payment_id).then((function(a){var o=a.data;e.$q.loading.hide(),"error"===o.result?e.$q.notify({message:o.message.content,position:"top",color:o.result?"positive":"warning"}):e.checkPayments(t.remision_id)})).catch((function(t){console.error(t)}))},checkPayments:function(t){var e=this;c["a"].get("/invoices/keepCheckingPayments/"+t).then((function(a){var o=a.data;o.result?null===e.interval&&(e.interval=setInterval((function(){e.revisarPagos(t)}),1e4)):(clearInterval(e.interval),e.interval=null),e.getPayments(t)}))},openActions:function(t){this.$router.push("/purchase-orders/".concat(t))},openActionsv2:function(t){this.$router.push("/shopping-carts/orders/".concat(t))},cleanFields:function(){this.file=null,this.qty="",this.reference="",this.paymentDate=null,this.paymentMethod=null,this.id_po=null,this.bank=null,this.account=null,this.output=null,this.$v.paymentDate.$reset(),this.$v.paymentMethod.$reset(),this.$v.qty.$reset()},closeModal:function(){this.paymentsModal=!1,this.fetchFromServer()},getCFDIInvoice:function(t){var e="https://batuta.wasp.mx";window.open(e+"/api/download_xml/"+t,"_blank")},getPdfInvoice:function(t){var e=this;this.$q.loading.show(),c["a"].fileDownload("/invoices/pdfi/".concat(t)).then((function(a){var o=a.data,n=window.URL.createObjectURL(new Blob([o],{type:"application/pdf"})),i=document.createElement("a");i.href=n,i.setAttribute("download",t+".pdf"),document.body.appendChild(i),e.$q.loading.hide(),i.click()}))},generatePDF:function(){var t=this,e=[],a=[];if(a=0===this.status.length?[99]:this.status,e.supplier=this.supplier,e.status=a,this.saleDatev1){e.saleDatev1=this.saleDatev1;while(e.saleDatev1.includes("/"))e.saleDatev1=e.saleDatev1.replace("/","-")}else e.saleDatev1=null;if(this.saleDatev2){e.saleDatev2=this.saleDatev2;while(e.saleDatev2.includes("/"))e.saleDatev2=e.saleDatev2.replace("/","-")}else e.saleDatev2=null;var o="https://api_alpez.wasp.mx/"+"purchase-orders/getPdfFromPurchasePayments/".concat(e.supplier,"/").concat(e.status,"/").concat(e.saleDatev1,"/").concat(e.saleDatev2);this.$q.loading.show(),c["a"].fileDownload(o).then((function(e){var a=e.data,o=window.URL.createObjectURL(new Blob([a],{type:"application/pdf"})),n=document.createElement("a");n.href=o,n.setAttribute("download","reporte_pagos.pdf"),document.body.appendChild(n),t.$q.loading.hide(),n.click()}))},generateCSV:function(){var t=[],e=[];if(e=0===this.status.length?[99]:this.status,t.supplier=this.supplier,t.status=e,this.saleDatev1){t.saleDatev1=this.saleDatev1;while(t.saleDatev1.includes("/"))t.saleDatev1=t.saleDatev1.replace("/","-")}else t.saleDatev1=null;if(this.saleDatev2){t.saleDatev2=this.saleDatev2;while(t.saleDatev2.includes("/"))t.saleDatev2=t.saleDatev2.replace("/","-")}else t.saleDatev2=null;var a="https://api_alpez.wasp.mx/"+"invoices/getCSVFromPayments/".concat(t.supplier,"/").concat(t.status,"/").concat(t.saleDatev1,"/").concat(t.saleDatev2);window.open(a,"_blank")},uploadFile:function(t){this.refPay=t.id,this.modalUploadFile=!0,this.idPo=t.po_id},getFile:function(t){}}},v=f,h=(a("84ed"),a("2877")),g=a("9989"),b=a("ead5"),y=a("079e"),_=a("9c40"),q=a("05c0"),w=a("ddd8"),D=a("7cbe"),P=a("52ee"),k=a("66e5"),x=a("4074"),C=a("0170"),O=a("9564"),S=a("eaac"),F=a("27f9"),A=a("0016"),$=a("bd08"),E=a("db86"),M=a("b047"),I=a("24e8"),R=a("f09f"),T=a("eb85"),N=a("ee89"),U=a("4e73"),Q=a("1c1c"),L=a("4b7e"),B=a("a370"),W=a("7f67"),z=a("eebe"),G=a.n(z),J=Object(h["a"])(v,o,n,!1,null,null,null);e["default"]=J.exports;G()(J,"components",{QPage:g["a"],QBreadcrumbs:b["a"],QBreadcrumbsEl:y["a"],QBtn:_["a"],QTooltip:q["a"],QSelect:w["a"],QPopupProxy:D["a"],QDate:P["a"],QItem:k["a"],QItemSection:x["a"],QItemLabel:C["a"],QToggle:O["a"],QTable:S["a"],QInput:F["a"],QIcon:A["a"],QTr:$["a"],QTd:E["a"],QChip:M["a"],QDialog:I["a"],QCard:R["a"],QSeparator:T["a"],QUploader:N["a"],QMenu:U["a"],QList:Q["a"],QCardActions:L["a"],QCardSection:B["a"]}),G()(J,"directives",{ClosePopup:W["a"]})}}]);