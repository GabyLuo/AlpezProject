(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[113],{bcd7:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"bg-grey-3"},[i("div",{staticClass:"q-pa-sm panel-header"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-sm-8"},[i("div",{staticClass:"q-pa-md q-gutter-sm"},[i("q-breadcrumbs",{staticStyle:{"font-size":"20px"},attrs:{align:"left"}},[i("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),i("q-breadcrumbs-el",{attrs:{label:"Ordenes de compra"}})],1)],1)]),1===t.roleId||22===t.roleId||20===t.roleId||28===t.roleId?i("div",{staticClass:"col-xs-6 col-md-4 pull-right"},[i("div",{staticClass:"q-pa-sm q-gutter-sm"},[i("q-btn",{attrs:{color:"primary",icon:"add",label:"Nuevo"},nativeOn:{click:function(e){return t.$router.push("/purchase-orders/new")}}})],1)]):t._e()])]),i("div",{staticClass:"q-pa-md bg-grey-3"},[i("div",{staticClass:"row bg-white border-panel"},[i("div",{staticClass:"col q-pa-md"},[i("q-table",{attrs:{flat:"",bordered:"",data:t.data,columns:t.columns,"row-key":"serial",pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[i("q-tr",{attrs:{props:e}},[i("q-td",{key:"serial",staticStyle:{"text-align":"center",width:"10%"},attrs:{props:e}},[t._v(t._s(e.row.serial))]),i("q-td",{key:"supplier",staticStyle:{"text-align":"left",width:"35%"},attrs:{props:e}},[t._v(t._s(e.row.supplier))]),i("q-td",{key:"order_date",staticStyle:{width:"15%"},attrs:{props:e}},[t._v(t._s(e.row.order_date))]),i("q-td",{key:"requested_date",staticStyle:{width:"15%"},attrs:{props:e}},[t._v(t._s(e.row.requested_date))]),i("q-td",{key:"status",staticStyle:{width:"10%","text-align":"center"},attrs:{props:e}},[i("q-chip",{attrs:{square:"",dense:"",color:"NUEVO"==e.row.status?"secondary":"COTIZADO"==e.row.status?"warning":"PEDIDO"==e.row.status?"orange":"EMBARCADO"==e.row.status?"purple-6":"ARRIBO"==e.row.status?"accent":"RECEPCION"==e.row.status?"light-green":"RECIBIDO"==e.row.status?"green":"PARCIAL"==e.row.status?"red-4":"red-6","text-color":"white"}},[t._v("\n                  "+t._s(e.row.status)+"\n                ")])],1),"Cerrado"!=e.row.status?i("q-td",{key:"actions",staticStyle:{width:"10%","text-align":"left"},attrs:{props:e}},[i("q-btn",{attrs:{color:"primary",icon:e.row.hayrestante||null===e.row.shipment_id?"add":"edit",flat:"",size:"10px"},nativeOn:{click:function(i){e.row.hayrestante||null===e.row.shipment_id?t.newShipment(e.row.id):t.editShipment(e.row.shipment_id)}}},[e.row.hayrestante||null===e.row.shipment_id?i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Nueva Recepción")]):i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Editar Recepción")])],1),i("q-btn",{attrs:{color:"primary",icon:"fas fa-eye",flat:"",size:"10px"},nativeOn:{click:function(i){return t.shipmentsModal(e.row)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver Recepciones")])],1)],1):i("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:e}},[i("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(i){return t.editSelectedRow(e.row.id)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver detalles")])],1)],1)],1)]}}])})],1)])]),i("q-dialog",{attrs:{persistent:""},model:{value:t.showShipments,callback:function(e){t.showShipments=e},expression:"showShipments"}},[i("q-card",{staticClass:"q-pt-md",staticStyle:{"min-width":"900px"}},[i("q-card-section",[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-12 text-h5 text-center"},[i("label",{attrs:{for:""}},[t._v("Recepciones Orden de Compra "+t._s(t.foliooc))])])])]),i("q-card-section",{staticClass:"q-pt-none"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-12 col-xs-12 q-pa-xs"},[i("q-table",{attrs:{flat:"",bordered:"","row-key":"name",data:t.shipments,columns:t.shipmentColumns,pagination:t.pagination,"hide-pagination":""},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[i("q-tr",{attrs:{props:e}},[i("q-td",{key:"serial",staticStyle:{"text-align":"center",width:"10%"},attrs:{props:e}},[t._v(t._s(e.row.serial))]),i("q-td",{key:"receive_date",staticStyle:{width:"30%"},attrs:{props:e}},[t._v(t._s(e.row.receive_date))]),i("q-td",{key:"status",staticStyle:{width:"30%"},attrs:{props:e}},[i("q-chip",{attrs:{square:"",dense:"",color:"NUEVO"==e.row.status?"secondary":"MUESTREADO"==e.row.status?"warning":"RECIBIDO"==e.row.status?"orange":"ANALIZADO"==e.row.status?"positive":"RECHAZADO"==e.row.status?"negative":"blue","text-color":"white"}},[t._v("\n                    "+t._s(e.row.status)+"\n                  ")])],1),"RECIBIDO"!=e.row.status?i("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:e}},[i("q-btn",{attrs:{color:e.row.invoice?"positive":"negative",icon:"cloud_upload",flat:"",size:"10px"},nativeOn:{click:function(i){return t.openUploadShipmentInvoiceModal(e.row)}}},[i("q-tooltip",{attrs:{"content-class":e.row.invoice?"bg-positive":"bg-negative"}},[t._v("Subir archivo")])],1),e.row.invoice?i("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(i){return t.showShipmentInvoiceFile(e.row)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver factura")])],1):t._e(),e.row.invoice?i("q-btn",{attrs:{color:"primary",icon:"cloud_download",flat:"",size:"10px"},nativeOn:{click:function(i){return t.downloadShipmentInvoiceFile(e.row)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Descargar factura")])],1):t._e(),i("q-btn",{attrs:{color:"primary",icon:"fas fa-edit",flat:"",size:"10px"},nativeOn:{click:function(i){return t.editShipment(e.row.id)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Editar")])],1),i("q-btn",{attrs:{color:"primary",icon:"fas fa-trash-alt",flat:"",size:"10px"},nativeOn:{click:function(i){return t.removeShipment(e.row)}}},[i("q-tooltip",{attrs:{"content-class":"bg-red"}},[t._v("Eliminar")])],1)],1):i("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:e}},[i("q-btn",{attrs:{color:e.row.invoice?"positive":"negative",icon:"cloud_upload",flat:"",size:"10px"},nativeOn:{click:function(i){return t.openUploadShipmentInvoiceModal(e.row)}}},[i("q-tooltip",{attrs:{"content-class":e.row.invoice?"bg-positive":"bg-negative"}},[t._v("Subir factura")])],1),e.row.invoice?i("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(i){return t.showShipmentInvoiceFile(e.row)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver factura")])],1):t._e(),e.row.invoice?i("q-btn",{attrs:{color:"primary",icon:"cloud_download",flat:"",size:"10px"},nativeOn:{click:function(i){return t.downloadShipmentInvoiceFile(e.row)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Descargar factura")])],1):t._e(),"RECIBIDO"==e.row.status?i("q-btn",{attrs:{color:"primary",icon:"fas fa-file-pdf",flat:"",size:"10px"},nativeOn:{click:function(i){return t.generateShipmentPdf(e.row.id)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver ticket de entrada")])],1):t._e(),i("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(i){return t.editShipment(e.row.id)}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver detalles")])],1)],1)],1)]}}])})],1)])]),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cerrar",color:"red"}})],1)],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.shipmentInvoiceModal,callback:function(e){t.shipmentInvoiceModal=e},expression:"shipmentInvoiceModal"}},[i("q-card",[i("q-card-section",{staticClass:"row"},[i("div",{staticClass:"col-xs-12 col-sm-10 text-h6"},[t._v("Factura: Recepción "+t._s(t.shipmentInvoice.fields.shipmentSerial))]),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col-xs-12 col-sm-2 pull-right",attrs:{icon:"close",flat:"",round:"",dense:""}})],1),i("q-card-section",[i("q-uploader",{ref:"fileShipmentInvoiceRef",attrs:{url:t.fileShipmentInvoiceUrl,method:"POST","hide-upload-btn":""},on:{uploaded:t.afterUploadShipmentInvoiceFile}})],1),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{attrs:{flat:"",label:"Subir archivo"},on:{click:function(e){return t.uploadShipmentInvoiceFile()}}})],1)],1)],1)],1)},n=[],s=(i("99af"),i("a9e3"),i("aabb")),o={name:"IndexPurchaseOrders",data:function(){return{shipmentInvoiceModal:!1,shipments:[],foliooc:null,showShipments:!1,pagination:{sortBy:"serial",descending:!0,rowsPerPage:25},shipmentInvoice:{fields:{shipmentId:null,shipmentSerial:null}},columns:[{name:"serial",align:"center",label:"FOLIO",field:"serial",style:"width: 10%",sortable:!0},{name:"supplier",align:"center",label:"PROVEEDOR",field:"supplier",style:"width: 35%",sortable:!0},{name:"order_date",align:"center",label:"FECHA DE PEDIDO",field:"order_date",style:"width: 15%",sortable:!0},{name:"requested_date",align:"center",label:"FECHA DE ARRIBO",field:"requested_date",style:"width: 15%",sortable:!0},{name:"status",align:"center",label:"ESTATUS",field:"status",style:"width: 10%",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",style:"width: 10%",sortable:!1}],shipmentColumns:[{name:"serial",align:"center",label:"FOLIO",field:"serial",style:"width: 10%",sortable:!0},{name:"receive_date",align:"center",label:"FECHA DE RECEPCION",field:"receive_date",style:"width: 30%",sortable:!0},{name:"status",align:"center",label:"ESTATUS",field:"status",style:"width: 30%",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",style:"width: 10%",sortable:!1}],data:[]}},computed:{roleId:function(){var t=this.$store.getters["users/rol"];return parseInt(t)},fileShipmentInvoiceUrl:function(){return"".concat("https://api_alpez.wasp.mx/","shipments/").concat(this.shipmentInvoice.fields.shipmentId,"/invoice-file")}},beforeRouteEnter:function(t,e,i){i((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||3===e||7===e||2===e||20===e||4===e||27===e||20===e||22===e|28===e?i():i("/")}))},mounted:function(){this.fetchFromServer()},methods:{generateShipmentPdf:function(t){var e="https://api_alpez.wasp.mx/"+"shipments/pdf/".concat(t);window.open(e,"_blank")},afterUploadShipmentInvoiceFile:function(t){var e=JSON.parse(t.xhr.response);this.$q.notify({message:e.message.content,position:"top",color:e.result?"positive":"warning"}),e.result&&(this.fetchFromServer(),this.shipmentInvoiceModal=!1)},openUploadShipmentInvoiceModal:function(t){this.shipmentInvoice.fields.shipmentId=t.id,this.shipmentInvoice.fields.shipmentSerial=t.serial,this.shipmentInvoiceModal=!0},downloadShipmentInvoiceFile:function(t){t.invoice?window.open("".concat("https://api_alpez.wasp.mx/","shipments/").concat(t.id,"/invoice-file/download"),"_blank"):this.$q.notify({message:"La recepción no cuenta con una factura subida",position:"top",color:"warning"})},showShipmentInvoiceFile:function(t){t.invoice?window.open("".concat(this.serverUrl,"assets/shipments/invoices/").concat(t.invoice),"_blank"):this.$q.notify({message:"La recepción no cuenta con una factura subida",position:"top",color:"warning"})},editShipment:function(t){this.$router.push("/shipments/".concat(t,"/",1))},removeShipment:function(t){var e=this;this.$q.loading.show(),s["a"].delete("/shipments/".concat(t.id)).then((function(t){var i=t.data;e.$q.notify({message:i.message.content,position:"top",color:i.result?"positive":"warning"}),i.result&&(e.fetchFromServer(),e.$q.loading.hide())}))},shipmentsModal:function(t){var e=this;s["a"].get("/shipments/order/".concat(t.id)).then((function(t){var i=t.data;console.log(i),e.shipments=i.shipments})),this.foliooc=t.serial,this.showShipments=!0},newShipment:function(t){var e=Number(t);this.$router.push("/shipments/purcharse-order/".concat(e,"/",1))},fetchFromServer:function(){var t=this;this.$q.loading.show(),s["a"].get("/purchase-orders/all").then((function(e){var i=e.data;console.log(i),i.result?(t.showShipments=!1,t.data=i.orders):t.$q.notify({message:i.message.content,position:"top",color:"warning",icon:"close"}),t.$q.loading.hide()}))},editSelectedRow:function(t){this.$router.push("/purchase-orders/".concat(t))},deleteSelectedRow:function(t){var e=this;this.$q.dialog({title:"Confirmación",message:"¿Desea eliminar esta Orden de Compra?",persistent:!0,ok:"Eliminar",cancel:"Cancelar"}).onOk((function(){s["a"].delete("/purchase-orders/".concat(t)).then((function(t){var i=t.data;e.$q.notify({message:i.message.content,position:"top",color:i.result?"positive":"warning",icon:i.result?"thumb_up":"close"}),i.result&&e.fetchFromServer()}))})).onCancel((function(){}))}}},r=o,c=i("2877"),l=i("9989"),p=i("ead5"),d=i("079e"),u=i("9c40"),h=i("eaac"),m=i("bd08"),v=i("db86"),f=i("b047"),w=i("05c0"),g=i("24e8"),b=i("f09f"),q=i("a370"),y=i("4b7e"),_=i("ee89"),S=i("7f67"),I=i("eebe"),C=i.n(I),O=Object(c["a"])(r,a,n,!1,null,null,null);e["default"]=O.exports;C()(O,"components",{QPage:l["a"],QBreadcrumbs:p["a"],QBreadcrumbsEl:d["a"],QBtn:u["a"],QTable:h["a"],QTr:m["a"],QTd:v["a"],QChip:f["a"],QTooltip:w["a"],QDialog:g["a"],QCard:b["a"],QCardSection:q["a"],QCardActions:y["a"],QUploader:_["a"]}),C()(O,"directives",{ClosePopup:S["a"]})}}]);