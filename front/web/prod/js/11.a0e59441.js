(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{5673:function(t,e,a){},"98be":function(t,e,a){"use strict";a("5673")},b0ae:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"bg-grey-3"},[a("div",{staticClass:"q-pa-sm panel-header"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-8"},[a("div",{staticClass:"q-pa-md q-gutter-sm"},[a("q-breadcrumbs",{staticStyle:{"font-size":"20px"},attrs:{align:"left"}},[a("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),a("q-breadcrumbs-el",{attrs:{label:"Cuentas por cobrar"}})],1)],1)]),a("div",{staticClass:"col-sm-4 pull-right"},[a("div",{staticClass:"col-xs-12 col-md-4 offset-md-10"},[a("div",[t.haspermissionv2?a("q-btn",{staticClass:"bg-blue text-white",staticStyle:{"margin-left":"10px"},attrs:{icon:"plus_one"},on:{click:function(e){return t.openGenerateMultipay()}}},[a("q-tooltip",[t._v("APLICAR MULTIPAGO")])],1):t._e(),t.haspermissionv1?a("q-btn",{staticStyle:{"margin-left":"10px"},attrs:{color:"green",icon:"fas fa-file-excel"},on:{click:function(e){return t.generateCSV()}}},[a("q-tooltip",[t._v("GENERAR CSV")])],1):t._e(),t.haspermissionv1?a("q-btn",{staticStyle:{"margin-left":"10px"},attrs:{color:"red",icon:"fas fa-file-pdf"},on:{click:function(e){return t.generatePDF()}}},[a("q-tooltip",[t._v("GENERAR PDF")])],1):t._e()],1)])])])]),a("div",{staticClass:"q-pa-md bg-grey-3"},[a("div",{staticClass:"row bg-white border-panel"},[a("div",{staticClass:"col q-pa-md"},[a("div",{staticClass:"row q-col-gutter-xs q-col-gutter-md"},[a("div",{staticClass:"col-md-4"}),a("div",{staticClass:"col-md-2"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",mask:"date",label:"Desde"},model:{value:t.saleDatev1,callback:function(e){t.saleDatev1=e},expression:"saleDatev1"}},[a("q-popup-proxy",{ref:"date",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("div",{staticClass:"col-sm-12"},[a("q-date",{attrs:{"today-btn":""},on:{input:function(e){return t.filterGrid()}},model:{value:t.saleDatev1,callback:function(e){t.saleDatev1=e},expression:"saleDatev1"}})],1)])],1)],1),a("div",{staticClass:"col-md-2"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",mask:"date",label:"Hasta"},model:{value:t.saleDatev2,callback:function(e){t.saleDatev2=e},expression:"saleDatev2"}},[a("q-popup-proxy",{ref:"date",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("div",{staticClass:"col-sm-12"},[a("q-date",{attrs:{"today-btn":""},on:{input:function(e){return t.filterGrid()}},model:{value:t.saleDatev2,callback:function(e){t.saleDatev2=e},expression:"saleDatev2"}})],1)])],1)],1),a("div",{staticClass:"col-md-2"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:[{label:"PAGADO",value:1},{label:"PENDIENTE DE PAGO",value:2},{label:"ABONADO",value:3},{label:"VENCIDO ABONADO",value:6},{label:"VENCIDO",value:7}],"emit-value":"","map-options":"",multiple:"",label:"Estatus"},on:{input:function(e){return t.filterGrid()}},scopedSlots:t._u([{key:"option",fn:function(e){var o=e.itemProps,i=e.itemEvents,n=e.opt,s=e.selected,l=e.toggleOption;return[a("q-item",t._g(t._b({},"q-item",o,!1),i),[a("q-item-section",[a("q-item-label",{domProps:{innerHTML:t._s(n.label)}})],1),a("q-item-section",{attrs:{side:""}},[a("q-toggle",{attrs:{value:s},on:{input:function(t){return l(n)}}})],1)],1)]}}]),model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1),a("div",{staticClass:"col-md-2"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:t.filteredCustomerOptions,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Cliente","emit-value":"","map-options":""},on:{filter:t.filtrarClientes,input:function(e){return t.filterGrid()}},model:{value:t.customer,callback:function(e){t.customer=e},expression:"customer"}})],1)]),a("div",{staticClass:"row bg-white"},[a("div",{staticClass:"col q-pa-md"},[a("q-table",{attrs:{flat:"",bordered:"",data:t.data,columns:t.columns,"row-key":"sale_date",pagination:t.pagination,filter:t.filter},on:{"update:pagination":function(e){t.pagination=e},request:t.qTableRequest},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticStyle:{width:"100%"}},[a("q-input",{attrs:{dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})],1)]},proxy:!0},{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"id",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",{staticStyle:{"text-decoration":"underline black",cursor:"pointer"},on:{click:function(a){return t.openActions(e.row.id)}}},[t._v(t._s(e.row.id))])]),a("q-td",{key:"actions",attrs:{props:e}},["ENVIADO"==e.row.status||"PAGADO"==e.row.status||"REMISIONADO"==e.row.status?a("q-btn",{attrs:{color:"primary",icon:"attach_money",flat:"",size:"10px"},nativeOn:{click:function(a){return t.openPaymentModal(e.row.id,e.row.status,e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Agregar pago")])],1):t._e()],1),a("q-td",{key:"status_invoice",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("q-chip",{attrs:{square:"",dense:"",color:"REMISIONADO"==e.row.status?"primary":"ENVIADO"==e.row.status?"warning":"ENTREGADO"==e.row.status||"PAGADO"==e.row.status?"positive":"FACTURADO"==e.row.status?"purple":"CANCELADO"==e.row.status?"negative":"black","text-color":"white"}},[t._v("\n                  "+t._s(e.row.status)+"\n                ")])],1),a("q-td",{key:"status_payment",attrs:{props:e}},[a("q-chip",{attrs:{square:"",dense:"",color:e.row.color_label,"text-color":"white"}},[t._v(t._s(e.row.vencimiento))])],1),a("q-td",{key:"status_timbrado",attrs:{props:e}},[a("q-chip",{attrs:{square:"",dense:"",color:t.colorTimbrado[e.row.status_timbrado],"text-color":"white"}},[t._v(t._s(t.statusTimbrado[e.row.status_timbrado]))])],1),a("q-td",{key:"expired_date",attrs:{props:e}},[t._v(t._s(e.row.fecha_vencimiento))]),a("q-td",{key:"sale_date",attrs:{props:e}},[t._v(t._s(e.row.sale_date))]),a("q-td",{key:"shopping_cart_id",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",{staticStyle:{"text-decoration":"underline black",cursor:"pointer"},on:{click:function(a){return t.openActionsv2(e.row.shopping_cart_id)}}},[t._v(t._s(e.row.shopping_cart_id))])]),a("q-td",{key:"factura",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.factura))]),a("q-td",{key:"customer",staticStyle:{"text-align":"left"},attrs:{props:e}},[t._v(t._s(e.row.customer))]),a("q-td",{key:"total",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.cantidad_total)))]),a("q-td",{key:"abonado",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.abonado)))]),a("q-td",{key:"restante",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.cantidad_restante)))])],1)]}}])})],1)])])])]),a("q-dialog",{model:{value:t.paymentsModal,callback:function(e){t.paymentsModal=e},expression:"paymentsModal"}},[a("q-card",{staticStyle:{"min-width":"1100px"}},[a("div",[a("div",{staticClass:"bg-primary"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-11 text-h6",staticStyle:{color:"white","padding-top":"5px","padding-bottom":"5px"}},[t._v("  Pagos de la remisión")]),a("div",{staticClass:"col-sm-1 pull-right",staticStyle:{color:"white","padding-top":"5px","padding-bottom":"5px"}},[a("q-btn",{attrs:{color:"white",flat:"",round:"",dense:"",icon:"close"},nativeOn:{click:function(e){return t.closeModal()}}})],1)])]),a("div",{staticClass:"row q-pa-md q-col-gutter-md"},[a("div",{staticClass:"col-md-4"},[a("q-input",{attrs:{filled:"",readonly:"",color:"black",label:"Total del pedido:",value:t.currencyFormatter.format(t.total_invoice),"bg-color":"green-3"}})],1),a("div",{staticClass:"col-md-4"},[a("q-input",{attrs:{filled:"",readonly:"",color:"black",label:"Monto Abonado:",value:t.currencyFormatter.format(t.totalAmounfromPayments),"bg-color":"orange-3"}})],1),a("div",{staticClass:"col-md-4",staticStyle:{"text-align":"center"}},[a("q-input",{attrs:{filled:"",readonly:"",color:"black",label:"Monto Restante:",value:t.currencyFormatter.format(t.total_invoice-t.totalAmounfromPayments),"bg-color":"blue-3"}})],1)]),a("div",{staticClass:"row q-pa-md q-col-gutter-md"},[a("div",{staticClass:"col-md-4"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:t.$v.paymentDate.$error,mask:"YYYY-MM-DD HH:mm:ss",label:"Fecha de pago"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"event"}})]},proxy:!0}]),model:{value:t.paymentDate,callback:function(e){t.paymentDate=e},expression:"paymentDate"}},[a("q-popup-proxy",{ref:"paymentDate",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-6"},[a("q-date",{attrs:{mask:"YYYY-MM-DD HH:mm:ss"},model:{value:t.paymentDate,callback:function(e){t.paymentDate=e},expression:"paymentDate"}})],1),a("div",{staticClass:"col-sm-6"},[a("q-time",{attrs:{mask:"YYYY-MM-DD HH:mm:ss","now-btn":""},on:{input:function(){return t.$refs.paymentDate.hide()}},model:{value:t.paymentDate,callback:function(e){t.paymentDate=e},expression:"paymentDate"}})],1)])])],1)],1),a("div",{staticClass:"col-md-4"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"","map-options":"",error:t.$v.paymentMethod.$error,label:"Forma de pago",options:t.formaPagoOptions},model:{value:t.paymentMethod,callback:function(e){t.paymentMethod=e},expression:"paymentMethod"}})],1),a("div",{staticClass:"col-md-4"},[a("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:t.$v.qty.$error,rules:t.qtyRules,label:"Monto a pagar"},on:{keyup:function(e){return t.isNumber(e,"qty")}},model:{value:t.qty,callback:function(e){t.qty=e},expression:"qty"}})],1),a("div",{staticClass:"col-md-4"},[a("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",label:"Referencia"},model:{value:t.reference,callback:function(e){t.reference=e},expression:"reference"}})],1),a("div",{staticClass:"col-md-3"},[a("q-btn",{attrs:{disable:t.disableBtnAddPayment,icon:"add",color:"positive",label:"Agregar Pago"},on:{click:function(e){return t.addPayment()}}})],1)]),t.disableTblPayments?a("div",{staticClass:"row"},[t.tableWithoutInvoice?a("div",{staticClass:"col q-pa-md",staticStyle:{height:"400px","overflow-y":"auto"}},[a("q-table",{attrs:{id:"newstyle",color:"primary",data:t.dataPayments,columns:t.columnsPaymentsWithoutInvoice,"row-key":"sale_date",pagination:t.paginationPayments},on:{"update:pagination":function(e){t.paginationPayments=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"payment_date",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.payment_date))])]),a("q-td",{key:"method",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.method_label))])]),a("q-td",{key:"amount",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.amount)))]),a("q-td",{key:"reference",staticStyle:{"text-align":"left"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.reference))])]),a("q-td",{key:"actions",staticStyle:{"text-align":"center"},attrs:{props:e}},[null===e.row.file?a("q-btn",{attrs:{color:"green",icon:"cloud_upload",flat:"",size:"10px"},nativeOn:{click:function(a){return t.uploaFile(e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-green"}},[t._v("Cargar Archivo")])],1):t._e(),null!==e.row.file?a("q-btn",{attrs:{color:"green",icon:"cloud_download",flat:"",size:"10px"},nativeOn:{click:function(a){return t.getFile(e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-green"}},[t._v("Descargar Archivo")])],1):t._e(),a("q-btn",{attrs:{color:"negative",icon:"delete",flat:"",size:"10px"},nativeOn:{click:function(a){return t.deletePayment(e.row.id,e.row.remision_id)}}},[a("q-tooltip",{attrs:{"content-class":"negative"}},[t._v("Eliminar pago")])],1)],1)],1)]}}],null,!1,2163703774)})],1):t._e(),t.tableWithInvoice?a("div",{staticClass:"col q-pa-md",staticStyle:{height:"400px","overflow-y":"auto"}},[a("q-table",{attrs:{id:"newstyle",color:"primary",data:t.dataPayments,columns:t.columnsPaymentsWithInvoice,"row-key":"sale_date",pagination:t.paginationPayments},on:{"update:pagination":function(e){t.paginationPayments=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"num_parcialidad",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.num_parcialidad))])]),a("q-td",{key:"payment_date",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.payment_date))])]),a("q-td",{key:"method",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.method_label))])]),a("q-td",{key:"amount",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.amount)))]),a("q-td",{key:"reference",staticStyle:{"text-align":"left"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.reference))])]),a("q-td",{key:"status_timbrado",attrs:{props:e}},[a("q-chip",{attrs:{dense:"",icon:t.iconTimbrado[e.row.status_timbrado],color:t.colorTimbrado[e.row.status_timbrado],"text-color":"white"}},[t._v(t._s(t.statusTimbrado[e.row.status_timbrado])),6===e.row.status_timbrado?a("q-tooltip",[t._v(t._s(e.row.message))]):t._e(),7===e.row.status_timbrado?a("q-tooltip",[t._v(t._s(e.row.message_cancelacion))]):t._e()],1)],1),a("q-td",{key:"actions",staticStyle:{"text-align":"center"},attrs:{props:e}},[null===e.row.file?a("q-btn",{attrs:{color:"green",icon:"cloud_upload",flat:"",size:"10px"},nativeOn:{click:function(a){return t.uploaFile(e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-green"}},[t._v("Cargar Archivo")])],1):t._e(),null!==e.row.file?a("q-btn",{attrs:{color:"green",icon:"cloud_download",flat:"",size:"10px"},nativeOn:{click:function(a){return t.getFile(e.row)}}},[a("q-tooltip",{attrs:{"content-class":"bg-green"}},[t._v("Descargar Archivo")])],1):t._e(),0===e.row.status_timbrado||6===e.row.status_timbrado?a("q-btn",{attrs:{small:"",flat:"",color:"green-6",icon:"fas fa-certificate"},on:{click:function(a){return t.timbrarPago(e.row)}}},[a("q-tooltip",[t._v("Timbrar")])],1):t._e(),1===e.row.status_timbrado?a("q-btn",{staticClass:"pull-right",attrs:{small:"",flat:"",color:"brown","icon-right":"fas fa-file-pdf"},on:{click:function(a){return t.getPdfInvoice(e.row.id_request,e.row.pdf)}}},[a("q-tooltip",[t._v("PDF")])],1):t._e(),1===e.row.status_timbrado?a("q-btn",{staticClass:"pull-right",attrs:{small:"",flat:"",color:"green-8","icon-right":"fas fa-file-excel"},on:{click:function(a){return t.getCFDIInvoice(e.row.id_request)}}},[a("q-tooltip",[t._v("XML")])],1):t._e(),1===e.row.status_timbrado?a("q-btn",{staticClass:"pull-right",attrs:{small:"",flat:"",color:"red-9","icon-right":"cancel"},on:{click:function(a){t.cancelarTimbrado=!0,t.pagoRow=e.row}}},[a("q-tooltip",[t._v("Cancelar")])],1):t._e(),1!==e.row.status_timbrado&&3!==e.row.status_timbrado&&4!==e.row.status_timbrado&&5!==e.row.status_timbrado?a("q-btn",{attrs:{color:"negative",icon:"delete",flat:"",size:"10px"},nativeOn:{click:function(a){return t.deletePayment(e.row.id,e.row.remision_id)}}},[a("q-tooltip",{attrs:{"content-class":"negative"}},[t._v("Eliminar pago")])],1):t._e()],1)],1)]}}],null,!1,3868102989)})],1):t._e()]):a("div",{staticClass:"row",staticStyle:{"margin-top":"15px"}},[a("div",{staticClass:"col-md-12 col-lg-12"},[a("label",{staticStyle:{"margin-left":"35%"}},[t._v("No hay pagos registrados para esta remision.")])])])]),a("q-card-actions",{attrs:{align:"right"}},[a("br")])],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.multipayModal,callback:function(e){t.multipayModal=e},expression:"multipayModal"}},[a("q-card",{staticStyle:{"min-width":"95%","max-height":"85vh"}},[a("div",{staticClass:"bg-primary"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-xs-10 col-sm-11 text-h6",staticStyle:{color:"white","padding-top":"5px","padding-bottom":"5px"}},[t._v("  Multi-Abono")]),a("div",{staticClass:"col-xs-2  col-sm-1 pull-right",staticStyle:{color:"white","padding-top":"5px","padding-bottom":"5px"}},[a("q-btn",{attrs:{color:"white",flat:"",round:"",dense:"",icon:"close"},nativeOn:{click:function(e){return t.closeModalv2()}}})],1)])]),a("div",{staticClass:"row q-pa-md q-col-gutter-md"},[a("div",{class:this.size},[a("q-select",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",options:t.filteredCustomerOptionsv2,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Cliente","emit-value":"","map-options":""},on:{filter:t.filtrarClientesv2,input:function(e){return t.getpendingPayments()}},model:{value:t.customerv2,callback:function(e){t.customerv2=e},expression:"customerv2"}})],1),t.showQty?a("div",{staticClass:"col-xs-12 col-sm-4 col-md-3 col-lg-2"},[a("q-input",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",label:"Adeudo total",disable:""},model:{value:this.maximo,callback:function(e){t.$set(this,"maximo",e)},expression:"this.maximo"}})],1):t._e(),t.showQty?a("div",{staticClass:"col-xs-12 col-sm-4 col-md-3 col-lg-3"},[a("q-input",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",mask:"#.##","fill-mask":"0","reverse-fill-mask":"",label:"Cantidad"},on:{input:function(e){return t.divideCantidad()}},model:{value:t.qtyAbono,callback:function(e){t.qtyAbono=e},expression:"qtyAbono"}})],1):t._e()]),t.showPendingPaymentsTable?a("div",{staticClass:"row q-pa-md q-col-gutter-md"},[a("div",{staticClass:"col-xs-12 col-sm-6 col-md-6 col-lg-2"},[a("q-select",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",error:t.$v.paymentDate.$error,mask:"DD-MM-YYYY HH:mm:ss",label:"Fecha de pago"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"event"}})]},proxy:!0}],null,!1,3703588864),model:{value:t.paymentDate,callback:function(e){t.paymentDate=e},expression:"paymentDate"}},[a("q-popup-proxy",{ref:"paymentDate",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-6"},[a("q-date",{attrs:{mask:"DD-MM-YYYY HH:mm:ss"},model:{value:t.paymentDate,callback:function(e){t.paymentDate=e},expression:"paymentDate"}})],1),a("div",{staticClass:"col-sm-6"},[a("q-time",{attrs:{mask:"DD-MM-YYYY HH:mm:ss","now-btn":""},on:{input:function(){return t.$refs.paymentDate.hide()}},model:{value:t.paymentDate,callback:function(e){t.paymentDate=e},expression:"paymentDate"}})],1)])])],1)],1),a("div",{staticClass:"col-xs-12 col-sm-6 col-md-6 col-lg-3"},[a("q-select",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"","map-options":"",error:t.$v.paymentMethod.$error,label:"Forma de pago",options:t.formaPagoOptions},model:{value:t.paymentMethod,callback:function(e){t.paymentMethod=e},expression:"paymentMethod"}})],1),a("div",{staticClass:"col-x2-12 col-sm-6 col-md-3 col-lg-2"},[a("div",{staticClass:"col-xs-12 col-sm-4 col-md-2"},[a("q-select",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",options:[{label:"Si",value:1},{label:"No",value:2}],"emit-value":"","map-options":"",label:"¿Timbrar?"},model:{value:t.timbrarComp,callback:function(e){t.timbrarComp=e},expression:"timbrarComp"}})],1)]),a("div",{staticClass:"col-xs-12 col-sm-6 col-md-6 col-lg-4"},[a("q-input",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",label:"Referencia"},model:{value:t.reference,callback:function(e){t.reference=e},expression:"reference"}})],1),a("div",{staticClass:"col-x2-12 col-sm-6 col-md-3 col-lg-1"},[a("q-btn",{staticStyle:{width:"100%",height:"75%","background-color":"#21ba45"},attrs:{loading:t.loading6,disable:t.disabletablev2,color:"green",label:"Abonar"},on:{click:function(e){return t.openModal()}}})],1)]):t._e(),a("div",{staticClass:"row q-pa-md"},[t.showPendingPaymentsTable?a("div",{staticClass:"col-xs-12 col-sm-12 col-md-12 col-lg-12"},[a("q-table",{staticStyle:{"max-height":"50vh"},attrs:{color:"primary",data:t.dataPendingPayments,columns:t.columnsPendingPayments,"row-key":"id",pagination:t.paginationPendingPayments},on:{"update:pagination":function(e){t.paginationPendingPayments=e}},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"id",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.id))])]),a("q-td",{key:"sale_date",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.sale_date))])]),a("q-td",{key:"no_factura",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.no_factura))])]),"-"===e.row.vencimiento?a("q-td",{key:"vencimiento",attrs:{props:e}},[a("label",[t._v("-")])]):a("q-td",{key:"vencimiento",attrs:{props:e}},[a("q-chip",{attrs:{size:"16px",square:"",dense:"",color:e.row.color_label,"text-color":"white"}},[a("label",{staticStyle:{"font-size":"15px"}},[t._v(" "+t._s(e.row.vencimiento)+" ")])])],1),a("q-td",{key:"shopping_cart_id",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("label",[t._v(t._s(e.row.shopping_cart_id))])]),a("q-td",{key:"cantidad_total",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.cantidad_total)))]),a("q-td",{key:"cantidad_restante",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.cantidad_restante)))]),a("q-td",{key:"actions",staticStyle:{"text-align":"center"},attrs:{props:e}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-10"},[a("q-input",{staticStyle:{background:"#D8D1CF"},attrs:{filled:"",label:"Cantidad"},on:{input:function(a){return t.reCalculo(e.row)}},model:{value:e.row.nuevo_abono,callback:function(a){t.$set(e.row,"nuevo_abono",a)},expression:"props.row.nuevo_abono"}})],1),a("div",{staticClass:"col-md-1",staticStyle:{"margin-left":"5px"}},[a("q-btn",{attrs:{flat:"",round:"",icon:"clear"},on:{click:function(a){return t.clearCalculo(e.row)}}})],1)])]),a("q-td",{key:"nuevo_saldo",staticStyle:{"text-align":"right"},attrs:{props:e}},[t._v(t._s(""+t.currencyFormatter.format(e.row.nuevo_saldo)))])],1)]}}],null,!1,1494438432)})],1):t._e()])])],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.modalArchivo,callback:function(e){t.modalArchivo=e},expression:"modalArchivo"}},[a("q-card",{staticStyle:{"min-width":"25%"}},[a("q-card-section",{staticClass:"row bg-primary text-white"},[a("div",{staticClass:"col-xs-12 col-sm-10 text-h6"},[t._v("Cargar Archivo")]),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col-xs-12 col-sm-2 pull-right",attrs:{icon:"close",flat:"",round:"",dense:""}})],1),a("q-card-section",[a("div",{staticClass:"col-xs-12 col-sm-4 pull-right"},[a("q-file",{attrs:{color:"dark","bg-color":"secondary",filled:"",label:"Archivo"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"cloud_upload"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0}]),model:{value:t.file,callback:function(e){t.file=e},expression:"file"}})],1)]),a("q-card-actions",{staticClass:"text-secondary",attrs:{align:"right"}},[a("q-btn",{attrs:{color:"positive",label:"Subir archivo"},on:{click:function(e){return t.uploadDocumentFile()}}})],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.cancelarTimbrado,callback:function(e){t.cancelarTimbrado=e},expression:"cancelarTimbrado"}},[a("q-card",[a("q-card-section",{staticClass:"bg-primary"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-xs-11 col-sm-11 col-md-11 col-lg-11 text-h6",staticStyle:{color:"white"}},[t._v("Cancelar Factura")]),a("div",{staticClass:"col-xs-1 col-sm-1 col-md-1 col-lg-1 pull-right"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"white",flat:"",round:"",dense:"",icon:"close"}})],1)])]),a("q-card-section",{staticClass:"items-center"},[a("span",{staticClass:"row text-h6"},[t._v("¿Está seguro de cancelar esta factura?")])]),a("q-card-section",{staticClass:"items-center"},[a("div",{staticClass:"row  items-center"},[a("div",{staticClass:"col-xs-12 col-sm-12 col-md-12 col-lg-12"},[a("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"","map-options":"","emit-value":"",label:"Motivo de cancelacion",options:t.CancelacionOptions},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"description"}})]},proxy:!0}]),model:{value:t.motivo_cancelacion,callback:function(e){t.motivo_cancelacion=e},expression:"motivo_cancelacion"}})],1)])]),"01"===t.motivo_cancelacion?a("q-card-section",{staticClass:"items-center"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-xs-12 col-sm-12 col-md-12 col-lg-12"},[a("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:t.$v.folio_sustituye.$error,label:"Folio que sustituye",rules:t.fiscalFolioSustituye},on:{keyup:function(e){return t.isNumber(e,"folio_sustituye")}},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"description"}})]},proxy:!0}],null,!1,736773578),model:{value:t.folio_sustituye,callback:function(e){t.folio_sustituye=e},expression:"folio_sustituye"}})],1)])]):t._e(),a("q-card-section",{staticClass:"text-primary"},[a("div",{staticClass:"row q-col-gutter-xs q-col-gutter-sm q-col-gutter-md row q-col-gutter-xs q-col-gutter-lg"},[a("div",{staticClass:"col-xs-12 col-sm-6 col-md-6 col-lg-6"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticStyle:{"background-color":"#f44336"},attrs:{flat:"",label:"Cancelar",color:"white"},on:{click:function(e){t.cancelarTimbrado=!1}}})],1),a("div",{staticClass:"col-xs-12 col-sm-6 col-md-6 col-lg-6",attrs:{align:"right"}},[a("q-btn",{staticStyle:{"background-color":"#21ba45","text-align":"right"},attrs:{flat:"",label:"Confirmar",color:"white"},on:{click:function(e){return t.cancelarPago(t.pagoRow)}}})],1)])])],1)],1)],1)},i=[],n=a("7ec2"),s=a.n(n),l=a("c973"),r=a.n(l),c=(a("99af"),a("4d90"),a("d3b7"),a("25f0"),a("159b"),a("a9e3"),a("4de4"),a("ac1f"),a("5319"),a("b680"),a("e260"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("caad"),a("2532"),a("5b81"),a("aabb")),d=a("b5ae"),u=d.required,m=d.requiredIf,p=d.decimal,v={name:"IndexStorageExits",validations:{paymentMethod:{required:u},paymentDate:{required:u},qty:{required:u,decimal:p},folio_sustituye:{required:m((function(){return"01"===this.motivo_cancelacion}))}},data:function(){return{money:{decimal:".",thousands:",",prefix:"",suffix:"",precision:2,masked:!1},currencyFormatter:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),total:0,monto:0,restante:0,modalArchivo:!1,formatter:new Intl.NumberFormat("en-US"),role:null,tableWithInvoice:!1,tableWithoutInvoice:!0,interval:null,customer:"TODOS",disableBtnAddPayment:!0,disableTblPayments:!0,qty:null,qtyAbono:null,file:null,cantidad_distribuida:0,maximo:0,paymentDate:"".concat((new Date).getFullYear(),"-").concat(((new Date).getMonth()+1).toString().padStart(2,"0"),"-").concat((new Date).getDate().toString().padStart(2,"0")," 12:00:00"),paymentMethod:null,status:[],reference:null,total_invoice:null,id_invoice:null,paymentsModal:!1,saleDatev1:null,saleDatev2:null,multipayModal:!1,timbrarComp:1,loading6:!1,size:"",customerv2:null,showQty:!1,disabletable:!0,disabletablev2:!0,showPendingPaymentsTable:!1,auxRow:[],customerOptionsv2:[],filteredCustomerOptionsv2:[],customerOptions:[],filteredCustomerOptions:[],formaPagoOptions:[],dataPaymentsMultiPayments:[],dataPendingPayments:[],pagination:{sortBy:"id",descending:!0,page:1,rowsNumber:0,rowsPerPage:25},columns:[{name:"id",align:"center",label:"# REMISIÓN",field:"id",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",sortable:!1},{name:"status_invoice",align:"center",label:"ESTATUS",field:"status_invoice",sortable:!1},{name:"status_payment",align:"center",label:"ESTATUS DE PAGO",field:"status_payment",sortable:!0},{name:"expired_date",align:"center",label:"FECHA DE VENCIMIENTO",field:"expired_date",sortable:!0},{name:"sale_date",align:"center",label:"FECHA DE VENTA",field:"sale_date",sortable:!0},{name:"shopping_cart_id",align:"center",label:"# PEDIDO",field:"shopping_cart_id",sortable:!0},{name:"factura",align:"center",label:"FACTURA",field:"factura",sortable:!0},{name:"customer",align:"center",label:"CLIENTE",field:"customer",sortable:!0},{name:"total",align:"center",label:"MONTO TOTAL",field:"total",sortable:!0},{name:"abonado",align:"center",label:"ABONADO",field:"abonado",sortable:!0},{name:"restante",align:"center",label:"RESTANTE",field:"restante",sortable:!0}],data:[],filter:"",paginationPayments:{rowsPerPage:50},paginationPendingPayments:{rowsPerPage:25},columnsPendingPayments:[{name:"id",align:"center",label:"Remisión",field:"id",sortable:!0},{name:"sale_date",align:"center",label:"Fecha",field:"sale_date",sortable:!0},{name:"no_factura",align:"center",label:"Factura",field:"no_factura",sortable:!0},{name:"vencimiento",align:"center",label:"Estatus",field:"vencimiento",sortable:!0},{name:"shopping_cart_id",align:"center",label:"Pedido",field:"shopping_cart_id",sortable:!0},{name:"cantidad_total",align:"center",label:"Total",field:"cantidad_total",sortable:!0},{name:"cantidad_restante",align:"center",label:"Restante",field:"cantidad_restante",sortable:!0},{name:"actions",align:"center",label:"Abono",field:"actions",sortable:!1},{name:"nuevo_saldo",align:"center",label:"Saldo",field:"nuevo_saldo",sortable:!1}],columnsPaymentsWithInvoice:[{name:"num_parcialidad",align:"center",label:"#",field:"num_parcialidad",sortable:!0},{name:"payment_date",align:"center",label:"FECHA DE PAGO",field:"payment_date",sortable:!0},{name:"method",align:"center",label:"FORMA DE PAGO",field:"method",sortable:!0},{name:"amount",align:"center",label:"CANTIDAD",field:"amount",sortable:!0},{name:"reference",align:"center",label:"REFERENCIA",field:"reference",sortable:!0},{name:"status_timbrado",align:"center",label:"ESTATUS",field:"status_timbrado",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",sortable:!1}],columnsPaymentsWithoutInvoice:[{name:"payment_date",align:"center",label:"FECHA DE PAGO",field:"payment_date",sortable:!0},{name:"method",align:"center",label:"FORMA DE PAGO",field:"method",sortable:!0},{name:"amount",align:"center",label:"CANTIDAD",field:"amount",sortable:!0},{name:"reference",align:"center",label:"REFERENCIA",field:"reference",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",sortable:!1}],dataPayments:[],fiberSaleDocumentFile:{fields:{fiberSaleId:null}},fiberSaleDocumentFileModal:!1,serverUrl:"https://api_alpez.wasp.mx/",statusTimbrado:["NUEVO","TIMBRADO","CANCELADO","CANCELANDO","TIMBRANDO","CANCELANDO","ERROR","ERROR AL CANCELAR"],colorTimbrado:["blue-6","green-6","purple-6","warning","warning","warning","red-6","red-6"],statusPayment:["PENDIENTE DE PAGO","ABONADO","PAGADO","VENCIDO","VENCIDO ABONADO"],colorPayment:["blue-6","warning","green-6","red-14","red-14"],iconTimbrado:["add","done","cancel","fas fa-ellipsis-h","fas fa-ellipsis-h","fas fa-ellipsis-h","cancel","cancel"],cancelarTimbrado:!1,CancelacionOptions:[{label:"01 - Comprobantes emitidos con errores con relación",value:"01"},{label:"02 - Comprobantes emitidos con errores sin relación.",value:"02"},{label:"03 - No se llevó a cabo la operación.",value:"03"},{label:"04 - Operación nominativa relacionada en una factura global.",value:"04"}],pagoRow:null,motivo_cancelacion:"02",folio_sustituye:null}},computed:{fiscalFolioSustituye:function(t){var e=this;return[function(t){return e.$v.folio_sustituye.required||"El campo Folio que sustituye es requerido."}]},qtyRules:function(t){var e=this;return[function(t){return e.$v.qty.required||"El campo Monto a pagar es requerido."},function(t){return e.$v.qty.decimal||"El campo Monto a pagar debe ser decimal."}]},roleId:function(){var t=this.$store.getters["users/rol"];return parseInt(t)},fiberSaleDocumentFileUrl:function(){return"".concat("https://api_alpez.wasp.mx/","invoices/").concat(this.fiberSaleDocumentFile.fields.fiberSaleId,"/document-file")},totalAmounfromPayments:function(){var t=0;return this.dataPayments.forEach((function(e){t+=Number(e.amount)})),t},haspermissionv1:function(){var t=!1,e=this.$store.getters["users/rol"];return 1!==e&&3!==e&&7!==e&&2!==e&&20!==e&&4!==e&&27!==e&&17!==e&&22!==e&&28!==e&&29!==e&&25!==e||(t=!0),t},haspermissionv2:function(){var t=!1,e=this.$store.getters["users/rol"];return 1!==e&&3!==e&&7!==e&&2!==e&&20!==e&&4!==e&&27!==e&&17!==e&&22!==e&&28!==e&&29!==e&&25!==e||(t=!0),t}},beforeRouteEnter:function(t,e,a){a((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||3===e||7===e||2===e||20===e||4===e||27===e||17===e||22===e||28===e?a():a("/")}))},mounted:function(){this.fetchFromServer(),this.getClients()},methods:{fetchFromServer:function(){var t=this;this.$q.loading.show(),this.qTableRequest({pagination:this.pagination,filter:this.filter}),c["a"].get("/invoices/formaPagoOptions").then((function(e){var a=e.data;t.formaPagoOptions=a.options}))},isNumber:function(t,e){switch(e){case"folio_sustituye":this.folio_sustituye=this.folio_sustituye.replace(/[^0-9.]/g,""),this.$v.folio_sustituye.$touch();break;case"qty":this.qty=this.qty.replace(/[^0-9.]/g,""),this.$v.qty.$touch();break;default:break}},filtrarClientesv2:function(t,e,a){var o=this;e((function(){var e=t.toLowerCase();o.filteredCustomerOptionsv2=o.customerOptionsv2.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},qTableRequest:function(t){var e=this;return r()(s()().mark((function a(){var o;return s()().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.pagination=t.pagination,e.filter=t.filter,e.data=[],o=[],o.customer=e.customer,o.status=e.status,o.saleDatev1=e.saleDatev1,o.saleDatev2=e.saleDatev2,o.type=0,o.pagination=e.pagination,o.filter=e.filter,console.log(o),a.next=14,c["a"].post("/invoices/pag_payments",o).then((function(t){var a=t.data;e.$q.loading.hide(),console.log(a),e.data=a.invoices,e.pagination.rowsNumber=a.invoicesCount})).catch((function(t){return t}));case 14:case"end":return a.stop()}}),a)})))()},getClients:function(){var t=this;c["a"].get("/customers/options").then((function(e){var a=e.data;t.customerOptions=a.options,t.customerOptionsv2=a.options,t.customerOptions.push({label:"TODOS",value:"TODOS"})}))},getpendingPayments:function(t){var e=this;this.$q.loading.show(),this.qtyAbono=0,this.paymentMethod=null,this.reference=null,this.data=[],this.dataPaymentsMultiPayments=[];var a=[];a.customer=this.customerv2,c["a"].post("/invoices/getpendingPayments",a).then((function(t){var a=t.data;e.$q.loading.hide(),e.showPendingPaymentsTable=!0,e.dataPendingPayments=a.pendingPayments.data,e.maximo=a.pendingPayments.maximo.toFixed(2),e.showQty=!0,e.size="col-xs-12 col-sm-7 col-md-6 col-lg-7"}))},getPayments:function(t){var e=this,a=[];a.id=this.id_invoice,c["a"].get("/invoices/formaPagoOptions").then((function(t){var o=t.data;e.formaPagoOptions=o.options,c["a"].post("/invoices/dataFromInvoice",a).then((function(t){var a=t.data;a.result&&(e.total_invoice=parseFloat(a.total_invoice),e.dataPayments=a.payments,console.log(a.payments),e.dataPayments.length>0?c["a"].get("/invoices/keepCheckingPayments/"+e.id_invoice).then((function(t){var a=t.data;a.result?null===e.interval&&(e.interval=setInterval((function(){e.revisarPagos(e.id_invoice)}),1e4)):(clearInterval(e.interval),e.interval=null),e.disableTblPayments=!0;var o=parseFloat(e.totalAmounfromPayments);e.monto=parseFloat(e.totalAmounfromPayments),e.restante=e.total_invoice-e.monto;var i=parseFloat(e.total_invoice.toFixed(2));i>o&&(e.disableBtnAddPayment=!1,e.fetchFromServer())})):e.disableTblPayments=!1)}))}))},filterGrid:function(){var t=this;this.data=[];var e=[];e.customer=this.customer,e.status=this.status,e.saleDatev1=this.saleDatev1,e.saleDatev2=this.saleDatev2,e.type=0,e.pagination=this.pagination,e.filter=this.filter,c["a"].post("/invoices/getGridPayments",e).then((function(e){var a=e.data;a.result&&(t.data=a.invoices,t.pagination.rowsNumber=a.invoicesCount)}))},filtrarClientes:function(t,e,a){var o=this;e((function(){var e=t.toLowerCase();o.filteredCustomerOptions=o.customerOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},openPaymentModal:function(t,e,a){this.disableBtnAddPayment="PAGADO"===e,1===a.status_timbrado&&"PPD"===a.metodo_pago?(this.tableWithInvoice=!0,this.tableWithoutInvoice=!1):(this.tableWithInvoice=!1,this.tableWithoutInvoice=!0),this.cleanFields(),this.id_invoice=null,this.id_invoice=t,this.getPayments(this.id_invoice),this.paymentsModal=!0},addPayment:function(){var t=this;if(this.$v.paymentDate.$reset(),this.$v.paymentDate.$touch(),this.$v.paymentMethod.$reset(),this.$v.paymentMethod.$touch(),this.$v.qty.$reset(),this.$v.qty.$touch(),this.$v.paymentDate.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;if(this.$v.paymentMethod.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;if(this.$v.qty.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;var e=parseFloat(this.totalAmounfromPayments)+parseFloat(this.qty);e=parseFloat(e.toFixed(2));var a=parseFloat(this.total_invoice.toFixed(2));if(e>a)this.$q.notify({message:"La cantidad excede el total del pedido",position:"top",color:"negative"});else{var o="ABONADO";e===a&&(o="PAGADO");var i=[];i.id=this.id_invoice,i.qty=this.qty,i.ref=this.reference,i.method=this.paymentMethod.value,i.date=this.paymentDate,i.status=o;var n=new FormData;n.append("fileReg",this.file),n.append("id",this.id_invoice),n.append("qty",this.qty),n.append("ref",this.reference),n.append("method",this.paymentMethod.value),n.append("date",this.paymentDate),n.append("status",o),this.$q.loading.show(),c["a"].file("/invoices/addPayment",n).then((function(e){var a=e.data;if(a.result){t.cleanFields(),t.total_invoice=a.total_invoice,t.id_invoice=a.id;var o=[];o.id=t.id_invoice,t.$q.notify({message:"Pago agregado correctamente.",position:"top",color:"positive"}),t.$q.loading.hide(),t.getPayments(a.id)}else t.$q.notify({message:"Ha ocurrido un erro al intentar agregar el pago.",position:"top",color:"negative"})}))}},deletePayment:function(t,e){var a=this,o=[];o.id=t,o.remision=e,o.status="ABONADO",c["a"].post("/invoices/deletePayment",o).then((function(t){var e=t.data;if(e.result){a.$q.notify({message:"Pago eliminado correctamente.",position:"top",color:"negative"}),a.getPayments(e.id);var o=parseFloat(a.totalAmounfromPayments);a.monto=parseFloat(a.totalAmounfromPayments),a.restante=a.total_invoice-a.monto;var i=parseFloat(a.total_invoice.toFixed(2));i>o&&(a.disableBtnAddPayment=!1,a.fetchFromServer())}else a.$q.notify({message:"Ocurrio un error al intentar eliminar el pago.",position:"top",color:"negative"})}))},timbrarPago:function(t){var e=this;this.$q.loading.show(),c["a"].put("/invoices/timbrarPago/"+t.invoice_payment_id).then((function(a){var o=a.data;e.$q.loading.hide(),"error"===o.result?e.$q.notify({message:o.message.content,position:"top",color:o.result?"positive":"warning"}):e.checkPayments(t.remision_id)})).catch((function(t){console.error(t)}))},closeModalv2:function(){this.showPendingPaymentsTable=!1,this.showQty=!1,this.qty=null,this.size="col-xs-12 col-md-12 col-lg-12",this.multipayModal=!1,this.customerv2=null,this.dataPaymentsMultiPayments=[],this.fetchFromServer()},cancelarPago:function(t){var e=this;if(this.$v.folio_sustituye.$reset(),this.$v.folio_sustituye.$touch(),this.$v.folio_sustituye.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;var a={};a.motivo_cancelacion=this.motivo_cancelacion,a.folio_sustituye=this.folio_sustituye,this.$q.loading.show(),c["a"].put("/invoices/cancelarPago/"+t.invoice_payment_id,a).then((function(a){var o,i=a.data;(e.$q.loading.hide(),e.motivo_cancelacion="02",e.folio_sustituye=null,e.pagoRow=null,e.cancelarTimbrado=!1,"error"===i.result)?e.$q.notify({message:i.message.content,caption:null!==(o=i.errors)&&void 0!==o?o:"",multiLine:!0,position:"top",timeout:7e3,color:"error"!==i.result?"positive":"warning"}):e.checkPayments(t.remision_id)})).catch((function(t){console.error(t)}))},checkPayments:function(t){var e=this;c["a"].get("/invoices/keepCheckingPayments/"+t).then((function(a){var o=a.data;o.result?null===e.interval&&(e.interval=setInterval((function(){e.revisarPagos(t)}),1e4)):(clearInterval(e.interval),e.interval=null),e.getPayments(t)}))},revisarPagos:function(t){var e=this;c["a"].put("/invoices/revisarPagos/"+t).then((function(a){var o=a.data;"done"!==o.response.status&&"error"!==o.response.status&&!0!==o.response.status||e.getPayments(t)})).catch((function(t){console.error(t)}))},openActions:function(t){this.$router.push("/storage-exits/".concat(t))},openActionsv2:function(t){this.$router.push("/shopping-carts/orders/".concat(t))},cleanFields:function(){this.file=null,this.qty="",this.reference="",this.paymentMethod=null,this.id_invoice=null,this.$v.paymentDate.$reset(),this.$v.paymentMethod.$reset(),this.$v.qty.$reset()},closeModal:function(){this.paymentsModal=!1,this.fetchFromServer()},getCFDIInvoice:function(t){var e="https://batuta.wasp.mx";window.open(e+"/api/download_xml/"+t,"_blank")},getPdfInvoice:function(t,e){var a=this;this.$q.loading.show(),c["a"].fileDownload("/invoices/pdfi/".concat(t)).then((function(t){var o=t.data,i=window.URL.createObjectURL(new Blob([o],{type:"application/pdf"})),n=document.createElement("a");n.href=i,n.setAttribute("download",e),document.body.appendChild(n),a.$q.loading.hide(),n.click()}))},generatePDF:function(){var t=[],e=[];if(e=0===this.status.length?[99]:this.status,t.customer=this.customer,t.status=e,this.saleDatev1){t.saleDatev1=this.saleDatev1;while(t.saleDatev1.includes("/"))t.saleDatev1=t.saleDatev1.replace("/","-")}else t.saleDatev1=null;if(this.saleDatev2){t.saleDatev2=this.saleDatev2;while(t.saleDatev2.includes("/"))t.saleDatev2=t.saleDatev2.replace("/","-")}else t.saleDatev2=null;console.log(t);var a="https://api_alpez.wasp.mx/"+"invoices/getPdfFromPayments/".concat(t.customer,"/").concat(t.status,"/").concat(t.saleDatev1,"/").concat(t.saleDatev2);window.open(a,"_blank")},generateCSV:function(){var t=[],e=[];if(e=0===this.status.length?[99]:this.status,t.customer=this.customer,t.status=e,this.saleDatev1){t.saleDatev1=this.saleDatev1;while(t.saleDatev1.includes("/"))t.saleDatev1=t.saleDatev1.replace("/","-")}else t.saleDatev1=null;if(this.saleDatev2){t.saleDatev2=this.saleDatev2;while(t.saleDatev2.includes("/"))t.saleDatev2=t.saleDatev2.replace("/","-")}else t.saleDatev2=null;var a="https://api_alpez.wasp.mx/"+"invoices/getCSVFromPayments/".concat(t.customer,"/").concat(t.status,"/").concat(t.saleDatev1,"/").concat(t.saleDatev2);window.open(a,"_blank")},getFile:function(t){var e=this;this.$q.loading.show(),c["a"].fileDownload("/invoices/getfile/".concat(t.id)).then((function(a){var o=a.data;e.$q.loading.hide();var i=window.URL.createObjectURL(new Blob([o],{type:t.type})),n=document.createElement("a");n.href=i,n.setAttribute("download",t.file),document.body.appendChild(n),n.click()}))},uploaFile:function(t){this.modalArchivo=!0,this.auxRow=t,this.file=null},uploadDocumentFile:function(){var t=this,e=[];e.id=this.auxRow.id,e.remision_id=this.auxRow.remision_id;var a=new FormData;a.append("fileReg",this.file),a.append("id",this.auxRow.id),a.append("remision_id",this.auxRow.remision_id),this.$q.loading.show(),c["a"].file("/invoices/AddFile",a).then((function(e){var a=e.data;if(a.result){t.$q.notify({message:"Archivo Agregado correctamente.",position:"top",color:"positive"}),t.getPayments(a.id);var o=parseFloat(t.totalAmounfromPayments);t.monto=parseFloat(t.totalAmounfromPayments),t.restante=t.total_invoice-t.monto;var i=parseFloat(t.total_invoice.toFixed(2));i>o&&(t.disableBtnAddPayment=!1,t.modalArchivo=!1,t.cleanFields(),t.fetchFromServer()),t.$q.loading.hide()}else t.$q.notify({message:"Ocurrio un error al intentar Agregar el Documento.",position:"top",color:"negative"}),t.modalArchivo=!1,t.$q.loading.hide();t.modalArchivo=!1,t.$q.loading.hide()}))},openGenerateMultipay:function(){this.multipayModal=!0,this.size="col-xs-12 col-md-12 col-lg-12"},divideCantidad:function(){var t=this;0===parseFloat(this.qtyAbono)?(this.disabletablev2=!0,this.disabletable=!0):(this.disabletable=!1,this.disabletablev2=!1),Number(this.qtyAbono.replaceAll(",",""))>Number(this.maximo)?this.$q.notify({message:"la cantidad excede el adeudo total.",position:"top",color:"negative"}):(this.cantidad_distribuida=this.qtyAbono.replaceAll(",",""),this.dataPendingPayments.forEach((function(e){parseFloat(t.cantidad_distribuida)>parseFloat(e.cantidad_restante)?(e.nuevo_abono=parseFloat(e.cantidad_restante).toFixed(2),t.cantidad_distribuida=t.cantidad_distribuida-e.cantidad_restante,e.nuevo_saldo=parseFloat(e.cantidad_restante-e.nuevo_abono),e.bandera_abono=!1):(e.nuevo_abono=parseFloat(t.cantidad_distribuida).toFixed(2),t.cantidad_distribuida=t.cantidad_distribuida-e.nuevo_abono,e.nuevo_saldo=parseFloat(e.cantidad_restante-e.nuevo_abono),e.bandera_abono=!1)})))},openModal:function(){return this.$v.paymentDate.$reset(),this.$v.paymentDate.$touch(),this.$v.paymentMethod.$reset(),this.$v.paymentMethod.$touch(),this.$v.paymentDate.$error||this.$v.paymentMethod.$error?(this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1):!1===this.consultaiguales()?(this.$q.dialog({title:"Error",message:"La suma total de los abonos no es igual a la cantidad total a abonar.",persistent:!0}),!1):!1===this.consultanegativos()?(this.$q.dialog({title:"Error",message:"No puede haber saldos nuevos negativos",persistent:!0}),!1):(this.canOpen=this.consulta(),void(!0===this.canOpen?this.confirmMultipay=!0:this.generateMultiPayments()))},generateMultiPayments:function(){var t=this;if(this.canGenerateMultiPayments=this.canGenerateMultiPaymentsFunction(),!0===this.canGenerateMultiPayments){this.loading6=!0;var e=[];e.customer=this.customerv2,e.paymentDate=this.paymentDate,e.paymentMethod=this.paymentMethod.value,e.reference=this.reference,e.invoiceComp=this.timbrarComp,e.dataPayments=this.dataPaymentsMultiPayments,c["a"].post("/invoices/addMultiPayment",e).then((function(a){var o=a.data;t.dataPaymentsMultiPayments=[],console.log(o.result),o.result?(t.clearModalMultiPay(o.customer),t.$q.notify({message:o.message.content,position:"top",color:o.result?"positive":"warning"})):(t.clearModalMultiPay(e.customer),t.$q.notify({message:o.message.content,position:"top",color:"warning"}))}))}else this.loading6=!1,this.$q.notify({message:"Error en las cantidades, por favor revise.",position:"top",color:"negative"})},canGenerateMultiPaymentsFunction:function(){var t=this;return this.canGenerateMultiPaymentsv2=!0,this.canGenerateMultiPaymentsv3=!0,this.suma_limites=0,this.dataPendingPayments.forEach((function(e){parseFloat(e.nuevo_abono)>0&&t.dataPaymentsMultiPayments.push({id:e.id,nuevo_abono:e.nuevo_abono,cantidad_restante:e.cantidad_restante}),parseFloat(t.nuevo_abono)>parseFloat(e.cantidad_restante)&&(t.canGenerateMultiPaymentsv2=!1),t.suma_limites+=parseFloat(e.nuevo_abono)})),(parseFloat(this.suma_limites).toFixed(2)>parseFloat(this.maximo)||parseFloat(this.suma_limites).toFixed(2)>parseFloat(this.qtyAbono.replaceAll(",","")))&&(this.canGenerateMultiPaymentsv3=!1),this.qtyAbono>0&&(!0===this.canGenerateMultiPaymentsv2&&!0===this.canGenerateMultiPaymentsv3)},clearModalMultiPay:function(t){this.loading6=!1,this.qtyAbono=0,this.timbrarComp=1,this.confirmMultipay=!1,this.getpendingPayments(t)},consulta:function(){var t=this;return this.newAbono=0,this.dataPendingPayments.forEach((function(e){t.newAbono+=Number(e.nuevo_abono)})),parseFloat(this.newAbono).toFixed(2)<parseFloat(this.qtyAbono.replaceAll(",","")).toFixed(2)},consultaiguales:function(){var t=this;return this.newAbono=0,this.dataPendingPayments.forEach((function(e){t.newAbono+=Number(e.nuevo_abono)})),parseFloat(this.newAbono).toFixed(2)===parseFloat(this.qtyAbono.replaceAll(",","")).toFixed(2)},consultamayor:function(){var t=this;return this.aux=0,this.dataPendingPayments.forEach((function(e){console.log(parseFloat(e.nuevo_abono).toFixed(2)),console.log(),parseFloat(e.nuevo_abono).toFixed(2)>parseFloat(e.total.replaceAll(",","")).toFixed(2)&&(t.aux=t.aux+1)})),0===this.aux},consultanegativos:function(){var t=this;return this.aux=0,this.dataPendingPayments.forEach((function(e){parseFloat(e.nuevo_saldo).toFixed(2)<0&&(t.aux=t.aux+1)})),0===this.aux},clearCalculo:function(t){t.nuevo_abono=0,this.reCalculo(t)},reCalculo:function(t){var e=this;t.nuevo_abono>0&&(t.bandera_abono=!0),this.suma_modificables=0,this.contador_modificables=0,t.bandera_abono=!0,t.nuevo_saldo=t.cantidad_restante-t.nuevo_abono,this.dataPendingPayments.forEach((function(a){!0===a.bandera_abono&&(parseFloat(t.nuevo_abono)>parseFloat(t.cantidad_restante)?e.$q.notify({message:"La cantidad se excede.",position:"top",color:"negative"}):parseFloat(t.nuevo_abono)>parseFloat(e.qtyAbono)?(a.nuevo_abono=0,e.$q.notify({message:"La cantidad se excede.",position:"top",color:"negative"})):(e.suma_modificables+=parseFloat(a.nuevo_abono),e.contador_modificables++))})),parseFloat(this.suma_modificables>this.qtyAbono.replaceAll(",",""))?this.$q.notify({message:"La cantidad se excede.",position:"top",color:"negative"}):(this.diferencia=parseFloat(this.qtyAbono.replaceAll(",","")-this.suma_modificables).toFixed(2),this.dataPendingPayments.forEach((function(t){!1===t.bandera_abono&&(parseFloat(e.diferencia)>parseFloat(t.cantidad_restante)?(t.nuevo_abono=parseFloat(t.cantidad_restante).toFixed(2),t.nuevo_saldo=parseFloat(t.cantidad_restante-t.nuevo_abono),e.diferencia=e.diferencia-t.cantidad_restante):(t.nuevo_abono=parseFloat(e.diferencia).toFixed(2),t.nuevo_saldo=parseFloat(t.cantidad_restante-t.nuevo_abono),e.diferencia=e.diferencia-t.nuevo_abono))})))}}},f=v,h=(a("98be"),a("2877")),b=a("9989"),g=a("ead5"),y=a("079e"),_=a("9c40"),q=a("05c0"),w=a("ddd8"),x=a("7cbe"),P=a("52ee"),C=a("66e5"),D=a("4074"),k=a("0170"),A=a("9564"),F=a("eaac"),S=a("27f9"),$=a("0016"),O=a("bd08"),M=a("db86"),E=a("b047"),I=a("24e8"),N=a("f09f"),T=a("ca78"),R=a("7d53"),G=a("4b7e"),Q=a("a370"),L=a("7f67"),Y=a("eebe"),B=a.n(Y),z=Object(h["a"])(f,o,i,!1,null,null,null);e["default"]=z.exports;B()(z,"components",{QPage:b["a"],QBreadcrumbs:g["a"],QBreadcrumbsEl:y["a"],QBtn:_["a"],QTooltip:q["a"],QSelect:w["a"],QPopupProxy:x["a"],QDate:P["a"],QItem:C["a"],QItemSection:D["a"],QItemLabel:k["a"],QToggle:A["a"],QTable:F["a"],QInput:S["a"],QIcon:$["a"],QTr:O["a"],QTd:M["a"],QChip:E["a"],QDialog:I["a"],QCard:N["a"],QTime:T["a"],QFile:R["a"],QCardActions:G["a"],QCardSection:Q["a"]}),B()(z,"directives",{ClosePopup:L["a"]})}}]);