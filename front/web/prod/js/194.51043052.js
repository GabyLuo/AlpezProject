(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[194],{c8dd:function(e,s,r){"use strict";r.r(s);var t=function(){var e=this,s=e.$createElement,r=e._self._c||s;return r("q-page",{staticClass:"bg-grey-3"},[r("div",{staticClass:"q-pa-sm panel-header"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-sm-6"},[r("div",{staticClass:"q-pa-md q-gutter-sm"},[r("q-breadcrumbs",{staticStyle:{"font-size":"20px"},attrs:{align:"left"}},[r("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),r("q-breadcrumbs-el",{attrs:{label:"Usuarios",to:"/users"}}),r("q-breadcrumbs-el",{attrs:{label:"Editar"},domProps:{textContent:e._s(e.user.fields.email)}})],1)],1)])])]),r("div",{staticClass:"q-pa-md bg-grey-3"},[r("div",{staticClass:"row bg-white border-panel"},[r("div",{staticClass:"col q-pa-md"},[e.activeRoles.includes(14)||e.activeRoles.includes(16)?r("div",{staticClass:"row q-col-gutter-xs"},[r("div",{staticClass:"col-xs-12 col-sm-3"},[r("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.user.fields.nickname.$error,label:"Nombre completo",rules:e.nicknameRules},on:{input:function(s){e.user.fields.nickname=s.toUpperCase()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-signature"}})]},proxy:!0}],null,!1,395819190),model:{value:e.user.fields.nickname,callback:function(s){e.$set(e.user.fields,"nickname",s)},expression:"user.fields.nickname"}})],1),r("div",{staticClass:"col-xs-12 col-sm-3"},[r("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.user.fields.email.$error,label:"Dirección de correo electrónico",rules:e.emailRules},on:{input:function(s){e.user.fields.email=s.toLowerCase()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-at"}})]},proxy:!0}],null,!1,3975172935),model:{value:e.user.fields.email,callback:function(s){e.$set(e.user.fields,"email",s)},expression:"user.fields.email"}})],1),r("div",{staticClass:"col-xs-12 col-sm-3"},[r("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.user.fields.password.$error,label:"Contraseña",type:e.isPwd?"password":"text"},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-key"}})]},proxy:!0},{key:"append",fn:function(){return[r("q-icon",{staticClass:"cursor-pointer",attrs:{name:e.isPwd?"visibility_off":"visibility"},on:{click:function(s){e.isPwd=!e.isPwd}}})]},proxy:!0}],null,!1,1771644498),model:{value:e.user.fields.password,callback:function(s){e.$set(e.user.fields,"password",s)},expression:"user.fields.password"}})],1),r("div",{staticClass:"col-xs-12 col-sm-3 text-center"},[r("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.customer.$error,options:e.customersOptions,label:"Cliente",rules:e.customerRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-shopping-cart"}})]},proxy:!0}],null,!1,3118906287),model:{value:e.customer,callback:function(s){e.customer=s},expression:"customer"}})],1)]):r("div",{staticClass:"row q-col-gutter-xs"},[26!==e.user.fields.role_id?r("div",{staticClass:"col-xs-12 col-sm-3 text-center"},[r("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.branchesList,label:"Estaciones",error:e.$v.user.fields.branch_id.$error,rules:e.branchOfficeRules,"emit-value":"","map-options":""},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"business"}})]},proxy:!0}],null,!1,3736652810),model:{value:e.user.fields.branch_id,callback:function(s){e.$set(e.user.fields,"branch_id",s)},expression:"user.fields.branch_id"}})],1):r("div",{staticClass:"col-xs-12 col-sm-3 text-center"},[r("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.clusterOptions,label:"Cluster","emit-value":"","map-options":""},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"business"}})]},proxy:!0}]),model:{value:e.user.fields.cluster_id,callback:function(s){e.$set(e.user.fields,"cluster_id",s)},expression:"user.fields.cluster_id"}})],1),r("div",{staticClass:"col-xs-12 col-sm-3"},[r("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.user.fields.nickname.$error,label:"Nombre completo",rules:e.nicknameRules},on:{input:function(s){e.user.fields.nickname=s.toUpperCase()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-signature"}})]},proxy:!0}]),model:{value:e.user.fields.nickname,callback:function(s){e.$set(e.user.fields,"nickname",s)},expression:"user.fields.nickname"}})],1),r("div",{staticClass:"col-xs-12 col-sm-3"},[r("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.user.fields.email.$error,label:"Dirección de correo electrónico",rules:e.emailRules},on:{input:function(s){e.user.fields.email=s.toLowerCase()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-at"}})]},proxy:!0}]),model:{value:e.user.fields.email,callback:function(s){e.$set(e.user.fields,"email",s)},expression:"user.fields.email"}})],1),r("div",{staticClass:"col-xs-12 col-sm-3"},[r("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.user.fields.password.$error,label:"Contraseña",type:e.isPwd?"password":"text"},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-key"}})]},proxy:!0},{key:"append",fn:function(){return[r("q-icon",{staticClass:"cursor-pointer",attrs:{name:e.isPwd?"visibility_off":"visibility"},on:{click:function(s){e.isPwd=!e.isPwd}}})]},proxy:!0}]),model:{value:e.user.fields.password,callback:function(s){e.$set(e.user.fields,"password",s)},expression:"user.fields.password"}})],1),r("div",{staticClass:"col-xs-12 col-sm-3"},[r("q-select",{staticClass:"uppcase",attrs:{color:"dark",borderless:"","bg-color":"secondary",filled:"",label:"Rol",options:e.selectRoles,error:e.$v.user.fields.role_id.$error,"emit-value":"","map-options":""},model:{value:e.user.fields.role_id,callback:function(s){e.$set(e.user.fields,"role_id",s)},expression:"user.fields.role_id"}})],1)]),r("div",{staticClass:"row q-mb-sm q-mt-md"},[r("div",{staticClass:"col-xs-12 col-sm-2 offset-sm-10 pull-right"},[r("q-btn",{attrs:{color:"positive",icon:"save",label:"Actualizar"},on:{click:function(s){return e.updateUser()}}})],1)])])])])])},i=[],o=r("ded3"),l=r.n(o),n=(r("caad"),r("2532"),r("a9e3"),r("d3b7"),r("159b"),r("b0c0"),r("aabb")),a=r("b5ae"),c=a.required,u=a.maxLength,d=a.email,f={name:"EditUser",validations:{user:{fields:{email:{required:c,maxLength:u(150),email:d},nickname:{required:c,maxLength:u(150)},password:{},role_id:{required:c},branch_id:{required:c}}},customer:{required:c}},beforeRouteEnter:function(e,s,r){r((function(e){var s=e.$store.getters["users/rol"];console.log(s),1===s||3===s||7===s?r():r("/")}))},data:function(){return{user:{fields:{id:null,email:null,nickname:null,password:null,role_id:null,branch_id:null,cluster_id:null}},isPwd:!0,customer:null,activeRoles:[],rolesOptions:[],customersOptions:[],branchesList:[],selectRoles:[],clusterOptions:[]}},computed:{emailRules:function(e){var s=this;return[function(e){return s.$v.user.fields.email.required||"El campo Dirección de correo electrónico es requerido."},function(e){return s.$v.user.fields.email.maxLength||"El campo Dirección de correo electrónico no debe exceder los 100 dígitos."},function(e){return s.$v.user.fields.email.email||"El campo Dirección de correo electrónico debe contener una dirección de correo electrónico válida."}]},nicknameRules:function(e){var s=this;return[function(e){return s.$v.user.fields.nickname.required||"El campo Nickname es requerido."},function(e){return s.$v.user.fields.nickname.maxLength||"El campo Nickname no debe exceder los 100 dígitos."}]},customerRules:function(e){var s=this;return this.activeRoles.includes(14)||this.activeRoles.includes(16)?[function(e){return s.$v.customer.required||"El campo Cliente es requerido."}]:[]},branchOfficeRules:function(e){var s=this;return[function(e){return s.$v.user.fields.branch_id.required||"El campo estación es requerido."}]}},created:function(){this.fetchFromServer(),this.getRoles(),this.getBranchesList(),this.getClusterList()},methods:{fetchFromServer:function(){var e=this;this.$q.loading.show();var s=this.$route.params.id;n["a"].get("/customers/options").then((function(r){var t=r.data;e.customersOptions=t.options,n["a"].get("/roles/options").then((function(r){var t=r.data;e.rolesOptions=t.options,n["a"].get("/users/".concat(s)).then((function(s){var r=s.data;r&&r.user&&r.user.id?(e.user.fields=r.user,e.activeRoles=r.user.roles,e.customer={value:r.user.customerId,label:r.user.customer},e.$q.loading.hide()):e.$router.push("/users")}))}))}))},activeRolesChanged:function(){this.activeRoles.includes(14)||this.activeRoles.includes(16)||(this.customer=null)},updateUser:function(){var e=this;if(26===this.user.fields.role_id&&(this.user.fields.branch_id=0),this.$v.user.fields.$reset(),this.$v.user.fields.$touch(),(this.activeRoles.includes(14)||this.activeRoles.includes(16))&&(this.$v.customer.$reset(),this.$v.customer.$touch()),this.$v.user.fields.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;if((this.activeRoles.includes(14)||this.activeRoles.includes(16))&&this.$v.customer.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;this.$q.loading.show();var s=l()({},this.user.fields);n["a"].put("/users/".concat(s.id),s).then((function(s){var r=s.data;e.$q.notify({message:r.message.content,position:"top",color:r.result?"positive":"warning"}),r.result,e.$q.loading.hide()}))},updateRoles:function(){var e=this;this.$q.loading.show();var s=[];s.roles=this.activeRoles,this.customer&&this.customer.value&&(s.customerId=Number(this.customer.value)),n["a"].put("/users/roles/".concat(this.user.fields.id),s).then((function(s){var r=s.data;e.$q.notify({message:r.message.content,position:"top",color:r.result?"positive":"warning"}),r.result?(e.$q.loading.hide(),e.fetchFromServer()):e.$q.loading.hide()}))},getBranchesList:function(){var e=this;n["a"].get("branch-offices/options").then((function(s){e.branchesList=s.data.options}))},getClusterList:function(){var e=this;n["a"].get("supercluster/getOptions").then((function(s){e.clusterOptions=s.data.options}))},getRoles:function(){var e=this;this.selectRoles=[],n["a"].get("/roles").then((function(s){var r=s.data;r.roles.length>0&&r.roles.forEach((function(s){e.selectRoles.push({label:s.name,value:s.id})}))})).catch((function(e){return e}))}}},p=f,m=r("2877"),v=r("9989"),h=r("ead5"),b=r("079e"),g=r("27f9"),q=r("0016"),$=r("ddd8"),k=r("9f0a"),x=r("9c40"),y=r("eebe"),w=r.n(y),C=Object(m["a"])(p,t,i,!1,null,null,null);s["default"]=C.exports;w()(C,"components",{QPage:v["a"],QBreadcrumbs:h["a"],QBreadcrumbsEl:b["a"],QInput:g["a"],QIcon:q["a"],QSelect:$["a"],QOptionGroup:k["a"],QBtn:x["a"]})}}]);