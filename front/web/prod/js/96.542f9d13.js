(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[96],{ee22:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-page",[r("div",{staticClass:"q-pa-sm panel-header"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-sm-8"},[r("span",{staticClass:"q-ml-md grey-8 fs28 page-title"},[e._v("Pedidos por producir")])]),r("div",{staticClass:"col-sm-4 pull-right"},[r("div",{staticClass:"q-pa-md q-gutter-sm"},[r("q-breadcrumbs",{attrs:{align:"right"}},[r("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),r("q-breadcrumbs-el",{attrs:{label:"Pedidos por producir"}})],1)],1)])])]),r("div",{staticClass:"q-pa-md bg-grey-3"},[r("div",{staticClass:"row bg-white border-panel"},[r("div",{staticClass:"col q-pa-md"},[r("q-table",{attrs:{flat:"",bordered:"",data:e.products,columns:e.columns,"row-key":"category",pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t}},[r("q-td",{key:"category",attrs:{props:t}},[e._v(e._s(t.row.category_name))]),r("q-td",{key:"line",attrs:{props:t}},[e._v(e._s(t.row.line_name))]),r("q-td",{key:"product",attrs:{props:t}},[e._v(e._s(t.row.product_name))]),r("q-td",{key:"qty",attrs:{props:t}},[e._v(e._s(t.row.qty)+" Kg.")]),r("q-td",{key:"actions",attrs:{props:t}},[r("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(r){return e.openDetailModal(t.row)}}},[r("q-tooltip",{attrs:{"content-class":"bg-primary"}},[e._v("Ver")])],1)],1)],1)]}}])})],1)])]),r("q-dialog",{attrs:{persistent:""},model:{value:e.detailModal,callback:function(t){e.detailModal=t},expression:"detailModal"}},[r("q-card",{staticStyle:{"min-width":"400px"}},[r("q-card-section",[r("div",{staticClass:"text-h6"},[e._v("Detalles respecto a producto "+e._s(null!=e.selectedProduct?e.selectedProduct.category_code+"-"+e.selectedProduct.line_code+"-"+e.selectedProduct.product_name:""))])]),r("q-card-section",[r("q-table",{attrs:{flat:"",bordered:"",data:e.productDetails,columns:e.productDetailsColumns,"row-key":"order",pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t}},[r("q-td",{key:"order",attrs:{props:t}},[e._v(e._s(t.row.shopping_cart_id))]),r("q-td",{key:"qty",attrs:{props:t}},[e._v(e._s(t.row.qty)+" Kg.")])],1)]}}])})],1),r("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar"},on:{click:function(t){return e.closeDetailModal()}}}),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Generar OP"},on:{click:function(t){return e.openGenerateProductionOrderModal(e.selectedProduct)}}})],1)],1)],1),r("q-dialog",{attrs:{persistent:""},model:{value:e.generateProductionOrdenModal,callback:function(t){e.generateProductionOrdenModal=t},expression:"generateProductionOrdenModal"}},[r("q-card",{staticStyle:{"min-width":"400px"}},[r("q-card-section",[r("div",{staticClass:"text-h6"},[e._v("Generar orden de producción del producto "+e._s(e.productionOrder.fields.productName))])]),r("q-card-section",[r("div",{staticClass:"col-xs-12"},[r("q-select",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",mask:"date",label:"Fecha programada",rules:e.creationDateRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"event"}})]},proxy:!0}]),model:{value:e.productionOrder.fields.productionDate,callback:function(t){e.$set(e.productionOrder.fields,"productionDate",t)},expression:"productionOrder.fields.productionDate"}},[r("q-popup-proxy",{ref:"productionOrderFieldsCreationDateRef",attrs:{"transition-show":"scale","transition-hide":"scale"}},[r("div",{staticClass:"col-sm-12"},[r("q-date",{attrs:{"today-btn":""},on:{input:function(){return e.$refs.productionOrderFieldsCreationDateRef.hide()}},model:{value:e.productionOrder.fields.productionDate,callback:function(t){e.$set(e.productionOrder.fields,"productionDate",t)},expression:"productionOrder.fields.productionDate"}})],1)])],1)],1),r("div",{staticClass:"col-xs-12"},[r("q-input",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",label:"Producto",disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-building"}})]},proxy:!0}]),model:{value:e.productionOrder.fields.productName,callback:function(t){e.$set(e.productionOrder.fields,"productName",t)},expression:"productionOrder.fields.productName"}})],1),r("div",{staticClass:"col-xs-12"},[r("q-input",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",error:e.$v.productionOrder.fields.qty.$error,label:"Peso solicitado",rules:e.qtyRules,suffix:"Kg.",min:"1"},on:{input:function(t){e.productionOrder.fields.qty=t.replace(/[^0-9\\.]/g,"")}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-weight-hanging"}})]},proxy:!0}]),model:{value:e.productionOrder.fields.qty,callback:function(t){e.$set(e.productionOrder.fields,"qty",t)},expression:"productionOrder.fields.qty"}})],1),r("div",{staticClass:"col-xs-12"},[r("q-select",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",options:e.lotOptions,label:"Lotes",rules:e.lotsQtyRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"fas fa-box-open"}})]},proxy:!0}]),model:{value:e.productionOrder.fields.lotsQty,callback:function(t){e.$set(e.productionOrder.fields,"lotsQty",t)},expression:"productionOrder.fields.lotsQty"}})],1)]),r("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar"},on:{click:function(t){return e.closeGenerateProductionOrdenModal()}}}),r("q-btn",{attrs:{flat:"",label:"Generar"},on:{click:function(t){return e.generateProductionOrder()}}})],1)],1)],1)],1)},i=[],a=(r("caad"),r("2532"),r("d3b7"),r("159b"),r("a9e3"),r("4de4"),r("99af"),r("aabb")),d=r("b5ae"),n=d.required,l=d.decimal,s={name:"IndexOrdersToBeProduced",validations:{productionOrder:{fields:{productionDate:{required:n},qty:{required:n,decimal:l},lotsQty:{required:n}}}},data:function(){return{currentTab:"baleOrders",pagination:{sortBy:"category",descending:!1,rowsPerPage:50},columns:[{name:"category",align:"left",label:"Categoría",field:"category",sortable:!0},{name:"line",align:"left",label:"Línea",field:"line",sortable:!0},{name:"product",align:"left",label:"Producto",field:"product",sortable:!0},{name:"qty",align:"right",label:"Cantidad",field:"qty",sortable:!0},{name:"actions",align:"center",label:"Acciones",field:"actions",sortable:!1}],productDetailsColumns:[{name:"order",align:"left",label:"# Pedido",field:"order",sortable:!0},{name:"qty",align:"right",label:"Cantidad",field:"qty",sortable:!0}],productionOrder:{fields:{productionDate:null,productName:null,productId:null,qty:null,lotsQty:null,minQty:null}},lotOptions:[{value:1,label:1},{value:2,label:2},{value:3,label:3},{value:4,label:4},{value:5,label:5},{value:6,label:6},{value:7,label:7},{value:8,label:8},{value:9,label:9},{value:10,label:10}],products:[],baleDetails:[],inBulkDetails:[],laminateDetails:[],productDetails:[],selectedProduct:null,detailModal:!1,generateProductionOrdenModal:!1}},beforeCreate:function(){this.$store.getters["users/roles"].includes(1)||this.$store.getters["users/roles"].includes(3)||this.$store.getters["users/roles"].includes(7)||this.$store.getters["users/roles"].includes(17)||this.$router.push("/")},mounted:function(){this.fetchFromServer()},computed:{creationDateRules:function(e){var t=this;return[function(e){return t.$v.productionOrder.fields.productionDate.required||"El campo Fecha de creación es requerido."}]},qtyRules:function(e){var t=this;return[function(e){return t.$v.productionOrder.fields.qty.required||"El campo Cantidad es requerido."},function(e){return t.$v.productionOrder.fields.qty.decimal||"El campo Cantidad debe ser numérico."}]},lotsQtyRules:function(e){var t=this;return[function(e){return t.$v.productionOrder.fields.lotsQty.required||"El campo Lotes es requerido."}]}},methods:{fetchFromServer:function(){var e=this;this.$q.loading.show(),a["a"].get("/shopping-cart-bale-details/without-stock").then((function(t){var r=t.data;e.baleDetails=r.details,a["a"].get("/shopping-cart-in-bulk-details/without-stock").then((function(t){var r=t.data;e.inBulkDetails=r.details,a["a"].get("/shopping-cart-laminate-details/without-stock").then((function(t){var r=t.data;e.laminateDetails=r.details,e.products=[];var o=[];e.baleDetails.forEach((function(t){if(o.includes(Number(t.product_id)))for(var r=0;r<e.products.length;r++)Number(t.product_id)===Number(e.products[r].product_id)&&(e.products[r].qty+=Number(t.qty));else o.push(Number(t.product_id)),e.products.push({category_id:t.category_id,category_code:t.category_code,category_name:t.category_name,line_id:t.line_id,line_code:t.line_code,line_name:t.line_name,product_id:t.product_id,product_code:t.product_code,product_name:t.product_name,qty:Number(t.qty)})})),e.inBulkDetails.forEach((function(t){if(o.includes(Number(t.product_id)))for(var r=0;r<e.products.length;r++)Number(t.product_id)===Number(e.products[r].product_id)&&(e.products[r].qty+=Number(t.qty));else o.push(Number(t.product_id)),e.products.push({category_id:t.category_id,category_code:t.category_code,category_name:t.category_name,line_id:t.line_id,line_code:t.line_code,line_name:t.line_name,product_id:t.product_id,product_code:t.product_code,product_name:t.product_name,qty:Number(t.qty)})})),e.laminateDetails.forEach((function(t){if(o.includes(Number(t.product_id)))for(var r=0;r<e.products.length;r++)Number(t.product_id)===Number(e.products[r].product_id)&&(e.products[r].qty+=Number(t.qty));else o.push(Number(t.product_id)),e.products.push({category_id:t.category_id,category_code:t.category_code,category_name:t.category_name,line_id:t.line_id,line_code:t.line_code,line_name:t.line_name,product_id:t.product_id,product_code:t.product_code,product_name:t.product_name,qty:Number(t.qty)})})),e.$q.loading.hide()}))}))}))},openDetailModal:function(e){switch(this.selectedProduct=e,Number(e.category_id)){case 5:this.productDetails=this.laminateDetails.filter((function(t){return Number(t.product_id)===Number(e.product_id)}));break;case 6:this.productDetails=this.baleDetails.filter((function(t){return Number(t.product_id)===Number(e.product_id)}));break;case 13:this.productDetails=this.inBulkDetails.filter((function(t){return Number(t.product_id)===Number(e.product_id)}));break;default:break}this.detailModal=!0},closeDetailModal:function(){this.detailModal=!1,this.selectedProduct=null},openGenerateProductionOrderModal:function(e){6===Number(e.category_id)?(this.detailModal&&(this.detailModal=!1),this.generateProductionOrdenModal=!0,this.productionOrder.fields.productId=Number(e.product_id),this.productionOrder.fields.productName="".concat(e.category_code,"-").concat(e.line_code,"-").concat(e.product_name),this.productionOrder.fields.qty=Number(e.qty),this.productionOrder.fields.minQty=Number(e.qty)):this.$q.notify({message:"El producto seleccionado no es fibra.",position:"top",color:"warning"})},closeGenerateProductionOrdenModal:function(){this.productionOrder.fields.productionDate=null,this.productionOrder.fields.productName=null,this.productionOrder.fields.productId=null,this.productionOrder.fields.qty=null,this.productionOrder.fields.lotsQty=null,this.productionOrder.fields.minQty=null},generateProductionOrder:function(){var e=this;if(this.$v.productionOrder.fields.$reset(),this.$v.productionOrder.fields.$touch(),this.$v.productionOrder.fields.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;if(Number(this.productionOrder.fields.qty)<Number(this.productionOrder.fields.minQty))return this.$q.dialog({title:"Error",message:"Por favor, ingrese un peso mayor o igual al mínimo necesario que es de ".concat(this.productionOrder.fields.minQty,"."),persistent:!0}),!1;this.$q.loading.show();var t=[];t.productionDate=this.productionOrder.fields.productionDate,t.productId=this.productionOrder.fields.productId,t.qty=this.productionOrder.fields.qty,t.lotsQty=this.productionOrder.fields.lotsQty.value,a["a"].post("/shopping-cart-bale-details/generate-production-order",t).then((function(t){var r=t.data;e.$q.notify({message:r.message.content,position:"top",color:r.result?"positive":"warning"}),r.result?(e.closeGenerateProductionOrdenModal(),e.$q.loading.hide(),e.fetchFromServer()):e.$q.loading.hide()}))}}},c=s,u=r("2877"),p=r("9989"),f=r("ead5"),m=r("079e"),b=r("429b"),y=r("7460"),g=r("eaac"),_=r("bd08"),h=r("db86"),q=r("9c40"),v=r("05c0"),O=r("24e8"),k=r("f09f"),D=r("a370"),N=r("4b7e"),w=r("ddd8"),P=r("0016"),Q=r("7cbe"),C=r("52ee"),$=r("27f9"),x=r("7f67"),M=r("eebe"),S=r.n(M),E=Object(u["a"])(c,o,i,!1,null,null,null);t["default"]=E.exports;S()(E,"components",{QPage:p["a"],QBreadcrumbs:f["a"],QBreadcrumbsEl:m["a"],QTabs:b["a"],QTab:y["a"],QTable:g["a"],QTr:_["a"],QTd:h["a"],QBtn:q["a"],QTooltip:v["a"],QDialog:O["a"],QCard:k["a"],QCardSection:D["a"],QCardActions:N["a"],QSelect:w["a"],QIcon:P["a"],QPopupProxy:Q["a"],QDate:C["a"],QInput:$["a"]}),S()(E,"directives",{ClosePopup:x["a"]})}}]);