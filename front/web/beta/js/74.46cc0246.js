(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[74],{7194:function(e,t,a){"use strict";a.r(t);a("99af");var r=function(){var e=this,t=e._self._c;return t("q-page",[t("div",{staticClass:"q-pa-sm panel-header"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-9"},[t("span",{staticClass:"q-ml-md grey-8 fs28 page-title"},[e._v("Laminado "+e._s(e.$route.params.id))])]),t("div",{staticClass:"col-sm-3"},[t("div",{staticClass:"q-pa-md q-gutter-sm"},[t("q-breadcrumbs",{attrs:{align:"right"}},[t("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),t("q-breadcrumbs-el",{attrs:{label:"Laminados",to:"/laminates"}}),t("q-breadcrumbs-el",{attrs:{label:"Editar"}})],1)],1)])])]),t("div",{staticClass:"q-pa-md bg-grey-3"},[t("div",{staticClass:"row bg-white border-panel"},[t("div",{staticClass:"col q-pa-md"},[t("div",{staticClass:"row q-mb-sm"},["NUEVO"==e.laminate.fields.status&&e.materials.length>0?t("div",{staticClass:"col-xs-12 col-sm-2 offset-sm-10 pull-right"},[t("q-btn",{staticStyle:{"margin-right":"5px"},attrs:{color:"warning",icon:"fas fa-cogs",label:"Producir"},on:{click:function(t){return e.openOperatorModal()}}})],1):e._e(),"PRODUCIENDO"==e.laminate.fields.status&&e.materials.length>0?t("div",{staticClass:"col-xs-12 col-sm-2 offset-sm-10 pull-right"},[t("q-btn",{staticStyle:{"margin-right":"5px"},attrs:{color:"positive",icon:"check",label:"Terminar"},on:{click:function(t){return e.finish()}}})],1):e._e()]),t("div",{staticClass:"row q-col-gutter-xs"},[t("div",{staticClass:"col-sm-12 col-md-2"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.laminate.fields.scheduledDate.$error,mask:"date",label:"Fecha programada",rules:e.scheduledDateRules,disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"event"}})]},proxy:!0}]),model:{value:e.laminate.fields.scheduledDate,callback:function(t){e.$set(e.laminate.fields,"scheduledDate",t)},expression:"laminate.fields.scheduledDate"}},[t("q-popup-proxy",{ref:"laminateFieldsScheduledDateRef",attrs:{"transition-show":"scale","transition-hide":"scale"}},[t("div",{staticClass:"col-sm-12"},[t("q-date",{attrs:{"today-btn":""},on:{input:function(){return e.$refs.laminateFieldsScheduledDateRef.hide()}},model:{value:e.laminate.fields.scheduledDate,callback:function(t){e.$set(e.laminate.fields,"scheduledDate",t)},expression:"laminate.fields.scheduledDate"}})],1)])],1)],1),t("div",{staticClass:"col-sm-12 col-md-2"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.laminate.fields.product.$error,options:e.productOptions,label:"Producto",rules:e.productRules,disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"emoji_objects"}})]},proxy:!0}]),model:{value:e.laminate.fields.product,callback:function(t){e.$set(e.laminate.fields,"product",t)},expression:"laminate.fields.product"}})],1),t("div",{staticClass:"col-sm-12 col-md-3"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.laminate.fields.branchOffice.$error,options:e.branchOfficeOptions,label:"Sucursal",rules:e.branchOfficeRules,disable:""},on:{input:e.branchOfficeUpdated},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-store-alt"}})]},proxy:!0}]),model:{value:e.laminate.fields.branchOffice,callback:function(t){e.$set(e.laminate.fields,"branchOffice",t)},expression:"laminate.fields.branchOffice"}})],1),t("div",{staticClass:"col-sm-12 col-md-3"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.laminate.fields.storage.$error,options:e.storageOptions,label:"Almacén",rules:e.storageRules,disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}]),model:{value:e.laminate.fields.storage,callback:function(t){e.$set(e.laminate.fields,"storage",t)},expression:"laminate.fields.storage"}})],1),t("div",{staticClass:"col-sm-12 col-md-2 text-center"},[t("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",label:"Estatus",disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"battery_full"}})]},proxy:!0}]),model:{value:e.laminate.fields.status,callback:function(t){e.$set(e.laminate.fields,"status",t)},expression:"laminate.fields.status"}})],1)])])]),t("br"),t("div",{staticClass:"bg-white border-panel"},[t("q-tabs",{staticClass:"text-grey",attrs:{dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}},[t("q-tab",{attrs:{name:"materials",label:"Materiales"}}),"PRODUCIENDO"==e.laminate.fields.status||"TERMINADO"==e.laminate.fields.status?t("q-tab",{attrs:{name:"additives",label:"Aditivos"}}):e._e()],1),t("q-separator"),t("q-tab-panels",{attrs:{animated:""},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}},[t("q-tab-panel",{attrs:{name:"materials"}},[t("div",{staticStyle:{"font-weight":"normal"}},["NUEVO"==e.laminate.fields.status?t("div",{staticClass:"row q-col-gutter-xs",staticStyle:{"padding-right":"2%"}},[t("div",{staticClass:"col-xs-12 col-sm-4 offset-sm-8 pull-right"},[t("q-btn",{attrs:{color:"primary",icon:"add",label:"Agregar"},on:{click:function(t){return e.addMaterial()}}})],1)]):e._e(),"NUEVO"==e.laminate.fields.status?t("div",{staticClass:"row q-col-gutter-xs",staticStyle:{padding:"2%"}},[t("div",{staticClass:"col-xs-12 col-sm-4"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",error:e.$v.material.fields.storage.$error,options:e.storageOptions,label:"Almacén",rules:e.storageRules,disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}],null,!1,3703881239),model:{value:e.material.fields.storage,callback:function(t){e.$set(e.material.fields,"storage",t)},expression:"material.fields.storage"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.materialProductOptions,label:"Producto",rules:e.materialProductRules},on:{input:function(){return e.material.fields.bale=null}},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"emoji_objects"}})]},proxy:!0}],null,!1,2431477873),model:{value:e.material.fields.product,callback:function(t){e.$set(e.material.fields,"product",t)},expression:"material.fields.product"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.filteredBaleOptions,label:"Paca",rules:e.baleRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-th-large"}})]},proxy:!0}],null,!1,2172036542),model:{value:e.material.fields.bale,callback:function(t){e.$set(e.material.fields,"bale",t)},expression:"material.fields.bale"}})],1)]):e._e(),t("div",{staticClass:"q-col-gutter-xs",staticStyle:{padding:"2%"}},[t("q-table",{attrs:{flat:"",bordered:"",data:e.materials,columns:e.materialsColumns,pagination:e.pagination,"row-key":"bale"},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body",fn:function(a){return[t("q-tr",{attrs:{props:a}},[t("q-td",{key:"bale",staticStyle:{"text-align":"left",width:"20%"},attrs:{props:a}},[e._v(e._s(a.row.bale_id?"PACA ".concat(a.row.bale_id):null))]),a.row.id?t("q-td",{key:"product",staticStyle:{"text-align":"left",width:"40%"},attrs:{props:a}},[e._v(e._s(a.row.product))]):t("q-td",{key:"product",staticStyle:{"text-align":"right",width:"40%",color:"#3CB371"},attrs:{props:a}},[e._v(e._s(a.row.product))]),a.row.id?t("q-td",{key:"qty",staticStyle:{"text-align":"right",width:"20%"},attrs:{props:a}},[e._v(e._s(e.formatPrice(a.row.qty))+" KG.")]):t("q-td",{key:"qty",staticStyle:{"text-align":"right",width:"20%",color:"#3CB371"},attrs:{props:a}},[e._v(e._s("".concat(e.formatPrice(e.totalMaterialsQties)," KG. (").concat(e.materials.length-1," SACOS)")))]),"NUEVO"==e.laminate.fields.status&&a.row.bale_id?t("q-td",{key:"actions",staticStyle:{width:"20%"},attrs:{props:a}},[t("q-btn",{attrs:{color:"primary",icon:"fas fa-trash-alt",flat:"",size:"10px"},nativeOn:{click:function(t){return e.removeMaterial(a.row.id)}}},[t("q-tooltip",{attrs:{"content-class":"bg-red"}},[e._v("Eliminar")])],1)],1):t("q-td",{key:"actions",staticStyle:{width:"20%"},attrs:{props:a}})],1)]}}])})],1)])]),"PRODUCIENDO"==e.laminate.fields.status||"TERMINADO"==e.laminate.fields.status?t("q-tab-panel",{attrs:{name:"additives"}},[t("div",{staticClass:"q-col-gutter-xs",staticStyle:{padding:"2%"}},[t("q-table",{attrs:{flat:"",bordered:"",data:e.additives,columns:e.additivesColumns,pagination:e.pagination,"row-key":"bale"},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body",fn:function(a){return[t("q-tr",{attrs:{props:a}},[a.row.id?t("q-td",{key:"product",staticStyle:{"text-align":"left",width:"75%"},attrs:{props:a}},[e._v(e._s(a.row.product))]):e._e(),a.row.id?t("q-td",{key:"qty",staticStyle:{"text-align":"right",width:"25%"},attrs:{props:a}},[e._v(e._s(e.formatPrice(a.row.qty))+" KG.")]):e._e()],1)]}}],null,!1,1438611759)})],1)]):e._e()],1)],1)]),t("q-dialog",{attrs:{persistent:""},model:{value:e.selectOperatorModal,callback:function(t){e.selectOperatorModal=t},expression:"selectOperatorModal"}},[t("q-card",{staticStyle:{"min-width":"400px"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("Seleccionar Operador")])]),t("q-card-section",[t("q-select",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",error:e.$v.operator.$error,options:e.operatorOptions,label:"Operador",rules:e.operatorRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fa fa-user"}})]},proxy:!0}]),model:{value:e.operator,callback:function(t){e.operator=t},expression:"operator"}})],1),t("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar"},on:{click:function(t){return e.cancelProduce()}}}),t("q-btn",{attrs:{flat:"",label:"Registrar operador"},on:{click:function(t){return e.produce()}}})],1)],1)],1)],1)},i=[],l=a("ded3"),s=a.n(l),o=(a("4de4"),a("d3b7"),a("a9e3"),a("ac1f"),a("5319"),a("b680"),a("25f0"),a("14d9"),a("159b"),a("aabb")),n=a("b5ae"),c=n.required,d={name:"EditLaminate",validations:{laminate:{fields:{scheduledDate:{required:c},product:{required:c},branchOffice:{required:c},storage:{required:c}}},material:{fields:{storage:{required:c},product:{required:c},bale:{required:c}}},operator:{required:c}},data:function(){return{formatter:new Intl.NumberFormat("en-US"),laminate:{fields:{scheduledDate:null,product:null,branchOffice:null,storage:null}},productOptions:[],branchOfficeOptions:[],storageOptions:[],currentTab:"materials",materialProductOptions:[],baleOptions:[],materials:[],materialsColumns:[{name:"bale",align:"center",label:"Paca",field:"bale",style:"width: 20%",sortable:!0},{name:"product",align:"center",label:"Producto",field:"product",style:"width: 40%",sortable:!0},{name:"qty",align:"center",label:"Peso",field:"qty",style:"width: 20%",sortable:!0},{name:"actions",align:"center",label:"Acciones",field:"actions",style:"width: 20%",sortable:!1}],pagination:{rowsPerPage:50},additives:[],additivesColumns:[{name:"product",align:"center",label:"Producto",field:"product",style:"width: 75%",sortable:!0},{name:"qty",align:"center",label:"Peso",field:"qty",style:"width: 25%",sortable:!0}],material:{fields:{storage:null,product:null,bale:null}},selectOperatorModal:!1,operator:null,operatorOptions:[]}},computed:{scheduledDateRules:function(e){var t=this;return[function(e){return t.$v.laminate.fields.scheduledDate.required||"El campo Fecha programada es requerido."}]},productRules:function(e){var t=this;return[function(e){return t.$v.laminate.fields.product.required||"El campo Producto es requerido."}]},branchOfficeRules:function(e){var t=this;return[function(e){return t.$v.laminate.fields.branchOffice.required||"El campo Sucursal es requerido."}]},storageRules:function(e){var t=this;return[function(e){return t.$v.laminate.fields.storage.required||"El campo Almacén es requerido."}]},materialProductRules:function(e){var t=this;return[function(e){return t.$v.material.fields.product.required||"El campo Producto es requerido."}]},baleRules:function(e){var t=this;return[function(e){return t.$v.material.fields.bale.required||"El campo Paca es requerido."}]},operatorRules:function(e){var t=this;return[function(e){return t.$v.operator.required||"El campo Operador es requerido."}]},filteredBaleOptions:function(){var e=this;return null!=this.material.fields.product&&null!=this.material.fields.product.value?this.baleOptions.filter((function(t){return Number(t.product_id)===Number(e.material.fields.product.value)})):[]}},created:function(){this.fetchFromServer()},methods:{formatPrice:function(e){var t=(e/1).toFixed(1).replace(".",",");return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},fetchFromServer:function(){var e=this;this.$q.loading.show();var t=this.$route.params.id;o["a"].get("/laminates/".concat(t)).then((function(a){var r=a.data;r.laminate||e.$router.push("/laminates"),e.laminate.fields.id=r.laminate.id,e.laminate.fields.scheduledDate=r.laminate.scheduled_date,e.laminate.fields.product={value:r.laminate.product_id,label:r.laminate.product},e.laminate.fields.branchOffice={value:r.laminate.branch_office_id,label:r.laminate.branch_office},e.laminate.fields.storage={value:r.laminate.storage_id,label:r.laminate.storage},e.laminate.fields.status=r.laminate.status,o["a"].get("/products/options").then((function(a){var r=a.data;e.productOptions=r.options,o["a"].get("/branch-offices/options").then((function(a){var r=a.data;e.branchOfficeOptions=r.options,o["a"].get("/storages/options").then((function(a){var r=a.data;e.storageOptions=r.options;var i=e.storageOptions.filter((function(t){return Number(t.branchOffice)===Number(e.laminate.fields.branchOffice.value)&&1===Number(t.storageType)}));i.length>0?(e.material.fields.storage={value:i[0].value,label:i[0].label},o["a"].get("/storages/".concat(i[0].value,"/bales")).then((function(a){var r=a.data;e.baleOptions=[],r.bales.forEach((function(t){e.baleOptions.push({value:t.bale_id,label:"PACA ".concat(t.bale_id," (").concat(t.stock," KG.)"),product_id:t.product_id})})),e.productOptions.forEach((function(t){e.baleOptions.filter((function(e){return Number(e.product_id)===Number(t.value)})).length>0&&e.materialProductOptions.push({value:t.value,label:t.label})})),o["a"].get("/laminate-materials/laminate/".concat(t)).then((function(a){var r=a.data;e.materials=r.materials,o["a"].get("/laminate-additives/laminate/".concat(t)).then((function(t){var a=t.data;e.additives=a.additives,e.$q.loading.hide()}))}))}))):(e.material.fields.storage=null,e.$q.loading.hide())}))}))}))}))},openOperatorModal:function(){var e=this;this.$q.loading.show(),o["a"].get("/operators/options").then((function(t){var a=t.data;e.operatorOptions=a.options,e.selectOperatorModal=!0,e.$q.loading.hide()}))},cancelProduce:function(){this.operator=null,this.selectOperatorModal=!1},produce:function(){var e=this;if(this.$v.operator.$reset(),this.$v.operator.$touch(),this.$v.operator.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;this.$q.loading.show();var t=[];t.operatorId=Number(s()({},this.operator).value),this.operator=null,this.selectOperatorModal=!1,o["a"].put("/laminates/".concat(this.$route.params.id,"/produce"),t).then((function(t){var a=t.data;e.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result?(e.$q.loading.hide(),e.fetchFromServer()):e.$q.loading.hide()}))},finish:function(){var e=this;this.$q.loading.show(),o["a"].put("/laminates/".concat(this.$route.params.id,"/finish")).then((function(t){var a=t.data;e.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result?(e.$q.loading.hide(),e.fetchFromServer()):e.$q.loading.hide()}))},branchOfficeUpdated:function(){var e=this;if(null!=this.laminate.fields.branchOffice&&null!=this.laminate.fields.branchOffice.value){var t=this.storageOptions.filter((function(t){return Number(t.branchOffice)===Number(e.laminate.fields.branchOffice.value)&&8===Number(t.storageType)})),a=this.storageOptions.filter((function(t){return Number(t.branchOffice)===Number(e.laminate.fields.branchOffice.value)&&1===Number(t.storageType)}));t.length>0?this.laminate.fields.storage={value:t[0].value,label:t[0].label}:this.laminate.fields.storage=null,a.length>0?this.material.fields.storage={value:a[0].value,label:a[0].label}:this.material.fields.storage=null}},addMaterial:function(){var e=this;if(this.$v.material.fields.$reset(),this.$v.material.fields.$touch(),this.$v.material.fields.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;this.$q.loading.show();var t=[];t.laminateId=Number(this.$route.params.id),t.baleId=Number(s()({},this.material.fields).bale.value),o["a"].post("/laminate-materials",t).then((function(t){var a=t.data;e.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result?(e.material.fields.product=null,e.material.fields.bale=null,o["a"].get("/laminate-materials/laminate/".concat(e.$route.params.id)).then((function(t){var a=t.data;e.materials=a.materials,e.$q.loading.hide()}))):e.$q.loading.hide()}))},removeMaterial:function(e){var t=this;this.$q.loading.show(),o["a"].delete("/laminate-materials/".concat(e)).then((function(e){var a=e.data;t.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result?o["a"].get("/laminate-materials/laminate/".concat(t.$route.params.id)).then((function(e){var a=e.data;t.materials=a.materials,t.$q.loading.hide()})):t.$q.loading.hide()}))}}},u=d,f=a("2877"),p=a("9989"),m=a("ead5"),b=a("079e"),h=a("9c40"),g=a("ddd8"),v=a("0016"),q=a("7cbe"),y=a("52ee"),O=a("27f9"),$=a("429b"),w=a("7460"),_=a("eb85"),k=a("adad"),x=a("823b"),C=a("eaac"),S=a("bd08"),P=a("db86"),N=a("05c0"),D=a("24e8"),E=a("f09f"),Q=a("a370"),R=a("4b7e"),T=a("7f67"),M=a("eebe"),A=a.n(M),I=Object(f["a"])(u,r,i,!1,null,null,null);t["default"]=I.exports;A()(I,"components",{QPage:p["a"],QBreadcrumbs:m["a"],QBreadcrumbsEl:b["a"],QBtn:h["a"],QSelect:g["a"],QIcon:v["a"],QPopupProxy:q["a"],QDate:y["a"],QInput:O["a"],QTabs:$["a"],QTab:w["a"],QSeparator:_["a"],QTabPanels:k["a"],QTabPanel:x["a"],QTable:C["a"],QTr:S["a"],QTd:P["a"],QTooltip:N["a"],QDialog:D["a"],QCard:E["a"],QCardSection:Q["a"],QCardActions:R["a"]}),A()(I,"directives",{ClosePopup:T["a"]})}}]);