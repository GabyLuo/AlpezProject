(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[113],{bcd7:function(t,e,i){"use strict";i.r(e);i("14d9");var a=function(){var t=this,e=t._self._c;return e("q-page",{staticClass:"bg-grey-3"},[e("div",{staticClass:"q-pa-sm panel-header"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-8"},[e("div",{staticClass:"q-pa-md q-gutter-sm"},[e("q-breadcrumbs",{staticStyle:{"font-size":"20px"},attrs:{align:"left"}},[e("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),e("q-breadcrumbs-el",{attrs:{label:"Ordenes de compra"}})],1)],1)]),1===t.roleId||22===t.roleId||20===t.roleId||28===t.roleId?e("div",{staticClass:"col-xs-6 col-md-4 pull-right"},[e("div",{staticClass:"q-pa-sm q-gutter-sm"},[e("q-btn",{attrs:{color:"primary",icon:"add",label:"Nuevo"},nativeOn:{click:function(e){return t.$router.push("/purchase-orders/new")}}})],1)]):t._e()])]),e("div",{staticClass:"q-pa-md bg-grey-3"},[e("div",{staticClass:"row bg-white border-panel"},[e("div",{staticClass:"col q-pa-md"},[e("q-table",{attrs:{flat:"",bordered:"",data:t.data,columns:t.columns,"row-key":"serial",pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"body",fn:function(i){return[e("q-tr",{attrs:{props:i}},[e("q-td",{key:"serial",staticStyle:{"text-align":"center",width:"10%"},attrs:{props:i}},[t._v(t._s(i.row.serial))]),e("q-td",{key:"supplier",staticStyle:{"text-align":"left",width:"35%"},attrs:{props:i}},[t._v(t._s(i.row.supplier))]),e("q-td",{key:"order_date",staticStyle:{width:"15%"},attrs:{props:i}},[t._v(t._s(i.row.order_date))]),e("q-td",{key:"requested_date",staticStyle:{width:"15%"},attrs:{props:i}},[t._v(t._s(i.row.requested_date))]),e("q-td",{key:"status",staticStyle:{width:"10%","text-align":"center"},attrs:{props:i}},[e("q-chip",{attrs:{square:"",dense:"",color:"NUEVO"==i.row.status?"secondary":"COTIZADO"==i.row.status?"warning":"PEDIDO"==i.row.status?"orange":"EMBARCADO"==i.row.status?"purple-6":"ARRIBO"==i.row.status?"accent":"RECEPCION"==i.row.status?"light-green":"RECIBIDO"==i.row.status?"green":"PARCIAL"==i.row.status?"red-4":"red-6","text-color":"white"}},[t._v("\n                  "+t._s(i.row.status)+"\n                ")])],1),"Cerrado"!=i.row.status?e("q-td",{key:"actions",staticStyle:{width:"10%","text-align":"left"},attrs:{props:i}},[e("q-btn",{attrs:{color:"primary",icon:i.row.hayrestante||null===i.row.shipment_id?"add":"edit",flat:"",size:"10px"},nativeOn:{click:function(e){i.row.hayrestante||null===i.row.shipment_id?t.newShipment(i.row.id):t.editShipment(i.row.shipment_id)}}},[i.row.hayrestante||null===i.row.shipment_id?e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Nueva Recepción")]):e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Editar Recepción")])],1),e("q-btn",{attrs:{color:"primary",icon:"fas fa-eye",flat:"",size:"10px"},nativeOn:{click:function(e){return t.shipmentsModal(i.row)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver Recepciones")])],1)],1):e("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:i}},[e("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(e){return t.editSelectedRow(i.row.id)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver detalles")])],1)],1)],1)]}}])})],1)])]),e("q-dialog",{attrs:{persistent:""},model:{value:t.showShipments,callback:function(e){t.showShipments=e},expression:"showShipments"}},[e("q-card",{staticClass:"q-pt-md",staticStyle:{"min-width":"900px"}},[e("q-card-section",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 text-h5 text-center"},[e("label",{attrs:{for:""}},[t._v("Recepciones Orden de Compra "+t._s(t.foliooc))])])])]),e("q-card-section",{staticClass:"q-pt-none"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 col-xs-12 q-pa-xs"},[e("q-table",{attrs:{flat:"",bordered:"","row-key":"name",data:t.shipments,columns:t.shipmentColumns,pagination:t.pagination,"hide-pagination":""},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"body",fn:function(i){return[e("q-tr",{attrs:{props:i}},[e("q-td",{key:"serial",staticStyle:{"text-align":"center",width:"10%"},attrs:{props:i}},[t._v(t._s(i.row.serial))]),e("q-td",{key:"receive_date",staticStyle:{width:"30%"},attrs:{props:i}},[t._v(t._s(i.row.receive_date))]),e("q-td",{key:"status",staticStyle:{width:"30%"},attrs:{props:i}},[e("q-chip",{attrs:{square:"",dense:"",color:"NUEVO"==i.row.status?"secondary":"MUESTREADO"==i.row.status?"warning":"RECIBIDO"==i.row.status?"orange":"ANALIZADO"==i.row.status?"positive":"RECHAZADO"==i.row.status?"negative":"blue","text-color":"white"}},[t._v("\n                    "+t._s(i.row.status)+"\n                  ")])],1),"RECIBIDO"!=i.row.status?e("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:i}},[e("q-btn",{attrs:{color:i.row.invoice?"positive":"negative",icon:"cloud_upload",flat:"",size:"10px"},nativeOn:{click:function(e){return t.openUploadShipmentInvoiceModal(i.row)}}},[e("q-tooltip",{attrs:{"content-class":i.row.invoice?"bg-positive":"bg-negative"}},[t._v("Subir archivo")])],1),i.row.invoice?e("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(e){return t.showShipmentInvoiceFile(i.row)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver factura")])],1):t._e(),i.row.invoice?e("q-btn",{attrs:{color:"primary",icon:"cloud_download",flat:"",size:"10px"},nativeOn:{click:function(e){return t.downloadShipmentInvoiceFile(i.row)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Descargar factura")])],1):t._e(),e("q-btn",{attrs:{color:"primary",icon:"fas fa-edit",flat:"",size:"10px"},nativeOn:{click:function(e){return t.editShipment(i.row.id)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Editar")])],1),e("q-btn",{attrs:{color:"primary",icon:"fas fa-trash-alt",flat:"",size:"10px"},nativeOn:{click:function(e){return t.removeShipment(i.row)}}},[e("q-tooltip",{attrs:{"content-class":"bg-red"}},[t._v("Eliminar")])],1)],1):e("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:i}},[e("q-btn",{attrs:{color:i.row.invoice?"positive":"negative",icon:"cloud_upload",flat:"",size:"10px"},nativeOn:{click:function(e){return t.openUploadShipmentInvoiceModal(i.row)}}},[e("q-tooltip",{attrs:{"content-class":i.row.invoice?"bg-positive":"bg-negative"}},[t._v("Subir factura")])],1),i.row.invoice?e("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(e){return t.showShipmentInvoiceFile(i.row)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver factura")])],1):t._e(),i.row.invoice?e("q-btn",{attrs:{color:"primary",icon:"cloud_download",flat:"",size:"10px"},nativeOn:{click:function(e){return t.downloadShipmentInvoiceFile(i.row)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Descargar factura")])],1):t._e(),"RECIBIDO"==i.row.status?e("q-btn",{attrs:{color:"primary",icon:"fas fa-file-pdf",flat:"",size:"10px"},nativeOn:{click:function(e){return t.generateShipmentPdf(i.row.id)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver ticket de entrada")])],1):t._e(),e("q-btn",{attrs:{color:"primary",icon:"remove_red_eye",flat:"",size:"10px"},nativeOn:{click:function(e){return t.editShipment(i.row.id)}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("Ver detalles")])],1)],1)],1)]}}])})],1)])]),e("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cerrar",color:"red"}})],1)],1)],1),e("q-dialog",{attrs:{persistent:""},model:{value:t.shipmentInvoiceModal,callback:function(e){t.shipmentInvoiceModal=e},expression:"shipmentInvoiceModal"}},[e("q-card",[e("q-card-section",{staticClass:"row"},[e("div",{staticClass:"col-xs-12 col-sm-10 text-h6"},[t._v("Factura: Recepción "+t._s(t.shipmentInvoice.fields.shipmentSerial))]),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col-xs-12 col-sm-2 pull-right",attrs:{icon:"close",flat:"",round:"",dense:""}})],1),e("q-card-section",[e("q-uploader",{ref:"fileShipmentInvoiceRef",attrs:{url:t.fileShipmentInvoiceUrl,method:"POST","hide-upload-btn":""},on:{uploaded:t.afterUploadShipmentInvoiceFile}})],1),e("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[e("q-btn",{attrs:{flat:"",label:"Subir archivo"},on:{click:function(e){return t.uploadShipmentInvoiceFile()}}})],1)],1)],1)],1)},n=[],s=(i("99af"),i("a9e3"),i("aabb")),o={name:"IndexPurchaseOrders",data:function(){return{shipmentInvoiceModal:!1,shipments:[],foliooc:null,showShipments:!1,pagination:{sortBy:"serial",descending:!0,rowsPerPage:25},shipmentInvoice:{fields:{shipmentId:null,shipmentSerial:null}},columns:[{name:"serial",align:"center",label:"FOLIO",field:"serial",style:"width: 10%",sortable:!0},{name:"supplier",align:"center",label:"PROVEEDOR",field:"supplier",style:"width: 35%",sortable:!0},{name:"order_date",align:"center",label:"FECHA DE PEDIDO",field:"order_date",style:"width: 15%",sortable:!0},{name:"requested_date",align:"center",label:"FECHA DE ARRIBO",field:"requested_date",style:"width: 15%",sortable:!0},{name:"status",align:"center",label:"ESTATUS",field:"status",style:"width: 10%",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",style:"width: 10%",sortable:!1}],shipmentColumns:[{name:"serial",align:"center",label:"FOLIO",field:"serial",style:"width: 10%",sortable:!0},{name:"receive_date",align:"center",label:"FECHA DE RECEPCION",field:"receive_date",style:"width: 30%",sortable:!0},{name:"status",align:"center",label:"ESTATUS",field:"status",style:"width: 30%",sortable:!0},{name:"actions",align:"center",label:"ACCIONES",field:"actions",style:"width: 10%",sortable:!1}],data:[]}},computed:{roleId:function(){var t=this.$store.getters["users/rol"];return parseInt(t)},fileShipmentInvoiceUrl:function(){return"".concat("http://api.alpez.beta.wasp.mx/","shipments/").concat(this.shipmentInvoice.fields.shipmentId,"/invoice-file")}},beforeRouteEnter:function(t,e,i){i((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||3===e||7===e||2===e||20===e||4===e||27===e||20===e||22===e|28===e?i():i("/")}))},mounted:function(){this.fetchFromServer()},methods:{generateShipmentPdf:function(t){var e="http://api.alpez.beta.wasp.mx/"+"shipments/pdf/".concat(t);window.open(e,"_blank")},afterUploadShipmentInvoiceFile:function(t){var e=JSON.parse(t.xhr.response);this.$q.notify({message:e.message.content,position:"top",color:e.result?"positive":"warning"}),e.result&&(this.fetchFromServer(),this.shipmentInvoiceModal=!1)},openUploadShipmentInvoiceModal:function(t){this.shipmentInvoice.fields.shipmentId=t.id,this.shipmentInvoice.fields.shipmentSerial=t.serial,this.shipmentInvoiceModal=!0},downloadShipmentInvoiceFile:function(t){t.invoice?window.open("".concat("http://api.alpez.beta.wasp.mx/","shipments/").concat(t.id,"/invoice-file/download"),"_blank"):this.$q.notify({message:"La recepción no cuenta con una factura subida",position:"top",color:"warning"})},showShipmentInvoiceFile:function(t){t.invoice?window.open("".concat(this.serverUrl,"assets/shipments/invoices/").concat(t.invoice),"_blank"):this.$q.notify({message:"La recepción no cuenta con una factura subida",position:"top",color:"warning"})},editShipment:function(t){this.$router.push("/shipments/".concat(t,"/",1))},removeShipment:function(t){var e=this;this.$q.loading.show(),s["a"].delete("/shipments/".concat(t.id)).then((function(t){var i=t.data;e.$q.notify({message:i.message.content,position:"top",color:i.result?"positive":"warning"}),i.result&&(e.fetchFromServer(),e.$q.loading.hide())}))},shipmentsModal:function(t){var e=this;s["a"].get("/shipments/order/".concat(t.id)).then((function(t){var i=t.data;console.log(i),e.shipments=i.shipments})),this.foliooc=t.serial,this.showShipments=!0},newShipment:function(t){var e=Number(t);this.$router.push("/shipments/purcharse-order/".concat(e,"/",1))},fetchFromServer:function(){var t=this;this.$q.loading.show(),s["a"].get("/purchase-orders/all").then((function(e){var i=e.data;console.log(i),i.result?(t.showShipments=!1,t.data=i.orders):t.$q.notify({message:i.message.content,position:"top",color:"warning",icon:"close"}),t.$q.loading.hide()}))},editSelectedRow:function(t){this.$router.push("/purchase-orders/".concat(t))},deleteSelectedRow:function(t){var e=this;this.$q.dialog({title:"Confirmación",message:"¿Desea eliminar esta Orden de Compra?",persistent:!0,ok:"Eliminar",cancel:"Cancelar"}).onOk((function(){s["a"].delete("/purchase-orders/".concat(t)).then((function(t){var i=t.data;e.$q.notify({message:i.message.content,position:"top",color:i.result?"positive":"warning",icon:i.result?"thumb_up":"close"}),i.result&&e.fetchFromServer()}))})).onCancel((function(){}))}}},r=o,c=i("2877"),l=i("9989"),p=i("ead5"),d=i("079e"),u=i("9c40"),h=i("eaac"),m=i("bd08"),v=i("db86"),f=i("b047"),w=i("05c0"),b=i("24e8"),g=i("f09f"),q=i("a370"),y=i("4b7e"),_=i("ee89"),S=i("7f67"),I=i("eebe"),C=i.n(I),O=Object(c["a"])(r,a,n,!1,null,null,null);e["default"]=O.exports;C()(O,"components",{QPage:l["a"],QBreadcrumbs:p["a"],QBreadcrumbsEl:d["a"],QBtn:u["a"],QTable:h["a"],QTr:m["a"],QTd:v["a"],QChip:f["a"],QTooltip:w["a"],QDialog:b["a"],QCard:g["a"],QCardSection:q["a"],QCardActions:y["a"],QUploader:_["a"]}),C()(O,"directives",{ClosePopup:S["a"]})}}]);