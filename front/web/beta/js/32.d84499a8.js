(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[32],{a006:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("q-page",[t("div",{staticClass:"q-pa-sm panel-header"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-8"},[t("q-btn",{attrs:{color:"primary",icon:"keyboard_backspace",label:"Regresar"},on:{click:function(t){return e.backToGrid()}}}),t("span",{staticClass:"q-ml-md grey-8 fs28 page-title"},[e._v("Apertura de paca "+e._s(e.$route.params.id))])],1),t("div",{staticClass:"col-sm-4"},[t("div",{staticClass:"q-pa-md q-gutter-sm"},[t("q-breadcrumbs",{attrs:{align:"right"}},[t("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),t("q-breadcrumbs-el",{attrs:{label:"Apertura de pacas",to:"/bale-opening"}}),t("q-breadcrumbs-el",{attrs:{label:"Editar"}})],1)],1)])])]),t("div",{staticClass:"q-pa-md bg-grey-3"},[t("div",{staticClass:"row bg-white border-panel"},[t("div",{staticClass:"col q-pa-md"},[t("div",{staticClass:"row q-col-gutter-xs"},[t("div",{staticClass:"col-xs-12 col-sm-3"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",mask:"date",label:"Fecha",rules:e.dateRules,disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"event"}})]},proxy:!0}]),model:{value:e.baleOpening.fields.date,callback:function(t){e.$set(e.baleOpening.fields,"date",t)},expression:"baleOpening.fields.date"}},[t("q-popup-proxy",{ref:"baleOpeningFieldsSaleDate",attrs:{"transition-show":"scale","transition-hide":"scale"}},[t("div",{staticClass:"col-sm-12"},[t("q-date",{attrs:{"today-btn":""},on:{input:function(){return e.$refs.baleOpeningFieldsSaleDate.hide()}},model:{value:e.baleOpening.fields.date,callback:function(t){e.$set(e.baleOpening.fields,"date",t)},expression:"baleOpening.fields.date"}})],1)])],1)],1),t("div",{staticClass:"col-xs-12 col-sm-6 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.branchOfficeOptions,label:"Sucursal",rules:e.branchOfficeRules,disable:""},on:{input:function(){e.baleOpening.fields.baleStorage=null,e.baleOpening.fields.inBulkStorage=null}},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-store-alt"}})]},proxy:!0}]),model:{value:e.baleOpening.fields.branchOffice,callback:function(t){e.$set(e.baleOpening.fields,"branchOffice",t)},expression:"baleOpening.fields.branchOffice"}})],1),t("div",{staticClass:"col-xs-12 col-sm-3 text-center"},[t("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",label:"Estatus",disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"battery_full"}})]},proxy:!0}]),model:{value:e.baleOpening.fields.status,callback:function(t){e.$set(e.baleOpening.fields,"status",t)},expression:"baleOpening.fields.status"}})],1),t("div",{staticClass:"col-xs-12 col-sm-6 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.filteredStorageOptions,label:"Almacén de pacas",rules:e.baleStorageRules,disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}]),model:{value:e.baleOpening.fields.baleStorage,callback:function(t){e.$set(e.baleOpening.fields,"baleStorage",t)},expression:"baleOpening.fields.baleStorage"}})],1),t("div",{staticClass:"col-xs-12 col-sm-6 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.filteredStorageOptions,label:"Almacén fibra abierta",rules:e.inBulkStorageRules,disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-warehouse"}})]},proxy:!0}]),model:{value:e.baleOpening.fields.inBulkStorage,callback:function(t){e.$set(e.baleOpening.fields,"inBulkStorage",t)},expression:"baleOpening.fields.inBulkStorage"}})],1),t("div",{staticClass:"col-xs-12 col-sm-6 text-center"},[t("q-select",{attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.operatorOptions,label:"Operador",rules:e.operatorRules,disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fa fa-user"}})]},proxy:!0}]),model:{value:e.baleOpening.fields.operator,callback:function(t){e.$set(e.baleOpening.fields,"operator",t)},expression:"baleOpening.fields.operator"}})],1),t("div",{staticClass:"col-xs-12 col-sm-6 text-center"},[t("q-input",{attrs:{color:"dark","bg-color":"secondary",filled:"",label:"Responsable",disable:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fa fa-user"}})]},proxy:!0}]),model:{value:e.baleOpening.fields.openedBy,callback:function(t){e.$set(e.baleOpening.fields,"openedBy",t)},expression:"baleOpening.fields.openedBy"}})],1)]),t("div",{staticClass:"row q-mb-sm q-mt-md"},["NUEVO"==e.baleOpening.fields.status?t("div",{staticClass:"col-xs-12 col-sm-2 offset-sm-10 pull-right"},[t("q-btn",{staticStyle:{"margin-right":"5px"},attrs:{color:"warning",icon:"fas fa-bolt",label:"Ejecutar"},on:{click:function(t){return e.execute()}}})],1):e._e()])])]),t("br"),t("div",{staticClass:"row bg-white border-panel"},[t("div",{staticClass:"col q-pa-md"},["NUEVO"==e.baleOpening.fields.status?t("div",{staticClass:"row q-col-gutter-xs",staticStyle:{"padding-right":"2%"}},[t("div",{staticClass:"col-xs-12 col-sm-4 offset-sm-8 pull-right"},[t("q-btn",{attrs:{color:"primary",icon:"add",label:"Agregar"},on:{click:function(t){return e.addDetail()}}})],1)]):e._e(),"NUEVO"==e.baleOpening.fields.status?t("div",{staticClass:"row q-col-gutter-xs",staticStyle:{padding:"2%"}},[t("div",{staticClass:"col-xs-12 col-sm-4"},[t("q-select",{ref:"detailFieldsBaleRef",attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.productOptions,label:"Producto Paca",rules:e.productRules},on:{input:function(){return e.detail.fields.bale=null}},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"emoji_objects"}})]},proxy:!0}],null,!1,2431477873),model:{value:e.detail.fields.product,callback:function(t){e.$set(e.detail.fields,"product",t)},expression:"detail.fields.product"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4"},[t("q-select",{ref:"detailFieldsBaleRef",attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.filteredBaleOptions,label:"Paca",rules:e.baleRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"fas fa-th-large"}})]},proxy:!0}],null,!1,2172036542),model:{value:e.detail.fields.bale,callback:function(t){e.$set(e.detail.fields,"bale",t)},expression:"detail.fields.bale"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4"},[t("q-select",{ref:"detailFieldsBaleRef",attrs:{color:"dark","bg-color":"secondary",filled:"",options:e.bulkFiberProductOptions,label:"Producto fibra abierta",rules:e.bulkFiberProductRules},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"emoji_objects"}})]},proxy:!0}],null,!1,2431477873),model:{value:e.detail.fields.bulkFiberProduct,callback:function(t){e.$set(e.detail.fields,"bulkFiberProduct",t)},expression:"detail.fields.bulkFiberProduct"}})],1)]):e._e(),t("div",{staticClass:"q-col-gutter-xs",staticStyle:{padding:"2%"}},[t("q-table",{attrs:{flat:"",bordered:"",data:e.details,columns:e.detailsColumns,"row-key":"bale_id",pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body",fn:function(a){return[t("q-tr",{attrs:{props:a}},[t("q-td",{key:"bale_id",staticStyle:{"text-align":"left",width:"20%"},attrs:{props:a}},[e._v(e._s(a.row.bale_id?"PACA ".concat(a.row.bale_id):null))]),t("q-td",{key:"bale_product_name",staticStyle:{"text-align":"left",width:"25%"},attrs:{props:a}},[e._v(e._s(a.row.bale_product_name))]),t("q-td",{key:"bulk_product_name",staticStyle:{"text-align":"left",width:"25%"},attrs:{props:a}},[e._v(e._s(a.row.bulk_product_name))]),t("q-td",{key:"qty",staticStyle:{"text-align":"right",width:"15%"},attrs:{props:a}},[e._v(e._s("".concat(e.formatter.format(a.row.qty)," KG.")))]),a.row.id&&"NUEVO"==e.baleOpening.fields.status?t("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:a}},[t("q-btn",{attrs:{color:"primary",icon:"fas fa-trash-alt",flat:"",size:"10px"},nativeOn:{click:function(t){return e.removeDetail(a.row.id)}}},[t("q-tooltip",{attrs:{"content-class":"bg-red"}},[e._v("Eliminar")])],1)],1):t("q-td",{key:"actions",staticStyle:{width:"10%"},attrs:{props:a}})],1)]}}])})],1)])])])])},i=[],r=a("ded3"),s=a.n(r),n=(a("4de4"),a("d3b7"),a("a9e3"),a("159b"),a("caad"),a("2532"),a("14d9"),a("99af"),a("aabb")),o=a("b5ae"),d=o.required,c={name:"EditBaleOpening",validations:{baleOpening:{fields:{date:{required:d},operator:{required:d},branchOffice:{required:d},baleStorage:{required:d},inBulkStorage:{required:d},openedBy:{required:d}}},detail:{fields:{product:{required:d},bale:{required:d},bulkFiberProduct:{required:d}}}},data:function(){return{formatter:new Intl.NumberFormat("en-US"),baleOpening:{fields:{id:null,date:null,operator:null,branchOffice:null,baleStorage:null,inBulkStorage:null,openedBy:null,status:null}},detail:{fields:{id:null,product:null,bale:null,bulkFiberProduct:null}},branchOfficeOptions:[],storageOptions:[],operatorOptions:[],productOptions:[],bulkFiberProductOptions:[],availableBales:[],details:[],detailsColumns:[{name:"bale_id",align:"center",label:"Paca",field:"bale_id",style:"width: 20%",sortable:!0},{name:"bale_product_name",align:"center",label:"Producto Paca",field:"bale_product_name",style:"width: 30%",sortable:!0},{name:"bulk_product_name",align:"center",label:"Producto fibra abierta",field:"bulk_product_name",style:"width: 30%",sortable:!0},{name:"qty",align:"center",label:"Peso",field:"qty",style:"width: 10%",sortable:!0},{name:"actions",align:"center",label:"Acciones",field:"actions",style:"width: 10%",sortable:!1}],pagination:{rowsPerPage:50}}},computed:{dateRules:function(e){var t=this;return[function(e){return t.$v.baleOpening.fields.date.required||"El campo Fecha de venta es requerido."}]},branchOfficeRules:function(e){var t=this;return[function(e){return t.$v.baleOpening.fields.branchOffice.required||"El campo Sucursal es requerido."}]},operatorRules:function(e){var t=this;return[function(e){return t.$v.baleOpening.fields.operator.required||"El campo Operador es requerido."}]},baleStorageRules:function(e){var t=this;return[function(e){return t.$v.baleOpening.fields.baleStorage.required||"El campo Almacén de pacas es requerido."}]},inBulkStorageRules:function(e){var t=this;return[function(e){return t.$v.baleOpening.fields.inBulkStorage.required||"El campo Almacén fibra abierta es requerido."}]},productRules:function(e){var t=this;return[function(e){return t.$v.detail.fields.product.required||"El campo Producto Paca es requerido."}]},baleRules:function(e){var t=this;return[function(e){return t.$v.detail.fields.bale.required||"El campo Paca es requerido."}]},bulkFiberProductRules:function(e){var t=this;return[function(e){return t.$v.detail.fields.bulkFiberProduct.required||"El campo Producto fibra abierta es requerido."}]},filteredStorageOptions:function(){var e=this,t=[];return null!=this.baleOpening.fields.branchOffice&&null!=this.baleOpening.fields.branchOffice.value&&(t=this.storageOptions.filter((function(t){return Number(t.branchOffice)===Number(e.baleOpening.fields.branchOffice.value)}))),t},filteredBaleOptions:function(){var e=this;return this.detail.fields.product&&!isNaN(this.detail.fields.product.value)?this.availableBales.filter((function(t){return Number(t.product_id)===Number(e.detail.fields.product.value)})):[]},totalDetailsQties:function(){var e=new Intl.NumberFormat("en-US"),t=0;return this.details.forEach((function(e){e.qty&&(t+=Number(e.qty))})),e.format(t)}},beforeCreate:function(){this.$store.getters["users/roles"].includes(1)||this.$store.getters["users/roles"].includes(3)||this.$store.getters["users/roles"].includes(7)||this.$store.getters["users/roles"].includes(2)||this.$store.getters["users/roles"].includes(3)||this.$store.getters["users/roles"].includes(4)||this.$store.getters["users/roles"].includes(5)||this.$store.getters["users/roles"].includes(13)||this.$router.push("/")},created:function(){this.fetchFromServer()},methods:{fetchFromServer:function(){var e=this;this.$q.loading.show();var t=this.$route.params.id;n["a"].get("/bale-openings/".concat(t)).then((function(a){var l=a.data;l.baleOpening?(e.baleOpening.fields.id=t,e.baleOpening.fields.date=l.baleOpening.date,e.baleOpening.fields.operator={value:l.baleOpening.operator_id,label:l.baleOpening.operator_name},e.baleOpening.fields.branchOffice={value:l.baleOpening.branch_office_id,label:l.baleOpening.branch_office_name},e.baleOpening.fields.baleStorage={value:l.baleOpening.bale_storage_id,label:l.baleOpening.bale_storage_name},e.baleOpening.fields.inBulkStorage=l.baleOpening.in_bulk_storage_id&&l.baleOpening.in_bulk_storage_name?{value:l.baleOpening.in_bulk_storage_id,label:l.baleOpening.in_bulk_storage_name}:null,e.baleOpening.fields.openedBy=l.baleOpening.opened_by,e.baleOpening.fields.status=l.baleOpening.status,n["a"].get("/products/options/category/13").then((function(a){var l=a.data;e.bulkFiberProductOptions=l.options,n["a"].get("/bale-opening-details/".concat(t)).then((function(t){var a=t.data;e.details=a.details;var l=[];a.details.forEach((function(e){l.push(Number(e.bale_id))})),n["a"].get("/storages/".concat(e.baleOpening.fields.baleStorage.value,"/bales")).then((function(t){var a=t.data;e.availableBales=[];var i=a.bales;i.forEach((function(t){l.includes(Number(t.bale_id))||e.availableBales.push({value:t.bale_id,label:"PACA ".concat(t.bale_id," (").concat(t.stock," KG.)"),product_id:t.product_id}),0===e.productOptions.filter((function(e){return Number(e.value)===Number(t.product_id)})).length&&e.productOptions.push({value:t.product_id,label:"".concat(t.category_code,"-").concat(t.line_code,"-").concat(t.product_name)})})),e.$q.loading.hide()}))}))}))):e.$router.push("/bale-opening")}))},backToGrid:function(){this.$router.push("/bale-opening")},execute:function(){var e=this;this.$q.loading.show(),n["a"].put("/bale-openings/execute/".concat(this.$route.params.id)).then((function(t){var a=t.data;e.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result?(e.$q.loading.hide(),e.fetchFromServer()):e.$q.loading.hide()}))},addDetail:function(){var e=this;if(this.$v.detail.fields.$reset(),this.$v.detail.fields.$touch(),this.$v.detail.fields.$error)return this.$q.dialog({title:"Error",message:"Por favor, verifique las validaciones.",persistent:!0}),!1;if(null==this.detail.fields.bale.value)return this.$q.dialog({title:"Error",message:"Por favor, seleccione la paca.",persistent:!0}),!1;this.$q.loading.show();var t=[];t.baleOpeningId=Number(this.$route.params.id),t.baleId=Number(s()({},this.detail.fields).bale.value),t.bulkFiberProductId=Number(s()({},this.detail.fields).bulkFiberProduct.value),n["a"].post("/bale-opening-details",t).then((function(t){var a=t.data;e.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result?(e.detail.fields.id=null,e.detail.fields.product=null,e.detail.fields.bale=null,e.detail.fields.bulkFiberProduct=null,e.$q.loading.hide(),e.fetchFromServer()):e.$q.loading.hide()}))},removeDetail:function(e){var t=this;this.$q.loading.show(),n["a"].delete("/bale-opening-details/".concat(e)).then((function(e){var a=e.data;t.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result&&(t.$q.loading.hide(),t.fetchFromServer())}))}}},u=c,p=a("2877"),b=a("9989"),f=a("9c40"),g=a("ead5"),m=a("079e"),h=a("ddd8"),v=a("0016"),O=a("7cbe"),q=a("52ee"),_=a("27f9"),k=a("eaac"),y=a("bd08"),S=a("db86"),$=a("05c0"),x=a("eebe"),w=a.n(x),P=Object(p["a"])(u,l,i,!1,null,null,null);t["default"]=P.exports;w()(P,"components",{QPage:b["a"],QBtn:f["a"],QBreadcrumbs:g["a"],QBreadcrumbsEl:m["a"],QSelect:h["a"],QIcon:v["a"],QPopupProxy:O["a"],QDate:q["a"],QInput:_["a"],QTable:k["a"],QTr:y["a"],QTd:S["a"],QTooltip:$["a"]})}}]);