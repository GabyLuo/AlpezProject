(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"261e":function(t,e,a){"use strict";a("a383")},a383:function(t,e,a){},c69e:function(t,e,a){"use strict";a.r(e);a("4de4"),a("d3b7");var s=function(){var t=this,e=t._self._c;return e("q-page",{staticClass:"bg-grey-3"},[e("div",{staticClass:"q-pa-sm panel-header"},[e("div",{staticClass:"row q-col-gutter-xs q-col-gutter-md"},[e("div",{staticClass:"col-sm-8"},[e("div",{staticClass:"q-pa-md q-gutter-sm",staticStyle:{"font-size":"24px"}},[e("q-breadcrumbs",{staticStyle:{"font-size":"24px"},attrs:{align:"left","active-color":"blue-8"}},[e("q-breadcrumbs-el",{attrs:{label:"",icon:"home",to:"/"}}),e("q-breadcrumbs-el",{attrs:{label:"Auxiliar Contable"}})],1)],1)]),e("div",{staticClass:"col-xs-12 col-md-4 pull-right"},[e("div",{staticClass:"q-pa-md q-gutter-sm"},[e("q-dialog",{attrs:{persistent:""},model:{value:t.promptEmailPagos,callback:function(e){t.promptEmailPagos=e},expression:"promptEmailPagos"}},[e("q-card",{staticStyle:{"min-width":"350px"}},[e("q-card-section",{staticClass:"bg-primary"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-11 text-h6",staticStyle:{color:"white"}},[t._v("Enviar E-mail")]),e("div",{staticClass:"col-sm-1 pull-right"},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"white",flat:"",round:"",dense:"",icon:"close"}})],1)])]),e("q-card-section",{staticClass:"row items-center"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-xs-12 col-sm-12 col-md-12 col-lg-12"},[e("q-select",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",options:t.filteredCustomerOptionsv2,"use-input":"","hide-selected":"","fill-input":"",error:t.$v.emailReport.fields.customer_select.$error,"input-debounce":"0",label:"Cliente","emit-value":"","map-options":""},on:{filter:t.filtrarClientesv2,input:function(e){return t.filterMail()}},model:{value:t.emailReport.fields.customer_select,callback:function(e){t.$set(t.emailReport.fields,"customer_select",e)},expression:"emailReport.fields.customer_select"}})],1),e("div",{staticClass:"col-xs-12 col-sm-12 col-md-12 col-lg-12",staticStyle:{"padding-top":"15px"}},[e("q-input",{attrs:{color:"white","bg-color":"primary",filled:"",dark:"",error:t.$v.emailReport.fields.email_cliente.$error,label:"E-mail",rules:t.emailRule},on:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.promptEmail=!1}},model:{value:t.emailReport.fields.email_cliente,callback:function(e){t.$set(t.emailReport.fields,"email_cliente",e)},expression:"emailReport.fields.email_cliente"}})],1)])]),e("q-card-actions",{attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cancelar",color:"negative"},on:{click:function(e){return t.cleanDialog()}}}),e("q-btn",{attrs:{label:"Enviar",color:"positive",loading:t.loadingSendingMailBtn},on:{click:function(e){return t.sendEmailsReport()}}})],1)],1)],1),e("q-btn",{staticStyle:{"margin-left":"10px"},attrs:{color:"green",icon:"fas fa-file-excel"},on:{click:function(e){return t.generateCSV()}}},[e("q-tooltip",[t._v("GENERAR CSV")])],1),e("q-btn",{staticStyle:{"margin-left":"10px"},attrs:{color:"red",icon:"fas fa-file-pdf"},on:{click:function(e){return t.generatePDF()}}},[e("q-tooltip",[t._v("GENERAR PDF")])],1)],1)])])]),e("div",{staticClass:"q-pa-md bg-grey-3"},[e("div",{staticClass:"row bg-white"},[e("div",{staticClass:"col q-pa-md"},[e("div",{staticClass:"row q-col-gutter-xs"},[e("div",{staticClass:"col-md-2 col-xs-12 col-sm-2"},[e("q-select",{attrs:{color:"white","bg-color":"secondary",filled:"",dark:"",mask:"date",label:"Desde"},model:{value:t.saleDatev1,callback:function(e){t.saleDatev1=e},expression:"saleDatev1"}},[e("q-popup-proxy",{ref:"date",attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("div",{staticClass:"col-sm-12"},[e("q-date",{attrs:{mask:"DD/MM/YYYY","today-btn":""},on:{input:function(e){return t.filterGrid()}},model:{value:t.saleDatev1,callback:function(e){t.saleDatev1=e},expression:"saleDatev1"}})],1)])],1)],1),e("div",{staticClass:"col-md-2"},[e("q-select",{attrs:{color:"white","bg-color":"secondary",filled:"",dark:"",mask:"date",label:"Hasta"},model:{value:t.saleDatev2,callback:function(e){t.saleDatev2=e},expression:"saleDatev2"}},[e("q-popup-proxy",{ref:"date",attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("div",{staticClass:"col-sm-12"},[e("q-date",{attrs:{mask:"DD/MM/YYYY","today-btn":""},on:{input:function(e){return t.filterGrid()}},model:{value:t.saleDatev2,callback:function(e){t.saleDatev2=e},expression:"saleDatev2"}})],1)])],1)],1),e("div",{staticClass:"col-xs-12 col-sm-3 col-md-3"},[e("q-select",{attrs:{color:"white","bg-color":"secondary",filled:"",dark:"",options:t.filteredCustomerOptions,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Cliente","emit-value":"","map-options":""},on:{filter:t.filtrarClientes,input:function(e){return t.filterGrid()}},model:{value:t.customer,callback:function(e){t.customer=e},expression:"customer"}})],1),e("div",{staticClass:"col-xs-12 col-sm-3 text-center"},[e("q-select",{attrs:{color:"white","bg-color":"secondary",filled:"",dark:"","emit-value":"","map-options":"",options:t.branchesList,rules:t.branchOfficeRules,error:t.$v.branch_id.$error,label:"Estación"},on:{input:function(e){return t.filterGrid()}},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("q-icon",{attrs:{name:"business"}})]},proxy:!0}]),model:{value:t.branch_id,callback:function(e){t.branch_id=e},expression:"branch_id"}})],1),e("div",{staticClass:"col-md-2"},[e("q-select",{attrs:{color:"white","bg-color":"secondary",filled:"",dark:"",options:[{label:"PAGADO",value:1},{label:"PENDIENTE",value:2},{label:"ABONADO",value:3}],"emit-value":"","map-options":"",multiple:"",label:"Estatus Pago"},on:{input:function(e){return t.filterGrid()}},scopedSlots:t._u([{key:"option",fn:function(a){var s=a.itemProps,i=a.itemEvents,l=a.opt,n=a.selected,r=a.toggleOption;return[e("q-item",t._g(t._b({},"q-item",s,!1),i),[e("q-item-section",[e("q-item-label",{domProps:{innerHTML:t._s(l.label)}})],1),e("q-item-section",{attrs:{side:""}},[e("q-toggle",{attrs:{color:"green",value:n},on:{input:function(t){return r(l)}}})],1)],1)]}}]),model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1)])])]),e("div",{staticClass:"row bg-white"},[e("div",{staticClass:"col q-pa-md"},[e("div",{attrs:{id:"sticky-table-scroll"}},[e("q-table",{staticStyle:{"margin-top":"10px"},attrs:{id:"sticky-table-newstyle",flat:"",bordered:"",data:t.data,columns:t.columns,"row-key":"sale_date",pagination:t.pagination,filter:t.filter},on:{"update:pagination":function(e){t.pagination=e},request:t.qTableRequest},scopedSlots:t._u([{key:"top",fn:function(){return[e("div",{staticStyle:{width:"100%"}},[e("q-input",{attrs:{dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})],1)]},proxy:!0},{key:"body",fn:function(a){return[e("q-tr",{attrs:{props:a}},[e("q-td",{key:"id",staticStyle:{"text-align":"center"},attrs:{props:a}},[e("label",{staticClass:"text-blue-8",staticStyle:{"text-decoration":"underline",cursor:"pointer"},on:{click:function(e){return t.openActions(a.row.id)}}},[t._v(t._s(a.row.id))])]),e("q-td",{key:"sale_date",attrs:{props:a}},[t._v(t._s(a.row.sale_date))]),e("q-td",{key:"status_invoice",staticStyle:{"text-align":"center"},attrs:{props:a}},[e("q-chip",{attrs:{square:"",dense:"",color:"REMISIONADO"==a.row.status?"primary":"ENVIADO"==a.row.status?"warning":"ENTREGADO"==a.row.status||"PAGADO"==a.row.status?"positive":"FACTURADO"==a.row.status?"purple":"CANCELADO"==a.row.status?"negative":"black","text-color":"white"}},[t._v("\n                    "+t._s(a.row.status)+"\n                  ")])],1),e("q-td",{key:"status_payment",attrs:{props:a}},[e("q-chip",{staticStyle:{"font-size":"13px","padding-top":"3px"},attrs:{square:"",dense:"",color:t.colorPayment[a.row.status_payment],"text-color":"white"}},[t._v(t._s(t.statusPayment[a.row.status_payment]))])],1),e("q-td",{key:"no_factura",staticStyle:{"text-align":"left"},attrs:{props:a}},[t._v(t._s(a.row.factura))]),e("q-td",{key:"shopping_cart_id",staticStyle:{"text-align":"center"},attrs:{props:a}},[e("label",{staticClass:"text-blue-8",staticStyle:{"text-decoration":"underline",cursor:"pointer"},on:{click:function(e){return t.openActionsv2(a.row.shopping_cart_id)}}},[t._v(t._s(a.row.shopping_cart_id))])]),e("q-td",{key:"fecha_factura",staticStyle:{"text-align":"center"},attrs:{props:a}},[t._v(t._s(a.row.expired_date))]),e("q-td",{key:"customer",staticStyle:{"text-align":"left"},attrs:{props:a}},[t._v(t._s(a.row.customer))]),e("q-td",{key:"total",staticStyle:{"text-align":"right"},attrs:{props:a}},[t._v(t._s("".concat(t.currencyFormatter.format(a.row.cantidad_total))))]),e("q-td",{key:"abonado",staticStyle:{"text-align":"right"},attrs:{props:a}},[t._v(t._s("".concat(t.currencyFormatter.format(a.row.abonado))))]),e("q-td",{key:"restante",staticStyle:{"text-align":"right"},attrs:{props:a}},[t._v(t._s("".concat(t.currencyFormatter.format(a.row.cantidad_restante))))])],1)]}}])})],1)])])])])},i=[],l=a("ded3"),n=a.n(l),r=a("7ec2"),o=a.n(r),c=a("c973"),u=a.n(c),d=(a("99af"),a("159b"),a("a9e3"),a("caad"),a("2532"),a("14d9"),a("b680"),a("ac1f"),a("5319"),a("aabb")),p=a("b5ae"),m=p.required,f=p.email,v={name:"IndexStorageExits",validations:{paymentMethod:{required:m},paymentDate:{required:m},qty:{required:m},emailReport:{fields:{email_cliente:{required:m,email:f},customer_select:{required:m}}},branch_id:{}},data:function(){return{currencyFormatter:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),formatter:new Intl.NumberFormat("en-US"),role:null,promptEmailPagos:!1,tableWithInvoice:!1,tableWithoutInvoice:!0,interval:null,customer:"TODOS",disableBtnAddPayment:!0,disableTblPayments:!0,qty:null,branch_id:0,paymentDate:null,paymentMethod:null,status:[],emailReport:{fields:{email_cliente:"",customer_select:null}},loadingSendingMailBtn:!1,reference:null,total_invoice:null,id_invoice:null,paymentsModal:!1,saleDatev1:null,saleDatev2:null,customerOptions:[],filteredCustomerOptions:[],filteredCustomerOptionsv2:[],formaPagoOptions:[],branchesList:[],pagination:{sortBy:"id",descending:!0,page:1,rowsNumber:0,rowsPerPage:25},columns:[{name:"id",align:"center",label:"# REMISIÓN",field:"id",sortable:!0},{name:"sale_date",align:"center",label:"FECHA DE VENTA",field:"sale_date",sortable:!0},{name:"status_invoice",align:"center",label:"STATUS",field:"status_invoice",sortable:!0},{name:"status_payment",align:"center",label:"ESTATUS DE PAGO",field:"status_payment",sortable:!0},{name:"shopping_cart_id",align:"center",label:"No. FACTURA",field:"shopping_cart_id",sortable:!0},{name:"no_factura",align:"center",label:"No. PEDIDO",field:"no_factura",sortable:!0},{name:"fecha_factura",align:"center",label:"FECHA FACTURA",field:"fecha_factura",sortable:!0},{name:"customer",align:"center",label:"CLIENTE",field:"customer",sortable:!0},{name:"total",align:"center",label:"MONTO TOTAL",field:"total",sortable:!0},{name:"abonado",align:"center",label:"ABONADO",field:"abonado",sortable:!0},{name:"restante",align:"center",label:"RESTANTE",field:"restante",sortable:!0}],data:[],filter:"",statusPayment:["PENDIENTE DE PAGO","ABONADO","PAGADO","VENCIDO","VENCIDO ABONADO"],colorPayment:["blue-6","warning","green-6","red-14","red-14"]}},computed:{roleId:function(){var t=this.$store.getters["users/rol"];return parseInt(t)},fiberSaleDocumentFileUrl:function(){return"".concat("http://api.alpez.beta.wasp.mx/","invoices/document-file/").concat(this.fiberSaleDocumentFile.fields.fiberSaleId)},totalAmounfromPayments:function(){var t=0;return this.dataPayments.forEach((function(e){t+=Number(e.amount)})),t},haspermissionv1:function(){var t=!1;return(this.$store.getters["users/roles"].includes(1)||this.$store.getters["users/roles"].includes(12)||this.$store.getters["users/roles"].includes(17))&&(t=!0),t},emailRule:function(t){var e=this;return[function(t){return e.$v.emailReport.fields.email_cliente.email||"El campo debe contener un correo válido."}]},branchOfficeRules:function(t){var e=this;return[function(t){return e.$v.branch_id||"El campo Sucursal es requerido."}]}},beforeRouteEnter:function(t,e,a){a((function(t){var e=t.$store.getters["users/rol"];console.log(e),1===e||2===e||12===e||17===e||28===e||4===e||22===e||25===e||20===e||29===e?a():a("/")}))},mounted:function(){this.fetchFromServer(),this.getClients(),this.getBranchesList()},methods:{openActions:function(t){this.$router.push("/storage-exits/".concat(t))},openActionsv2:function(t){this.$router.push("/shopping-carts/orders/".concat(t))},fetchFromServer:function(){this.$q.loading.show(),this.qTableRequest({pagination:this.pagination,filter:this.filter})},qTableRequest:function(t){var e=this;return u()(o()().mark((function a(){var s;return o()().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.pagination=t.pagination,e.filter=t.filter,e.data=[],s=[],s.customer=e.customer,s.status=e.status,s.saleDatev1=e.saleDatev1,s.saleDatev2=e.saleDatev2,s.branchid=e.branch_id,s.invoices="",s.type=1,s.pagination=e.pagination,s.filter=e.filter,a.next=15,d["a"].post("/invoices/pag_payments",s).then((function(t){var a=t.data;e.$q.loading.hide(),e.data=a.invoices,console.log(a),e.pagination.rowsNumber=a.invoicesCount})).catch((function(t){return t}));case 15:case"end":return a.stop()}}),a)})))()},getClients:function(){var t=this;d["a"].get("/customers/options").then((function(e){var a=e.data;t.customerOptions=a.options,t.customerOptionsv2=a.options,t.customerOptions.push({label:"TODOS",value:"TODOS"})}))},getPayments:function(t){var e=this,a=[];a.id=this.id_invoice,d["a"].get("/invoices/formaPagoOptions").then((function(t){var s=t.data;e.formaPagoOptions=s.options,d["a"].post("/invoices/dataFromInvoice",a).then((function(t){var a=t.data;a.result&&(e.total_invoice=parseFloat(a.total_invoice),e.dataPayments=a.payments,e.dataPayments.length>0?d["a"].get("/invoices/keepCheckingPayments/"+e.id_invoice).then((function(t){var a=t.data;a.result?null===e.interval&&(e.interval=setInterval((function(){e.revisarPagos(e.id_invoice)}),1e4)):(clearInterval(e.interval),e.interval=null),e.disableTblPayments=!0;var s=parseFloat(e.totalAmounfromPayments),i=parseFloat(e.total_invoice.toFixed(2));i>s&&(e.disableBtnAddPayment=!1,e.fetchFromServer())})):e.disableTblPayments=!1)}))}))},filterGrid:function(){var t=this;this.data=[];var e=[];e.customer=this.customer,e.status=this.status,e.saleDatev1=this.saleDatev1,e.saleDatev2=this.saleDatev2,e.invoices="",e.type=1,e.pagination=this.pagination,e.filter=this.filter,e.branch=this.branch_id,d["a"].post("/invoices/getGridPayments",e).then((function(e){var a=e.data;a.result&&(t.$q.loading.hide(),t.data=a.invoices,t.pagination.rowsNumber=a.invoicesCount)})),"TODOS"!==this.customer&&(this.emailReport.fields.customer_select=this.customer,this.filterMail())},filtrarClientes:function(t,e,a){var s=this;e((function(){var e=t.toLowerCase();s.filteredCustomerOptions=s.customerOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},filtrarClientesv2:function(t,e,a){var s=this;e((function(){var e=t.toLowerCase();s.filteredCustomerOptionsv2=s.customerOptionsv2.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}))},generatePDF:function(){var t=[],e=[];if(e=0===this.status.length?[99]:this.status,t.customer=this.customer,t.status=e,t.type=1,this.saleDatev1){t.saleDatev1=this.saleDatev1;while(t.saleDatev1.includes("/"))t.saleDatev1=t.saleDatev1.replace("/","-")}else t.saleDatev1=null;if(this.saleDatev2){t.saleDatev2=this.saleDatev2;while(t.saleDatev2.includes("/"))t.saleDatev2=t.saleDatev2.replace("/","-")}else t.saleDatev2=null;if("null"===this.branch_id?t.branchid="TODAS":t.branchid=this.branch_id,0===this.branch_id)return this.$q.notify({message:"Elige una sucursal",position:"top",color:"warning"}),!1;var a="http://api.alpez.beta.wasp.mx/"+"invoices/getPdfFromPaymentsDetails/".concat(t.type,"/").concat(t.customer,"/").concat(t.status,"/").concat(t.saleDatev1,"/").concat(t.saleDatev2,"/").concat(t.branchid);window.open(a,"_blank")},generateCSV:function(){var t=[],e=[];if(e=0===this.status.length?[99]:this.status,t.customer=this.customer,t.status=e,this.saleDatev1){t.saleDatev1=this.saleDatev1;while(t.saleDatev1.includes("/"))t.saleDatev1=t.saleDatev1.replace("/","-")}else t.saleDatev1=null;if(this.saleDatev2){t.saleDatev2=this.saleDatev2;while(t.saleDatev2.includes("/"))t.saleDatev2=t.saleDatev2.replace("/","-")}else t.saleDatev2=null;if("null"===this.branch_id?t.branchid="TODAS":t.branchid=this.branch_id,0===this.branch_id)return this.$q.notify({message:"Elige una sucursal",position:"top",color:"warning"}),!1;var a="http://api.alpez.beta.wasp.mx/"+"invoices/getCSVFromPaymentsDetails/".concat(t.customer,"/").concat(t.status,"/").concat(t.saleDatev1,"/").concat(t.saleDatev2,"/").concat(t.branchid);window.open(a,"_blank")},sendMail:function(){this.promptEmailPagos=!0},filterMail:function(){var t=this,e=[];e.id=this.emailReport.fields.customer_select,e.branch=this.branch_id,d["a"].post("/customers/getDataClient",e).then((function(e){var a=e.data;t.emailReport.fields.email_cliente=a.data[0][f]}))},cleanDialog:function(){this.emailReport.fields.email_cliente="",this.emailReport.fields.customer_select=null,this.promptEmailPagos=!1},getBranchesList:function(){var t=this;d["a"].get("branch-offices/options").then((function(e){t.branchesList=e.data.options,t.branchesList.push({label:"TODAS",value:0})}))},sendEmailsReport:function(){var t=this;if(this.$v.emailReport.fields.$reset(),this.$v.emailReport.fields.$reset(),this.$v.emailReport.fields.$touch(),this.$v.emailReport.fields.$error)return!1;this.loadingSendingMailBtn=!0;var e=[];if(e.customer=this.emailReport.fields.customer_select,e.email=n()({},this.emailReport.fields).email_cliente,this.saleDatev1){e.saleDatev1=this.saleDatev1;while(e.saleDatev1.includes("/"))e.saleDatev1=e.saleDatev1.replace("/","-")}else e.saleDatev1=null;if(this.saleDatev2){e.saleDatev2=this.saleDatev2;while(e.saleDatev2.includes("/"))e.saleDatev2=e.saleDatev2.replace("/","-")}else e.saleDatev2=null;var a=[];a=0===this.status.length?[99]:this.status,e.status=a,e.type=2,d["a"].post("/invoices/sendEmailsReport",e).then((function(e){var a=e.data;t.$q.notify({message:a.message.content,position:"top",color:a.result?"positive":"warning"}),a.result?(t.promptEmailPagos=!1,t.emailReport.fields.email_cliente="",t.emailReport.fields.customer_select=null,t.loadingSendingMailBtn=!1):t.loadingSendingMailBtn=!1}))}}},h=v,b=(a("261e"),a("2877")),g=a("9989"),D=a("ead5"),_=a("079e"),y=a("9c40"),q=a("05c0"),w=a("24e8"),C=a("f09f"),x=a("a370"),S=a("ddd8"),k=a("27f9"),O=a("4b7e"),E=a("7cbe"),P=a("52ee"),A=a("0016"),R=a("66e5"),T=a("4074"),N=a("0170"),$=a("9564"),I=a("eaac"),F=a("bd08"),Q=a("db86"),M=a("b047"),B=a("7f67"),G=a("eebe"),L=a.n(G),U=Object(b["a"])(h,s,i,!1,null,null,null);e["default"]=U.exports;L()(U,"components",{QPage:g["a"],QBreadcrumbs:D["a"],QBreadcrumbsEl:_["a"],QBtn:y["a"],QTooltip:q["a"],QDialog:w["a"],QCard:C["a"],QCardSection:x["a"],QSelect:S["a"],QInput:k["a"],QCardActions:O["a"],QPopupProxy:E["a"],QDate:P["a"],QIcon:A["a"],QItem:R["a"],QItemSection:T["a"],QItemLabel:N["a"],QToggle:$["a"],QTable:I["a"],QTr:F["a"],QTd:Q["a"],QChip:M["a"]}),L()(U,"directives",{ClosePopup:B["a"]})}}]);